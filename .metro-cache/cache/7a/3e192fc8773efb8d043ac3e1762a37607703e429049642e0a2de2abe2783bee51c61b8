{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"firebase/database","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":135,"index":135}}],"key":"ZF/J3nfk5GUgbzXl84BqV1IxYEE=","exportNames":["*"],"imports":1}},{"name":"../config/firebase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":136},"end":{"line":2,"column":46,"index":182}}],"key":"K/SZPG5sPeV1upVh8dao26aG7MQ=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":183},"end":{"line":3,"column":69,"index":252}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"generateMessageId\", {\n    enumerable: true,\n    get: function () {\n      return generateMessageId;\n    }\n  });\n  Object.defineProperty(exports, \"getChatId\", {\n    enumerable: true,\n    get: function () {\n      return getChatId;\n    }\n  });\n  Object.defineProperty(exports, \"saveMessagesLocally\", {\n    enumerable: true,\n    get: function () {\n      return saveMessagesLocally;\n    }\n  });\n  Object.defineProperty(exports, \"getLocalMessages\", {\n    enumerable: true,\n    get: function () {\n      return getLocalMessages;\n    }\n  });\n  Object.defineProperty(exports, \"addMessageLocally\", {\n    enumerable: true,\n    get: function () {\n      return addMessageLocally;\n    }\n  });\n  Object.defineProperty(exports, \"updateMessageStatusLocally\", {\n    enumerable: true,\n    get: function () {\n      return updateMessageStatusLocally;\n    }\n  });\n  Object.defineProperty(exports, \"sendMessageToFirebase\", {\n    enumerable: true,\n    get: function () {\n      return sendMessageToFirebase;\n    }\n  });\n  Object.defineProperty(exports, \"getMessageQueue\", {\n    enumerable: true,\n    get: function () {\n      return getMessageQueue;\n    }\n  });\n  Object.defineProperty(exports, \"saveMessageQueue\", {\n    enumerable: true,\n    get: function () {\n      return saveMessageQueue;\n    }\n  });\n  Object.defineProperty(exports, \"addToQueue\", {\n    enumerable: true,\n    get: function () {\n      return addToQueue;\n    }\n  });\n  Object.defineProperty(exports, \"removeFromQueue\", {\n    enumerable: true,\n    get: function () {\n      return removeFromQueue;\n    }\n  });\n  Object.defineProperty(exports, \"subscribeToNewMessages\", {\n    enumerable: true,\n    get: function () {\n      return subscribeToNewMessages;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _firebaseDatabase = require(_dependencyMap[1], \"firebase/database\");\n  var _configFirebase = require(_dependencyMap[2], \"../config/firebase\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[3], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var QUEUE_KEY = '@bitgo_message_queue';\n  var MESSAGES_KEY = '@bitgo_messages_';\n\n  // Track active listeners to prevent duplicates\n  var activeListeners = new Map();\n\n  // Generate unique message ID locally\n  var generateMessageId = () => {\n    return `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  };\n\n  // Get chat ID from two user phones (sorted for consistency)\n  var getChatId = (phone1, phone2) => {\n    var sorted = [phone1, phone2].sort();\n    return `${sorted[0]}_${sorted[1]}`;\n  };\n\n  // Save messages locally for a chat\n  var saveMessagesLocally = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator.default)(function* (chatId, messages) {\n      try {\n        yield AsyncStorage.default.setItem(MESSAGES_KEY + chatId, JSON.stringify(messages));\n      } catch (e) {\n        // Silent fail in production\n      }\n    });\n    return function saveMessagesLocally(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  // Get messages from local storage\n  var getLocalMessages = /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator.default)(function* (chatId) {\n      try {\n        var data = yield AsyncStorage.default.getItem(MESSAGES_KEY + chatId);\n        return data ? JSON.parse(data) : [];\n      } catch (e) {\n        return [];\n      }\n    });\n    return function getLocalMessages(_x3) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  // Add single message to local storage\n  var addMessageLocally = /*#__PURE__*/function () {\n    var _ref3 = (0, _asyncToGenerator.default)(function* (chatId, message) {\n      try {\n        var messages = yield getLocalMessages(chatId);\n        var exists = messages.find(m => m.id === message.id);\n        if (!exists) {\n          messages.push(message);\n          // Keep only last 100 messages locally\n          var trimmed = messages.slice(-100);\n          yield saveMessagesLocally(chatId, trimmed);\n        }\n      } catch (e) {\n        // Silent fail in production\n      }\n    });\n    return function addMessageLocally(_x4, _x5) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  // Update message status locally\n  var updateMessageStatusLocally = /*#__PURE__*/function () {\n    var _ref4 = (0, _asyncToGenerator.default)(function* (chatId, messageId, status) {\n      try {\n        var messages = yield getLocalMessages(chatId);\n        var index = messages.findIndex(m => m.id === messageId);\n        if (index !== -1) {\n          messages[index].status = status;\n          yield saveMessagesLocally(chatId, messages);\n        }\n      } catch (e) {\n        // Silent fail in production\n      }\n    });\n    return function updateMessageStatusLocally(_x6, _x7, _x8) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  // Send message to Firebase (minimal payload) - checks for duplicate before writing\n  var sendMessageToFirebase = /*#__PURE__*/function () {\n    var _ref5 = (0, _asyncToGenerator.default)(function* (chatId, message) {\n      try {\n        var messageRef = (0, _firebaseDatabase.ref)(_configFirebase.database, `chats/${chatId}/messages/${message.id}`);\n\n        // Check if message already exists (prevent duplicates on retry)\n        var snapshot = yield (0, _firebaseDatabase.get)(messageRef);\n        if (snapshot.exists()) {\n          return true;\n        }\n\n        // Minimal payload only - text, sender, timestamp, status\n        yield (0, _firebaseDatabase.set)(messageRef, {\n          text: message.text,\n          sender: message.sender,\n          timestamp: message.timestamp,\n          status: 'sent'\n        });\n\n        // Update chat meta for sorting (lastMessage, lastTimestamp)\n        var metaRef = (0, _firebaseDatabase.ref)(_configFirebase.database, `chats/${chatId}/meta`);\n        yield (0, _firebaseDatabase.set)(metaRef, {\n          lastMessage: message.text.substring(0, 50),\n          lastTimestamp: message.timestamp\n        });\n        return true;\n      } catch (e) {\n        return false;\n      }\n    });\n    return function sendMessageToFirebase(_x9, _x0) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  // Queue management for offline messages\n\n  var getMessageQueue = /*#__PURE__*/function () {\n    var _ref6 = (0, _asyncToGenerator.default)(function* () {\n      try {\n        var data = yield AsyncStorage.default.getItem(QUEUE_KEY);\n        return data ? JSON.parse(data) : [];\n      } catch (e) {\n        return [];\n      }\n    });\n    return function getMessageQueue() {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  var saveMessageQueue = /*#__PURE__*/function () {\n    var _ref7 = (0, _asyncToGenerator.default)(function* (queue) {\n      try {\n        yield AsyncStorage.default.setItem(QUEUE_KEY, JSON.stringify(queue));\n      } catch (e) {\n        // Silent fail in production\n      }\n    });\n    return function saveMessageQueue(_x1) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n  var addToQueue = /*#__PURE__*/function () {\n    var _ref8 = (0, _asyncToGenerator.default)(function* (chatId, message) {\n      var queue = yield getMessageQueue();\n      // Check if already in queue\n      var exists = queue.find(q => q.message.id === message.id);\n      if (!exists) {\n        queue.push({\n          chatId,\n          message,\n          retryCount: 0\n        });\n        yield saveMessageQueue(queue);\n      }\n    });\n    return function addToQueue(_x10, _x11) {\n      return _ref8.apply(this, arguments);\n    };\n  }();\n  var removeFromQueue = /*#__PURE__*/function () {\n    var _ref9 = (0, _asyncToGenerator.default)(function* (messageId) {\n      var queue = yield getMessageQueue();\n      var filtered = queue.filter(q => q.message.id !== messageId);\n      yield saveMessageQueue(filtered);\n    });\n    return function removeFromQueue(_x12) {\n      return _ref9.apply(this, arguments);\n    };\n  }();\n\n  // Subscribe to new messages only (efficient listener with limitToLast)\n  // Prevents duplicate listeners per chatId\n  var subscribeToNewMessages = (chatId, lastTimestamp, onNewMessage, knownMessageIds) => {\n    // Prevent duplicate listeners for same chatId\n    if (activeListeners.get(chatId)) {\n      return () => {};\n    }\n    var messagesRef = (0, _firebaseDatabase.ref)(_configFirebase.database, `chats/${chatId}/messages`);\n\n    // Mark listener as active\n    activeListeners.set(chatId, true);\n\n    // Use limitToLast(30) to reduce data load on weak connections\n    var messagesQuery = (0, _firebaseDatabase.query)(messagesRef, (0, _firebaseDatabase.orderByChild)('timestamp'), (0, _firebaseDatabase.startAt)(lastTimestamp + 1), (0, _firebaseDatabase.limitToLast)(30));\n    (0, _firebaseDatabase.onChildAdded)(messagesQuery, snapshot => {\n      if (snapshot.exists()) {\n        var messageId = snapshot.key || '';\n\n        // Skip if we already have this message (prevent duplicates)\n        if (knownMessageIds.has(messageId)) {\n          return;\n        }\n        var data = snapshot.val();\n        var message = {\n          id: messageId,\n          text: data.text,\n          sender: data.sender,\n          timestamp: data.timestamp,\n          status: 'sent'\n        };\n        onNewMessage(message);\n      }\n    });\n\n    // Return unsubscribe function that cleans up properly\n    return () => {\n      (0, _firebaseDatabase.off)(messagesRef);\n      activeListeners.delete(chatId);\n    };\n  };\n});","lineCount":308,"map":[[12,2,22,0,"Object"],[12,8,22,0],[12,9,22,0,"defineProperty"],[12,23,22,0],[12,24,22,0,"exports"],[12,31,22,0],[13,4,22,0,"enumerable"],[13,14,22,0],[14,4,22,0,"get"],[14,7,22,0],[14,18,22,0,"get"],[14,19,22,0],[15,6,22,0],[15,13,22,0,"generateMessageId"],[15,30,22,0],[16,4,22,0],[17,2,22,0],[18,2,27,0,"Object"],[18,8,27,0],[18,9,27,0,"defineProperty"],[18,23,27,0],[18,24,27,0,"exports"],[18,31,27,0],[19,4,27,0,"enumerable"],[19,14,27,0],[20,4,27,0,"get"],[20,7,27,0],[20,18,27,0,"get"],[20,19,27,0],[21,6,27,0],[21,13,27,0,"getChatId"],[21,22,27,0],[22,4,27,0],[23,2,27,0],[24,2,33,0,"Object"],[24,8,33,0],[24,9,33,0,"defineProperty"],[24,23,33,0],[24,24,33,0,"exports"],[24,31,33,0],[25,4,33,0,"enumerable"],[25,14,33,0],[26,4,33,0,"get"],[26,7,33,0],[26,18,33,0,"get"],[26,19,33,0],[27,6,33,0],[27,13,33,0,"saveMessagesLocally"],[27,32,33,0],[28,4,33,0],[29,2,33,0],[30,2,42,0,"Object"],[30,8,42,0],[30,9,42,0,"defineProperty"],[30,23,42,0],[30,24,42,0,"exports"],[30,31,42,0],[31,4,42,0,"enumerable"],[31,14,42,0],[32,4,42,0,"get"],[32,7,42,0],[32,18,42,0,"get"],[32,19,42,0],[33,6,42,0],[33,13,42,0,"getLocalMessages"],[33,29,42,0],[34,4,42,0],[35,2,42,0],[36,2,52,0,"Object"],[36,8,52,0],[36,9,52,0,"defineProperty"],[36,23,52,0],[36,24,52,0,"exports"],[36,31,52,0],[37,4,52,0,"enumerable"],[37,14,52,0],[38,4,52,0,"get"],[38,7,52,0],[38,18,52,0,"get"],[38,19,52,0],[39,6,52,0],[39,13,52,0,"addMessageLocally"],[39,30,52,0],[40,4,52,0],[41,2,52,0],[42,2,68,0,"Object"],[42,8,68,0],[42,9,68,0,"defineProperty"],[42,23,68,0],[42,24,68,0,"exports"],[42,31,68,0],[43,4,68,0,"enumerable"],[43,14,68,0],[44,4,68,0,"get"],[44,7,68,0],[44,18,68,0,"get"],[44,19,68,0],[45,6,68,0],[45,13,68,0,"updateMessageStatusLocally"],[45,39,68,0],[46,4,68,0],[47,2,68,0],[48,2,86,0,"Object"],[48,8,86,0],[48,9,86,0,"defineProperty"],[48,23,86,0],[48,24,86,0,"exports"],[48,31,86,0],[49,4,86,0,"enumerable"],[49,14,86,0],[50,4,86,0,"get"],[50,7,86,0],[50,18,86,0,"get"],[50,19,86,0],[51,6,86,0],[51,13,86,0,"sendMessageToFirebase"],[51,34,86,0],[52,4,86,0],[53,2,86,0],[54,2,127,0,"Object"],[54,8,127,0],[54,9,127,0,"defineProperty"],[54,23,127,0],[54,24,127,0,"exports"],[54,31,127,0],[55,4,127,0,"enumerable"],[55,14,127,0],[56,4,127,0,"get"],[56,7,127,0],[56,18,127,0,"get"],[56,19,127,0],[57,6,127,0],[57,13,127,0,"getMessageQueue"],[57,28,127,0],[58,4,127,0],[59,2,127,0],[60,2,136,0,"Object"],[60,8,136,0],[60,9,136,0,"defineProperty"],[60,23,136,0],[60,24,136,0,"exports"],[60,31,136,0],[61,4,136,0,"enumerable"],[61,14,136,0],[62,4,136,0,"get"],[62,7,136,0],[62,18,136,0,"get"],[62,19,136,0],[63,6,136,0],[63,13,136,0,"saveMessageQueue"],[63,29,136,0],[64,4,136,0],[65,2,136,0],[66,2,144,0,"Object"],[66,8,144,0],[66,9,144,0,"defineProperty"],[66,23,144,0],[66,24,144,0,"exports"],[66,31,144,0],[67,4,144,0,"enumerable"],[67,14,144,0],[68,4,144,0,"get"],[68,7,144,0],[68,18,144,0,"get"],[68,19,144,0],[69,6,144,0],[69,13,144,0,"addToQueue"],[69,23,144,0],[70,4,144,0],[71,2,144,0],[72,2,154,0,"Object"],[72,8,154,0],[72,9,154,0,"defineProperty"],[72,23,154,0],[72,24,154,0,"exports"],[72,31,154,0],[73,4,154,0,"enumerable"],[73,14,154,0],[74,4,154,0,"get"],[74,7,154,0],[74,18,154,0,"get"],[74,19,154,0],[75,6,154,0],[75,13,154,0,"removeFromQueue"],[75,28,154,0],[76,4,154,0],[77,2,154,0],[78,2,162,0,"Object"],[78,8,162,0],[78,9,162,0,"defineProperty"],[78,23,162,0],[78,24,162,0,"exports"],[78,31,162,0],[79,4,162,0,"enumerable"],[79,14,162,0],[80,4,162,0,"get"],[80,7,162,0],[80,18,162,0,"get"],[80,19,162,0],[81,6,162,0],[81,13,162,0,"subscribeToNewMessages"],[81,35,162,0],[82,4,162,0],[83,2,162,0],[84,2,212,2],[84,6,212,2,"_babelRuntimeHelpersAsyncToGenerator"],[84,42,212,2],[84,45,212,2,"require"],[84,52,212,2],[84,53,212,2,"_dependencyMap"],[84,67,212,2],[85,2,212,2],[85,6,212,2,"_asyncToGenerator"],[85,23,212,2],[85,26,212,2,"_interopDefault"],[85,41,212,2],[85,42,212,2,"_babelRuntimeHelpersAsyncToGenerator"],[85,78,212,2],[86,2,1,0],[86,6,1,0,"_firebaseDatabase"],[86,23,1,0],[86,26,1,0,"require"],[86,33,1,0],[86,34,1,0,"_dependencyMap"],[86,48,1,0],[87,2,2,0],[87,6,2,0,"_configFirebase"],[87,21,2,0],[87,24,2,0,"require"],[87,31,2,0],[87,32,2,0,"_dependencyMap"],[87,46,2,0],[88,2,3,0],[88,6,3,0,"_reactNativeAsyncStorageAsyncStorage"],[88,42,3,0],[88,45,3,0,"require"],[88,52,3,0],[88,53,3,0,"_dependencyMap"],[88,67,3,0],[89,2,3,0],[89,6,3,0,"AsyncStorage"],[89,18,3,0],[89,21,3,0,"_interopDefault"],[89,36,3,0],[89,37,3,0,"_reactNativeAsyncStorageAsyncStorage"],[89,73,3,0],[90,2,15,0],[90,6,15,6,"QUEUE_KEY"],[90,15,15,15],[90,18,15,18],[90,40,15,40],[91,2,16,0],[91,6,16,6,"MESSAGES_KEY"],[91,18,16,18],[91,21,16,21],[91,39,16,39],[93,2,18,0],[94,2,19,0],[94,6,19,6,"activeListeners"],[94,21,19,21],[94,24,19,24],[94,28,19,28,"Map"],[94,31,19,31],[94,32,19,49],[94,33,19,50],[96,2,21,0],[97,2,22,7],[97,6,22,13,"generateMessageId"],[97,23,22,30],[97,26,22,33,"generateMessageId"],[97,27,22,33],[97,32,22,47],[98,4,23,2],[98,11,23,9],[98,14,23,12,"Date"],[98,18,23,16],[98,19,23,17,"now"],[98,22,23,20],[98,23,23,21],[98,24,23,22],[98,28,23,26,"Math"],[98,32,23,30],[98,33,23,31,"random"],[98,39,23,37],[98,40,23,38],[98,41,23,39],[98,42,23,40,"toString"],[98,50,23,48],[98,51,23,49],[98,53,23,51],[98,54,23,52],[98,55,23,53,"substr"],[98,61,23,59],[98,62,23,60],[98,63,23,61],[98,65,23,63],[98,66,23,64],[98,67,23,65],[98,69,23,67],[99,2,24,0],[99,3,24,1],[101,2,26,0],[102,2,27,7],[102,6,27,13,"getChatId"],[102,15,27,22],[102,18,27,25,"getChatId"],[102,19,27,26,"phone1"],[102,25,27,40],[102,27,27,42,"phone2"],[102,33,27,56],[102,38,27,69],[103,4,28,2],[103,8,28,8,"sorted"],[103,14,28,14],[103,17,28,17],[103,18,28,18,"phone1"],[103,24,28,24],[103,26,28,26,"phone2"],[103,32,28,32],[103,33,28,33],[103,34,28,34,"sort"],[103,38,28,38],[103,39,28,39],[103,40,28,40],[104,4,29,2],[104,11,29,9],[104,14,29,12,"sorted"],[104,20,29,18],[104,21,29,19],[104,22,29,20],[104,23,29,21],[104,27,29,25,"sorted"],[104,33,29,31],[104,34,29,32],[104,35,29,33],[104,36,29,34],[104,38,29,36],[105,2,30,0],[105,3,30,1],[107,2,32,0],[108,2,33,7],[108,6,33,13,"saveMessagesLocally"],[108,25,33,32],[109,4,33,32],[109,8,33,32,"_ref"],[109,12,33,32],[109,19,33,32,"_asyncToGenerator"],[109,36,33,32],[109,37,33,32,"default"],[109,44,33,32],[109,46,33,35],[109,57,33,42,"chatId"],[109,63,33,56],[109,65,33,58,"messages"],[109,73,33,77],[109,75,33,97],[110,6,34,2],[110,10,34,6],[111,8,35,4],[111,14,35,10,"AsyncStorage"],[111,26,35,22],[111,27,35,22,"default"],[111,34,35,22],[111,35,35,23,"setItem"],[111,42,35,30],[111,43,35,31,"MESSAGES_KEY"],[111,55,35,43],[111,58,35,46,"chatId"],[111,64,35,52],[111,66,35,54,"JSON"],[111,70,35,58],[111,71,35,59,"stringify"],[111,80,35,68],[111,81,35,69,"messages"],[111,89,35,77],[111,90,35,78],[111,91,35,79],[112,6,36,2],[112,7,36,3],[112,8,36,4],[112,15,36,11,"e"],[112,16,36,12],[112,18,36,14],[113,8,37,4],[114,6,37,4],[115,4,39,0],[115,5,39,1],[116,4,39,1],[116,20,33,13,"saveMessagesLocally"],[116,39,33,32,"saveMessagesLocally"],[116,40,33,32,"_x"],[116,42,33,32],[116,44,33,32,"_x2"],[116,47,33,32],[117,6,33,32],[117,13,33,32,"_ref"],[117,17,33,32],[117,18,33,32,"apply"],[117,23,33,32],[117,30,33,32,"arguments"],[117,39,33,32],[118,4,33,32],[119,2,33,32],[119,5,39,1],[121,2,41,0],[122,2,42,7],[122,6,42,13,"getLocalMessages"],[122,22,42,29],[123,4,42,29],[123,8,42,29,"_ref2"],[123,13,42,29],[123,20,42,29,"_asyncToGenerator"],[123,37,42,29],[123,38,42,29,"default"],[123,45,42,29],[123,47,42,32],[123,58,42,39,"chatId"],[123,64,42,53],[123,66,42,78],[124,6,43,2],[124,10,43,6],[125,8,44,4],[125,12,44,10,"data"],[125,16,44,14],[125,25,44,23,"AsyncStorage"],[125,37,44,35],[125,38,44,35,"default"],[125,45,44,35],[125,46,44,36,"getItem"],[125,53,44,43],[125,54,44,44,"MESSAGES_KEY"],[125,66,44,56],[125,69,44,59,"chatId"],[125,75,44,65],[125,76,44,66],[126,8,45,4],[126,15,45,11,"data"],[126,19,45,15],[126,22,45,18,"JSON"],[126,26,45,22],[126,27,45,23,"parse"],[126,32,45,28],[126,33,45,29,"data"],[126,37,45,33],[126,38,45,34],[126,41,45,37],[126,43,45,39],[127,6,46,2],[127,7,46,3],[127,8,46,4],[127,15,46,11,"e"],[127,16,46,12],[127,18,46,14],[128,8,47,4],[128,15,47,11],[128,17,47,13],[129,6,48,2],[130,4,49,0],[130,5,49,1],[131,4,49,1],[131,20,42,13,"getLocalMessages"],[131,36,42,29,"getLocalMessages"],[131,37,42,29,"_x3"],[131,40,42,29],[132,6,42,29],[132,13,42,29,"_ref2"],[132,18,42,29],[132,19,42,29,"apply"],[132,24,42,29],[132,31,42,29,"arguments"],[132,40,42,29],[133,4,42,29],[134,2,42,29],[134,5,49,1],[136,2,51,0],[137,2,52,7],[137,6,52,13,"addMessageLocally"],[137,23,52,30],[138,4,52,30],[138,8,52,30,"_ref3"],[138,13,52,30],[138,20,52,30,"_asyncToGenerator"],[138,37,52,30],[138,38,52,30,"default"],[138,45,52,30],[138,47,52,33],[138,58,52,40,"chatId"],[138,64,52,54],[138,66,52,56,"message"],[138,73,52,72],[138,75,52,92],[139,6,53,2],[139,10,53,6],[140,8,54,4],[140,12,54,10,"messages"],[140,20,54,18],[140,29,54,27,"getLocalMessages"],[140,45,54,43],[140,46,54,44,"chatId"],[140,52,54,50],[140,53,54,51],[141,8,55,4],[141,12,55,10,"exists"],[141,18,55,16],[141,21,55,19,"messages"],[141,29,55,27],[141,30,55,28,"find"],[141,34,55,32],[141,35,55,33,"m"],[141,36,55,34],[141,40,55,38,"m"],[141,41,55,39],[141,42,55,40,"id"],[141,44,55,42],[141,49,55,47,"message"],[141,56,55,54],[141,57,55,55,"id"],[141,59,55,57],[141,60,55,58],[142,8,56,4],[142,12,56,8],[142,13,56,9,"exists"],[142,19,56,15],[142,21,56,17],[143,10,57,6,"messages"],[143,18,57,14],[143,19,57,15,"push"],[143,23,57,19],[143,24,57,20,"message"],[143,31,57,27],[143,32,57,28],[144,10,58,6],[145,10,59,6],[145,14,59,12,"trimmed"],[145,21,59,19],[145,24,59,22,"messages"],[145,32,59,30],[145,33,59,31,"slice"],[145,38,59,36],[145,39,59,37],[145,40,59,38],[145,43,59,41],[145,44,59,42],[146,10,60,6],[146,16,60,12,"saveMessagesLocally"],[146,35,60,31],[146,36,60,32,"chatId"],[146,42,60,38],[146,44,60,40,"trimmed"],[146,51,60,47],[146,52,60,48],[147,8,61,4],[148,6,62,2],[148,7,62,3],[148,8,62,4],[148,15,62,11,"e"],[148,16,62,12],[148,18,62,14],[149,8,63,4],[150,6,63,4],[151,4,65,0],[151,5,65,1],[152,4,65,1],[152,20,52,13,"addMessageLocally"],[152,37,52,30,"addMessageLocally"],[152,38,52,30,"_x4"],[152,41,52,30],[152,43,52,30,"_x5"],[152,46,52,30],[153,6,52,30],[153,13,52,30,"_ref3"],[153,18,52,30],[153,19,52,30,"apply"],[153,24,52,30],[153,31,52,30,"arguments"],[153,40,52,30],[154,4,52,30],[155,2,52,30],[155,5,65,1],[157,2,67,0],[158,2,68,7],[158,6,68,13,"updateMessageStatusLocally"],[158,32,68,39],[159,4,68,39],[159,8,68,39,"_ref4"],[159,13,68,39],[159,20,68,39,"_asyncToGenerator"],[159,37,68,39],[159,38,68,39,"default"],[159,45,68,39],[159,47,68,42],[159,58,69,2,"chatId"],[159,64,69,16],[159,66,70,2,"messageId"],[159,75,70,19],[159,77,71,2,"status"],[159,83,71,23],[159,85,72,20],[160,6,73,2],[160,10,73,6],[161,8,74,4],[161,12,74,10,"messages"],[161,20,74,18],[161,29,74,27,"getLocalMessages"],[161,45,74,43],[161,46,74,44,"chatId"],[161,52,74,50],[161,53,74,51],[162,8,75,4],[162,12,75,10,"index"],[162,17,75,15],[162,20,75,18,"messages"],[162,28,75,26],[162,29,75,27,"findIndex"],[162,38,75,36],[162,39,75,37,"m"],[162,40,75,38],[162,44,75,42,"m"],[162,45,75,43],[162,46,75,44,"id"],[162,48,75,46],[162,53,75,51,"messageId"],[162,62,75,60],[162,63,75,61],[163,8,76,4],[163,12,76,8,"index"],[163,17,76,13],[163,22,76,18],[163,23,76,19],[163,24,76,20],[163,26,76,22],[164,10,77,6,"messages"],[164,18,77,14],[164,19,77,15,"index"],[164,24,77,20],[164,25,77,21],[164,26,77,22,"status"],[164,32,77,28],[164,35,77,31,"status"],[164,41,77,37],[165,10,78,6],[165,16,78,12,"saveMessagesLocally"],[165,35,78,31],[165,36,78,32,"chatId"],[165,42,78,38],[165,44,78,40,"messages"],[165,52,78,48],[165,53,78,49],[166,8,79,4],[167,6,80,2],[167,7,80,3],[167,8,80,4],[167,15,80,11,"e"],[167,16,80,12],[167,18,80,14],[168,8,81,4],[169,6,81,4],[170,4,83,0],[170,5,83,1],[171,4,83,1],[171,20,68,13,"updateMessageStatusLocally"],[171,46,68,39,"updateMessageStatusLocally"],[171,47,68,39,"_x6"],[171,50,68,39],[171,52,68,39,"_x7"],[171,55,68,39],[171,57,68,39,"_x8"],[171,60,68,39],[172,6,68,39],[172,13,68,39,"_ref4"],[172,18,68,39],[172,19,68,39,"apply"],[172,24,68,39],[172,31,68,39,"arguments"],[172,40,68,39],[173,4,68,39],[174,2,68,39],[174,5,83,1],[176,2,85,0],[177,2,86,7],[177,6,86,13,"sendMessageToFirebase"],[177,27,86,34],[178,4,86,34],[178,8,86,34,"_ref5"],[178,13,86,34],[178,20,86,34,"_asyncToGenerator"],[178,37,86,34],[178,38,86,34,"default"],[178,45,86,34],[178,47,86,37],[178,58,87,2,"chatId"],[178,64,87,16],[178,66,88,2,"message"],[178,73,88,18],[178,75,89,23],[179,6,90,2],[179,10,90,6],[180,8,91,4],[180,12,91,10,"messageRef"],[180,22,91,20],[180,25,91,23],[180,29,91,23,"ref"],[180,46,91,26],[180,47,91,26,"ref"],[180,50,91,26],[180,52,91,27,"database"],[180,67,91,35],[180,68,91,35,"database"],[180,76,91,35],[180,78,91,37],[180,87,91,46,"chatId"],[180,93,91,52],[180,106,91,65,"message"],[180,113,91,72],[180,114,91,73,"id"],[180,116,91,75],[180,118,91,77],[180,119,91,78],[182,8,93,4],[183,8,94,4],[183,12,94,10,"snapshot"],[183,20,94,18],[183,29,94,27],[183,33,94,27,"get"],[183,50,94,30],[183,51,94,30,"get"],[183,54,94,30],[183,56,94,31,"messageRef"],[183,66,94,41],[183,67,94,42],[184,8,95,4],[184,12,95,8,"snapshot"],[184,20,95,16],[184,21,95,17,"exists"],[184,27,95,23],[184,28,95,24],[184,29,95,25],[184,31,95,27],[185,10,96,6],[185,17,96,13],[185,21,96,17],[186,8,97,4],[188,8,99,4],[189,8,100,4],[189,14,100,10],[189,18,100,10,"set"],[189,35,100,13],[189,36,100,13,"set"],[189,39,100,13],[189,41,100,14,"messageRef"],[189,51,100,24],[189,53,100,26],[190,10,101,6,"text"],[190,14,101,10],[190,16,101,12,"message"],[190,23,101,19],[190,24,101,20,"text"],[190,28,101,24],[191,10,102,6,"sender"],[191,16,102,12],[191,18,102,14,"message"],[191,25,102,21],[191,26,102,22,"sender"],[191,32,102,28],[192,10,103,6,"timestamp"],[192,19,103,15],[192,21,103,17,"message"],[192,28,103,24],[192,29,103,25,"timestamp"],[192,38,103,34],[193,10,104,6,"status"],[193,16,104,12],[193,18,104,14],[194,8,105,4],[194,9,105,5],[194,10,105,6],[196,8,107,4],[197,8,108,4],[197,12,108,10,"metaRef"],[197,19,108,17],[197,22,108,20],[197,26,108,20,"ref"],[197,43,108,23],[197,44,108,23,"ref"],[197,47,108,23],[197,49,108,24,"database"],[197,64,108,32],[197,65,108,32,"database"],[197,73,108,32],[197,75,108,34],[197,84,108,43,"chatId"],[197,90,108,49],[197,97,108,56],[197,98,108,57],[198,8,109,4],[198,14,109,10],[198,18,109,10,"set"],[198,35,109,13],[198,36,109,13,"set"],[198,39,109,13],[198,41,109,14,"metaRef"],[198,48,109,21],[198,50,109,23],[199,10,110,6,"lastMessage"],[199,21,110,17],[199,23,110,19,"message"],[199,30,110,26],[199,31,110,27,"text"],[199,35,110,31],[199,36,110,32,"substring"],[199,45,110,41],[199,46,110,42],[199,47,110,43],[199,49,110,45],[199,51,110,47],[199,52,110,48],[200,10,111,6,"lastTimestamp"],[200,23,111,19],[200,25,111,21,"message"],[200,32,111,28],[200,33,111,29,"timestamp"],[201,8,112,4],[201,9,112,5],[201,10,112,6],[202,8,114,4],[202,15,114,11],[202,19,114,15],[203,6,115,2],[203,7,115,3],[203,8,115,4],[203,15,115,11,"e"],[203,16,115,12],[203,18,115,14],[204,8,116,4],[204,15,116,11],[204,20,116,16],[205,6,117,2],[206,4,118,0],[206,5,118,1],[207,4,118,1],[207,20,86,13,"sendMessageToFirebase"],[207,41,86,34,"sendMessageToFirebase"],[207,42,86,34,"_x9"],[207,45,86,34],[207,47,86,34,"_x0"],[207,50,86,34],[208,6,86,34],[208,13,86,34,"_ref5"],[208,18,86,34],[208,19,86,34,"apply"],[208,24,86,34],[208,31,86,34,"arguments"],[208,40,86,34],[209,4,86,34],[210,2,86,34],[210,5,118,1],[212,2,120,0],[214,2,127,7],[214,6,127,13,"getMessageQueue"],[214,21,127,28],[215,4,127,28],[215,8,127,28,"_ref6"],[215,13,127,28],[215,20,127,28,"_asyncToGenerator"],[215,37,127,28],[215,38,127,28,"default"],[215,45,127,28],[215,47,127,31],[215,60,127,69],[216,6,128,2],[216,10,128,6],[217,8,129,4],[217,12,129,10,"data"],[217,16,129,14],[217,25,129,23,"AsyncStorage"],[217,37,129,35],[217,38,129,35,"default"],[217,45,129,35],[217,46,129,36,"getItem"],[217,53,129,43],[217,54,129,44,"QUEUE_KEY"],[217,63,129,53],[217,64,129,54],[218,8,130,4],[218,15,130,11,"data"],[218,19,130,15],[218,22,130,18,"JSON"],[218,26,130,22],[218,27,130,23,"parse"],[218,32,130,28],[218,33,130,29,"data"],[218,37,130,33],[218,38,130,34],[218,41,130,37],[218,43,130,39],[219,6,131,2],[219,7,131,3],[219,8,131,4],[219,15,131,11,"e"],[219,16,131,12],[219,18,131,14],[220,8,132,4],[220,15,132,11],[220,17,132,13],[221,6,133,2],[222,4,134,0],[222,5,134,1],[223,4,134,1],[223,20,127,13,"getMessageQueue"],[223,35,127,28,"getMessageQueue"],[223,36,127,28],[224,6,127,28],[224,13,127,28,"_ref6"],[224,18,127,28],[224,19,127,28,"apply"],[224,24,127,28],[224,31,127,28,"arguments"],[224,40,127,28],[225,4,127,28],[226,2,127,28],[226,5,134,1],[227,2,136,7],[227,6,136,13,"saveMessageQueue"],[227,22,136,29],[228,4,136,29],[228,8,136,29,"_ref7"],[228,13,136,29],[228,20,136,29,"_asyncToGenerator"],[228,37,136,29],[228,38,136,29,"default"],[228,45,136,29],[228,47,136,32],[228,58,136,39,"queue"],[228,63,136,61],[228,65,136,81],[229,6,137,2],[229,10,137,6],[230,8,138,4],[230,14,138,10,"AsyncStorage"],[230,26,138,22],[230,27,138,22,"default"],[230,34,138,22],[230,35,138,23,"setItem"],[230,42,138,30],[230,43,138,31,"QUEUE_KEY"],[230,52,138,40],[230,54,138,42,"JSON"],[230,58,138,46],[230,59,138,47,"stringify"],[230,68,138,56],[230,69,138,57,"queue"],[230,74,138,62],[230,75,138,63],[230,76,138,64],[231,6,139,2],[231,7,139,3],[231,8,139,4],[231,15,139,11,"e"],[231,16,139,12],[231,18,139,14],[232,8,140,4],[233,6,140,4],[234,4,142,0],[234,5,142,1],[235,4,142,1],[235,20,136,13,"saveMessageQueue"],[235,36,136,29,"saveMessageQueue"],[235,37,136,29,"_x1"],[235,40,136,29],[236,6,136,29],[236,13,136,29,"_ref7"],[236,18,136,29],[236,19,136,29,"apply"],[236,24,136,29],[236,31,136,29,"arguments"],[236,40,136,29],[237,4,136,29],[238,2,136,29],[238,5,142,1],[239,2,144,7],[239,6,144,13,"addToQueue"],[239,16,144,23],[240,4,144,23],[240,8,144,23,"_ref8"],[240,13,144,23],[240,20,144,23,"_asyncToGenerator"],[240,37,144,23],[240,38,144,23,"default"],[240,45,144,23],[240,47,144,26],[240,58,144,33,"chatId"],[240,64,144,47],[240,66,144,49,"message"],[240,73,144,65],[240,75,144,85],[241,6,145,2],[241,10,145,8,"queue"],[241,15,145,13],[241,24,145,22,"getMessageQueue"],[241,39,145,37],[241,40,145,38],[241,41,145,39],[242,6,146,2],[243,6,147,2],[243,10,147,8,"exists"],[243,16,147,14],[243,19,147,17,"queue"],[243,24,147,22],[243,25,147,23,"find"],[243,29,147,27],[243,30,147,28,"q"],[243,31,147,29],[243,35,147,33,"q"],[243,36,147,34],[243,37,147,35,"message"],[243,44,147,42],[243,45,147,43,"id"],[243,47,147,45],[243,52,147,50,"message"],[243,59,147,57],[243,60,147,58,"id"],[243,62,147,60],[243,63,147,61],[244,6,148,2],[244,10,148,6],[244,11,148,7,"exists"],[244,17,148,13],[244,19,148,15],[245,8,149,4,"queue"],[245,13,149,9],[245,14,149,10,"push"],[245,18,149,14],[245,19,149,15],[246,10,149,17,"chatId"],[246,16,149,23],[247,10,149,25,"message"],[247,17,149,32],[248,10,149,34,"retryCount"],[248,20,149,44],[248,22,149,46],[249,8,149,48],[249,9,149,49],[249,10,149,50],[250,8,150,4],[250,14,150,10,"saveMessageQueue"],[250,30,150,26],[250,31,150,27,"queue"],[250,36,150,32],[250,37,150,33],[251,6,151,2],[252,4,152,0],[252,5,152,1],[253,4,152,1],[253,20,144,13,"addToQueue"],[253,30,144,23,"addToQueue"],[253,31,144,23,"_x10"],[253,35,144,23],[253,37,144,23,"_x11"],[253,41,144,23],[254,6,144,23],[254,13,144,23,"_ref8"],[254,18,144,23],[254,19,144,23,"apply"],[254,24,144,23],[254,31,144,23,"arguments"],[254,40,144,23],[255,4,144,23],[256,2,144,23],[256,5,152,1],[257,2,154,7],[257,6,154,13,"removeFromQueue"],[257,21,154,28],[258,4,154,28],[258,8,154,28,"_ref9"],[258,13,154,28],[258,20,154,28,"_asyncToGenerator"],[258,37,154,28],[258,38,154,28,"default"],[258,45,154,28],[258,47,154,31],[258,58,154,38,"messageId"],[258,67,154,55],[258,69,154,75],[259,6,155,2],[259,10,155,8,"queue"],[259,15,155,13],[259,24,155,22,"getMessageQueue"],[259,39,155,37],[259,40,155,38],[259,41,155,39],[260,6,156,2],[260,10,156,8,"filtered"],[260,18,156,16],[260,21,156,19,"queue"],[260,26,156,24],[260,27,156,25,"filter"],[260,33,156,31],[260,34,156,32,"q"],[260,35,156,33],[260,39,156,37,"q"],[260,40,156,38],[260,41,156,39,"message"],[260,48,156,46],[260,49,156,47,"id"],[260,51,156,49],[260,56,156,54,"messageId"],[260,65,156,63],[260,66,156,64],[261,6,157,2],[261,12,157,8,"saveMessageQueue"],[261,28,157,24],[261,29,157,25,"filtered"],[261,37,157,33],[261,38,157,34],[262,4,158,0],[262,5,158,1],[263,4,158,1],[263,20,154,13,"removeFromQueue"],[263,35,154,28,"removeFromQueue"],[263,36,154,28,"_x12"],[263,40,154,28],[264,6,154,28],[264,13,154,28,"_ref9"],[264,18,154,28],[264,19,154,28,"apply"],[264,24,154,28],[264,31,154,28,"arguments"],[264,40,154,28],[265,4,154,28],[266,2,154,28],[266,5,158,1],[268,2,160,0],[269,2,161,0],[270,2,162,7],[270,6,162,13,"subscribeToNewMessages"],[270,28,162,35],[270,31,162,38,"subscribeToNewMessages"],[270,32,163,2,"chatId"],[270,38,163,16],[270,40,164,2,"lastTimestamp"],[270,53,164,23],[270,55,165,2,"onNewMessage"],[270,67,165,42],[270,69,166,2,"knownMessageIds"],[270,84,166,30],[270,89,167,19],[271,4,168,2],[272,4,169,2],[272,8,169,6,"activeListeners"],[272,23,169,21],[272,24,169,22,"get"],[272,27,169,25],[272,28,169,26,"chatId"],[272,34,169,32],[272,35,169,33],[272,37,169,35],[273,6,170,4],[273,13,170,11],[273,19,170,17],[273,20,170,18],[273,21,170,19],[274,4,171,2],[275,4,173,2],[275,8,173,8,"messagesRef"],[275,19,173,19],[275,22,173,22],[275,26,173,22,"ref"],[275,43,173,25],[275,44,173,25,"ref"],[275,47,173,25],[275,49,173,26,"database"],[275,64,173,34],[275,65,173,34,"database"],[275,73,173,34],[275,75,173,36],[275,84,173,45,"chatId"],[275,90,173,51],[275,101,173,62],[275,102,173,63],[277,4,175,2],[278,4,176,2,"activeListeners"],[278,19,176,17],[278,20,176,18,"set"],[278,23,176,21],[278,24,176,22,"chatId"],[278,30,176,28],[278,32,176,30],[278,36,176,34],[278,37,176,35],[280,4,178,2],[281,4,179,2],[281,8,179,8,"messagesQuery"],[281,21,179,21],[281,24,179,24],[281,28,179,24,"query"],[281,45,179,29],[281,46,179,29,"query"],[281,51,179,29],[281,53,180,4,"messagesRef"],[281,64,180,15],[281,66,181,4],[281,70,181,4,"orderByChild"],[281,87,181,16],[281,88,181,16,"orderByChild"],[281,100,181,16],[281,102,181,17],[281,113,181,28],[281,114,181,29],[281,116,182,4],[281,120,182,4,"startAt"],[281,137,182,11],[281,138,182,11,"startAt"],[281,145,182,11],[281,147,182,12,"lastTimestamp"],[281,160,182,25],[281,163,182,28],[281,164,182,29],[281,165,182,30],[281,167,183,4],[281,171,183,4,"limitToLast"],[281,188,183,15],[281,189,183,15,"limitToLast"],[281,200,183,15],[281,202,183,16],[281,204,183,18],[281,205,184,2],[281,206,184,3],[282,4,186,2],[282,8,186,2,"onChildAdded"],[282,25,186,14],[282,26,186,14,"onChildAdded"],[282,38,186,14],[282,40,186,15,"messagesQuery"],[282,53,186,28],[282,55,186,31,"snapshot"],[282,63,186,39],[282,67,186,44],[283,6,187,4],[283,10,187,8,"snapshot"],[283,18,187,16],[283,19,187,17,"exists"],[283,25,187,23],[283,26,187,24],[283,27,187,25],[283,29,187,27],[284,8,188,6],[284,12,188,12,"messageId"],[284,21,188,21],[284,24,188,24,"snapshot"],[284,32,188,32],[284,33,188,33,"key"],[284,36,188,36],[284,40,188,40],[284,42,188,42],[286,8,190,6],[287,8,191,6],[287,12,191,10,"knownMessageIds"],[287,27,191,25],[287,28,191,26,"has"],[287,31,191,29],[287,32,191,30,"messageId"],[287,41,191,39],[287,42,191,40],[287,44,191,42],[288,10,192,8],[289,8,193,6],[290,8,195,6],[290,12,195,12,"data"],[290,16,195,16],[290,19,195,19,"snapshot"],[290,27,195,27],[290,28,195,28,"val"],[290,31,195,31],[290,32,195,32],[290,33,195,33],[291,8,196,6],[291,12,196,12,"message"],[291,19,196,28],[291,22,196,31],[292,10,197,8,"id"],[292,12,197,10],[292,14,197,12,"messageId"],[292,23,197,21],[293,10,198,8,"text"],[293,14,198,12],[293,16,198,14,"data"],[293,20,198,18],[293,21,198,19,"text"],[293,25,198,23],[294,10,199,8,"sender"],[294,16,199,14],[294,18,199,16,"data"],[294,22,199,20],[294,23,199,21,"sender"],[294,29,199,27],[295,10,200,8,"timestamp"],[295,19,200,17],[295,21,200,19,"data"],[295,25,200,23],[295,26,200,24,"timestamp"],[295,35,200,33],[296,10,201,8,"status"],[296,16,201,14],[296,18,201,16],[297,8,202,6],[297,9,202,7],[298,8,203,6,"onNewMessage"],[298,20,203,18],[298,21,203,19,"message"],[298,28,203,26],[298,29,203,27],[299,6,204,4],[300,4,205,2],[300,5,205,3],[300,6,205,4],[302,4,207,2],[303,4,208,2],[303,11,208,9],[303,17,208,15],[304,6,209,4],[304,10,209,4,"off"],[304,27,209,7],[304,28,209,7,"off"],[304,31,209,7],[304,33,209,8,"messagesRef"],[304,44,209,19],[304,45,209,20],[305,6,210,4,"activeListeners"],[305,21,210,19],[305,22,210,20,"delete"],[305,28,210,26],[305,29,210,27,"chatId"],[305,35,210,33],[305,36,210,34],[306,4,211,2],[306,5,211,3],[307,2,212,0],[307,3,212,1],[308,0,212,2],[308,3]],"functionMap":{"names":["<global>","generateMessageId","getChatId","saveMessagesLocally","getLocalMessages","addMessageLocally","messages.find$argument_0","updateMessageStatusLocally","messages.findIndex$argument_0","sendMessageToFirebase","getMessageQueue","saveMessageQueue","addToQueue","queue.find$argument_0","removeFromQueue","queue.filter$argument_0","subscribeToNewMessages","<anonymous>","onChildAdded$argument_1"],"mappings":"AAA;iCCqB;CDE;yBEG;CFG;mCGG;CHM;gCIG;CJO;iCKG;iCCG,wBD;CLU;0COG;qCCO,uBD;CPQ;qCSG;CTgC;+BUS;CVO;gCWE;CXM;0BYE;4BCG,gCD;CZK;+BcE;gCCE,+BD;CdE;sCgBI;WCQ,QD;8BEgB;GFmB;SCG;GDG;ChBC"},"hasCjsExports":false},"type":"js/module"}]}