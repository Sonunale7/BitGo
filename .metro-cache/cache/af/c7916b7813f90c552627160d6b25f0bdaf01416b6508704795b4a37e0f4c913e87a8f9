{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":65,"index":65}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/AppState","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"JfCM6WRyn2619+pzBJhEHd1+SSw=","exportNames":["*"],"imports":1}},{"name":"./messageService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":107},"end":{"line":9,"column":26,"index":251}}],"key":"UmoAEzy9/zGUVoH0kindHZPFRR0=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"processQueue\", {\n    enumerable: true,\n    get: function () {\n      return processQueue;\n    }\n  });\n  Object.defineProperty(exports, \"useMessageQueueProcessor\", {\n    enumerable: true,\n    get: function () {\n      return useMessageQueueProcessor;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeWebDistExportsAppState = require(_dependencyMap[1], \"react-native-web/dist/exports/AppState\");\n  var AppState = _interopDefault(_reactNativeWebDistExportsAppState);\n  var _messageService = require(_dependencyMap[2], \"./messageService\");\n  const RETRY_INTERVAL = 3000; // 3 seconds\n  const MAX_RETRIES = 10;\n\n  // Simple network check by attempting a small fetch\n  const checkNetwork = async () => {\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 2000);\n      await fetch('https://www.google.com/generate_204', {\n        method: 'HEAD',\n        signal: controller.signal\n      });\n      clearTimeout(timeoutId);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  };\n\n  // Process queued messages\n  const processQueue = async onStatusUpdate => {\n    const queue = await (0, _messageService.getMessageQueue)();\n    let successCount = 0;\n    for (const item of queue) {\n      const success = await (0, _messageService.sendMessageToFirebase)(item.chatId, item.message);\n      if (success) {\n        await (0, _messageService.removeFromQueue)(item.message.id);\n        await (0, _messageService.updateMessageStatusLocally)(item.chatId, item.message.id, 'sent');\n        onStatusUpdate?.(item.message.id, item.chatId, 'sent');\n        successCount++;\n      } else if (item.retryCount >= MAX_RETRIES) {\n        // Mark as failed after max retries\n        await (0, _messageService.updateMessageStatusLocally)(item.chatId, item.message.id, 'failed');\n        await (0, _messageService.removeFromQueue)(item.message.id);\n      }\n    }\n    return successCount;\n  };\n\n  // Hook for managing queue retry\n  const useMessageQueueProcessor = onStatusUpdate => {\n    const [isOnline, setIsOnline] = (0, _react.useState)(true);\n    const [queueLength, setQueueLength] = (0, _react.useState)(0);\n    const retryIntervalRef = (0, _react.useRef)(null);\n    const processAndUpdate = (0, _react.useCallback)(async () => {\n      const online = await checkNetwork();\n      setIsOnline(online);\n      if (online) {\n        await processQueue(onStatusUpdate);\n      }\n      const queue = await (0, _messageService.getMessageQueue)();\n      setQueueLength(queue.length);\n    }, [onStatusUpdate]);\n    (0, _react.useEffect)(() => {\n      // Initial check\n      processAndUpdate();\n\n      // Set up retry interval\n      retryIntervalRef.current = setInterval(processAndUpdate, RETRY_INTERVAL);\n\n      // Listen for app state changes\n      const subscription = AppState.default.addEventListener('change', state => {\n        if (state === 'active') {\n          processAndUpdate();\n        }\n      });\n      return () => {\n        if (retryIntervalRef.current) {\n          clearInterval(retryIntervalRef.current);\n        }\n        subscription.remove();\n      };\n    }, [processAndUpdate]);\n    return {\n      isOnline,\n      queueLength,\n      processQueue: processAndUpdate\n    };\n  };\n});","lineCount":107,"map":[[12,2,33,0,"Object"],[12,8,33,0],[12,9,33,0,"defineProperty"],[12,23,33,0],[12,24,33,0,"exports"],[12,31,33,0],[13,4,33,0,"enumerable"],[13,14,33,0],[14,4,33,0,"get"],[14,7,33,0],[14,18,33,0,"get"],[14,19,33,0],[15,6,33,0],[15,13,33,0,"processQueue"],[15,25,33,0],[16,4,33,0],[17,2,33,0],[18,2,58,0,"Object"],[18,8,58,0],[18,9,58,0,"defineProperty"],[18,23,58,0],[18,24,58,0,"exports"],[18,31,58,0],[19,4,58,0,"enumerable"],[19,14,58,0],[20,4,58,0,"get"],[20,7,58,0],[20,18,58,0,"get"],[20,19,58,0],[21,6,58,0],[21,13,58,0,"useMessageQueueProcessor"],[21,37,58,0],[22,4,58,0],[23,2,58,0],[24,2,1,0],[24,6,1,0,"_react"],[24,12,1,0],[24,15,1,0,"require"],[24,22,1,0],[24,23,1,0,"_dependencyMap"],[24,37,1,0],[25,2,1,65],[25,6,1,65,"_reactNativeWebDistExportsAppState"],[25,40,1,65],[25,43,1,65,"require"],[25,50,1,65],[25,51,1,65,"_dependencyMap"],[25,65,1,65],[26,2,1,65],[26,6,1,65,"AppState"],[26,14,1,65],[26,17,1,65,"_interopDefault"],[26,32,1,65],[26,33,1,65,"_reactNativeWebDistExportsAppState"],[26,67,1,65],[27,2,3,0],[27,6,3,0,"_messageService"],[27,21,3,0],[27,24,3,0,"require"],[27,31,3,0],[27,32,3,0,"_dependencyMap"],[27,46,3,0],[28,2,11,0],[28,8,11,6,"RETRY_INTERVAL"],[28,22,11,20],[28,25,11,23],[28,29,11,27],[28,30,11,28],[28,31,11,29],[29,2,12,0],[29,8,12,6,"MAX_RETRIES"],[29,19,12,17],[29,22,12,20],[29,24,12,22],[31,2,14,0],[32,2,15,0],[32,8,15,6,"checkNetwork"],[32,20,15,18],[32,23,15,21],[32,29,15,21,"checkNetwork"],[32,30,15,21],[32,35,15,51],[33,4,16,2],[33,8,16,6],[34,6,17,4],[34,12,17,10,"controller"],[34,22,17,20],[34,25,17,23],[34,29,17,27,"AbortController"],[34,44,17,42],[34,45,17,43],[34,46,17,44],[35,6,18,4],[35,12,18,10,"timeoutId"],[35,21,18,19],[35,24,18,22,"setTimeout"],[35,34,18,32],[35,35,18,33],[35,41,18,39,"controller"],[35,51,18,49],[35,52,18,50,"abort"],[35,57,18,55],[35,58,18,56],[35,59,18,57],[35,61,18,59],[35,65,18,63],[35,66,18,64],[36,6,20,4],[36,12,20,10,"fetch"],[36,17,20,15],[36,18,20,16],[36,55,20,53],[36,57,20,55],[37,8,21,6,"method"],[37,14,21,12],[37,16,21,14],[37,22,21,20],[38,8,22,6,"signal"],[38,14,22,12],[38,16,22,14,"controller"],[38,26,22,24],[38,27,22,25,"signal"],[39,6,23,4],[39,7,23,5],[39,8,23,6],[40,6,25,4,"clearTimeout"],[40,18,25,16],[40,19,25,17,"timeoutId"],[40,28,25,26],[40,29,25,27],[41,6,26,4],[41,13,26,11],[41,17,26,15],[42,4,27,2],[42,5,27,3],[42,6,27,4],[42,13,27,11,"e"],[42,14,27,12],[42,16,27,14],[43,6,28,4],[43,13,28,11],[43,18,28,16],[44,4,29,2],[45,2,30,0],[45,3,30,1],[47,2,32,0],[48,2,33,7],[48,8,33,13,"processQueue"],[48,20,33,25],[48,23,33,28],[48,29,34,2,"onStatusUpdate"],[48,43,34,89],[48,47,35,22],[49,4,36,2],[49,10,36,8,"queue"],[49,15,36,13],[49,18,36,16],[49,24,36,22],[49,28,36,22,"getMessageQueue"],[49,43,36,37],[49,44,36,37,"getMessageQueue"],[49,59,36,37],[49,61,36,38],[49,62,36,39],[50,4,37,2],[50,8,37,6,"successCount"],[50,20,37,18],[50,23,37,21],[50,24,37,22],[51,4,39,2],[51,9,39,7],[51,15,39,13,"item"],[51,19,39,17],[51,23,39,21,"queue"],[51,28,39,26],[51,30,39,28],[52,6,40,4],[52,12,40,10,"success"],[52,19,40,17],[52,22,40,20],[52,28,40,26],[52,32,40,26,"sendMessageToFirebase"],[52,47,40,47],[52,48,40,47,"sendMessageToFirebase"],[52,69,40,47],[52,71,40,48,"item"],[52,75,40,52],[52,76,40,53,"chatId"],[52,82,40,59],[52,84,40,61,"item"],[52,88,40,65],[52,89,40,66,"message"],[52,96,40,73],[52,97,40,74],[53,6,42,4],[53,10,42,8,"success"],[53,17,42,15],[53,19,42,17],[54,8,43,6],[54,14,43,12],[54,18,43,12,"removeFromQueue"],[54,33,43,27],[54,34,43,27,"removeFromQueue"],[54,49,43,27],[54,51,43,28,"item"],[54,55,43,32],[54,56,43,33,"message"],[54,63,43,40],[54,64,43,41,"id"],[54,66,43,43],[54,67,43,44],[55,8,44,6],[55,14,44,12],[55,18,44,12,"updateMessageStatusLocally"],[55,33,44,38],[55,34,44,38,"updateMessageStatusLocally"],[55,60,44,38],[55,62,44,39,"item"],[55,66,44,43],[55,67,44,44,"chatId"],[55,73,44,50],[55,75,44,52,"item"],[55,79,44,56],[55,80,44,57,"message"],[55,87,44,64],[55,88,44,65,"id"],[55,90,44,67],[55,92,44,69],[55,98,44,75],[55,99,44,76],[56,8,45,6,"onStatusUpdate"],[56,22,45,20],[56,25,45,23,"item"],[56,29,45,27],[56,30,45,28,"message"],[56,37,45,35],[56,38,45,36,"id"],[56,40,45,38],[56,42,45,40,"item"],[56,46,45,44],[56,47,45,45,"chatId"],[56,53,45,51],[56,55,45,53],[56,61,45,59],[56,62,45,60],[57,8,46,6,"successCount"],[57,20,46,18],[57,22,46,20],[58,6,47,4],[58,7,47,5],[58,13,47,11],[58,17,47,15,"item"],[58,21,47,19],[58,22,47,20,"retryCount"],[58,32,47,30],[58,36,47,34,"MAX_RETRIES"],[58,47,47,45],[58,49,47,47],[59,8,48,6],[60,8,49,6],[60,14,49,12],[60,18,49,12,"updateMessageStatusLocally"],[60,33,49,38],[60,34,49,38,"updateMessageStatusLocally"],[60,60,49,38],[60,62,49,39,"item"],[60,66,49,43],[60,67,49,44,"chatId"],[60,73,49,50],[60,75,49,52,"item"],[60,79,49,56],[60,80,49,57,"message"],[60,87,49,64],[60,88,49,65,"id"],[60,90,49,67],[60,92,49,69],[60,100,49,77],[60,101,49,78],[61,8,50,6],[61,14,50,12],[61,18,50,12,"removeFromQueue"],[61,33,50,27],[61,34,50,27,"removeFromQueue"],[61,49,50,27],[61,51,50,28,"item"],[61,55,50,32],[61,56,50,33,"message"],[61,63,50,40],[61,64,50,41,"id"],[61,66,50,43],[61,67,50,44],[62,6,51,4],[63,4,52,2],[64,4,54,2],[64,11,54,9,"successCount"],[64,23,54,21],[65,2,55,0],[65,3,55,1],[67,2,57,0],[68,2,58,7],[68,8,58,13,"useMessageQueueProcessor"],[68,32,58,37],[68,35,59,2,"onStatusUpdate"],[68,49,59,89],[68,53,60,5],[69,4,61,2],[69,10,61,8],[69,11,61,9,"isOnline"],[69,19,61,17],[69,21,61,19,"setIsOnline"],[69,32,61,30],[69,33,61,31],[69,36,61,34],[69,40,61,34,"useState"],[69,46,61,42],[69,47,61,42,"useState"],[69,55,61,42],[69,57,61,43],[69,61,61,47],[69,62,61,48],[70,4,62,2],[70,10,62,8],[70,11,62,9,"queueLength"],[70,22,62,20],[70,24,62,22,"setQueueLength"],[70,38,62,36],[70,39,62,37],[70,42,62,40],[70,46,62,40,"useState"],[70,52,62,48],[70,53,62,48,"useState"],[70,61,62,48],[70,63,62,49],[70,64,62,50],[70,65,62,51],[71,4,63,2],[71,10,63,8,"retryIntervalRef"],[71,26,63,24],[71,29,63,27],[71,33,63,27,"useRef"],[71,39,63,33],[71,40,63,33,"useRef"],[71,46,63,33],[71,48,63,57],[71,52,63,61],[71,53,63,62],[72,4,65,2],[72,10,65,8,"processAndUpdate"],[72,26,65,24],[72,29,65,27],[72,33,65,27,"useCallback"],[72,39,65,38],[72,40,65,38,"useCallback"],[72,51,65,38],[72,53,65,39],[72,65,65,51],[73,6,66,4],[73,12,66,10,"online"],[73,18,66,16],[73,21,66,19],[73,27,66,25,"checkNetwork"],[73,39,66,37],[73,40,66,38],[73,41,66,39],[74,6,67,4,"setIsOnline"],[74,17,67,15],[74,18,67,16,"online"],[74,24,67,22],[74,25,67,23],[75,6,69,4],[75,10,69,8,"online"],[75,16,69,14],[75,18,69,16],[76,8,70,6],[76,14,70,12,"processQueue"],[76,26,70,24],[76,27,70,25,"onStatusUpdate"],[76,41,70,39],[76,42,70,40],[77,6,71,4],[78,6,73,4],[78,12,73,10,"queue"],[78,17,73,15],[78,20,73,18],[78,26,73,24],[78,30,73,24,"getMessageQueue"],[78,45,73,39],[78,46,73,39,"getMessageQueue"],[78,61,73,39],[78,63,73,40],[78,64,73,41],[79,6,74,4,"setQueueLength"],[79,20,74,18],[79,21,74,19,"queue"],[79,26,74,24],[79,27,74,25,"length"],[79,33,74,31],[79,34,74,32],[80,4,75,2],[80,5,75,3],[80,7,75,5],[80,8,75,6,"onStatusUpdate"],[80,22,75,20],[80,23,75,21],[80,24,75,22],[81,4,77,2],[81,8,77,2,"useEffect"],[81,14,77,11],[81,15,77,11,"useEffect"],[81,24,77,11],[81,26,77,12],[81,32,77,18],[82,6,78,4],[83,6,79,4,"processAndUpdate"],[83,22,79,20],[83,23,79,21],[83,24,79,22],[85,6,81,4],[86,6,82,4,"retryIntervalRef"],[86,22,82,20],[86,23,82,21,"current"],[86,30,82,28],[86,33,82,31,"setInterval"],[86,44,82,42],[86,45,82,43,"processAndUpdate"],[86,61,82,59],[86,63,82,61,"RETRY_INTERVAL"],[86,77,82,75],[86,78,82,76],[88,6,84,4],[89,6,85,4],[89,12,85,10,"subscription"],[89,24,85,22],[89,27,85,25,"AppState"],[89,35,85,33],[89,36,85,33,"default"],[89,43,85,33],[89,44,85,34,"addEventListener"],[89,60,85,50],[89,61,85,51],[89,69,85,59],[89,71,85,62,"state"],[89,76,85,67],[89,80,85,72],[90,8,86,6],[90,12,86,10,"state"],[90,17,86,15],[90,22,86,20],[90,30,86,28],[90,32,86,30],[91,10,87,8,"processAndUpdate"],[91,26,87,24],[91,27,87,25],[91,28,87,26],[92,8,88,6],[93,6,89,4],[93,7,89,5],[93,8,89,6],[94,6,91,4],[94,13,91,11],[94,19,91,17],[95,8,92,6],[95,12,92,10,"retryIntervalRef"],[95,28,92,26],[95,29,92,27,"current"],[95,36,92,34],[95,38,92,36],[96,10,93,8,"clearInterval"],[96,23,93,21],[96,24,93,22,"retryIntervalRef"],[96,40,93,38],[96,41,93,39,"current"],[96,48,93,46],[96,49,93,47],[97,8,94,6],[98,8,95,6,"subscription"],[98,20,95,18],[98,21,95,19,"remove"],[98,27,95,25],[98,28,95,26],[98,29,95,27],[99,6,96,4],[99,7,96,5],[100,4,97,2],[100,5,97,3],[100,7,97,5],[100,8,97,6,"processAndUpdate"],[100,24,97,22],[100,25,97,23],[100,26,97,24],[101,4,99,2],[101,11,99,9],[102,6,99,11,"isOnline"],[102,14,99,19],[103,6,99,21,"queueLength"],[103,17,99,32],[104,6,99,34,"processQueue"],[104,18,99,46],[104,20,99,48,"processAndUpdate"],[105,4,99,65],[105,5,99,66],[106,2,100,0],[106,3,100,1],[107,0,100,2],[107,3]],"functionMap":{"names":["<global>","checkNetwork","setTimeout$argument_0","processQueue","useMessageQueueProcessor","processAndUpdate","useEffect$argument_0","AppState.addEventListener$argument_1","<anonymous>"],"mappings":"AAA;qBCc;iCCG,wBD;CDY;4BGG;CHsB;wCIG;uCCO;GDU;YEE;6DCQ;KDI;WEE;KFK;GFC;CJG"},"hasCjsExports":false},"type":"js/module"}]}