{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"firebase/database","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":135,"index":135}}],"key":"ZF/J3nfk5GUgbzXl84BqV1IxYEE=","exportNames":["*"],"imports":1}},{"name":"../config/firebase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":136},"end":{"line":2,"column":46,"index":182}}],"key":"K/SZPG5sPeV1upVh8dao26aG7MQ=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":183},"end":{"line":3,"column":69,"index":252}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"generateMessageId\", {\n    enumerable: true,\n    get: function () {\n      return generateMessageId;\n    }\n  });\n  Object.defineProperty(exports, \"getChatId\", {\n    enumerable: true,\n    get: function () {\n      return getChatId;\n    }\n  });\n  Object.defineProperty(exports, \"saveMessagesLocally\", {\n    enumerable: true,\n    get: function () {\n      return saveMessagesLocally;\n    }\n  });\n  Object.defineProperty(exports, \"getLocalMessages\", {\n    enumerable: true,\n    get: function () {\n      return getLocalMessages;\n    }\n  });\n  Object.defineProperty(exports, \"addMessageLocally\", {\n    enumerable: true,\n    get: function () {\n      return addMessageLocally;\n    }\n  });\n  Object.defineProperty(exports, \"updateMessageStatusLocally\", {\n    enumerable: true,\n    get: function () {\n      return updateMessageStatusLocally;\n    }\n  });\n  Object.defineProperty(exports, \"sendMessageToFirebase\", {\n    enumerable: true,\n    get: function () {\n      return sendMessageToFirebase;\n    }\n  });\n  Object.defineProperty(exports, \"getMessageQueue\", {\n    enumerable: true,\n    get: function () {\n      return getMessageQueue;\n    }\n  });\n  Object.defineProperty(exports, \"saveMessageQueue\", {\n    enumerable: true,\n    get: function () {\n      return saveMessageQueue;\n    }\n  });\n  Object.defineProperty(exports, \"addToQueue\", {\n    enumerable: true,\n    get: function () {\n      return addToQueue;\n    }\n  });\n  Object.defineProperty(exports, \"removeFromQueue\", {\n    enumerable: true,\n    get: function () {\n      return removeFromQueue;\n    }\n  });\n  Object.defineProperty(exports, \"subscribeToNewMessages\", {\n    enumerable: true,\n    get: function () {\n      return subscribeToNewMessages;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _firebaseDatabase = require(_dependencyMap[1], \"firebase/database\");\n  var _configFirebase = require(_dependencyMap[2], \"../config/firebase\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[3], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var QUEUE_KEY = '@bitgo_message_queue';\n  var MESSAGES_KEY = '@bitgo_messages_';\n\n  // Track active listeners to prevent duplicates\n  var activeListeners = new Map();\n\n  // Generate unique message ID locally\n  var generateMessageId = () => {\n    return `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  };\n\n  // Get chat ID from two user phones (sorted for consistency)\n  var getChatId = (phone1, phone2) => {\n    var sorted = [phone1, phone2].sort();\n    return `${sorted[0]}_${sorted[1]}`;\n  };\n\n  // Save messages locally for a chat\n  var saveMessagesLocally = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator.default)(function* (chatId, messages) {\n      try {\n        yield AsyncStorage.default.setItem(MESSAGES_KEY + chatId, JSON.stringify(messages));\n      } catch (e) {\n        // Silent fail in production\n      }\n    });\n    return function saveMessagesLocally(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  // Get messages from local storage\n  var getLocalMessages = /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator.default)(function* (chatId) {\n      try {\n        var data = yield AsyncStorage.default.getItem(MESSAGES_KEY + chatId);\n        return data ? JSON.parse(data) : [];\n      } catch (e) {\n        return [];\n      }\n    });\n    return function getLocalMessages(_x3) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  // Add single message to local storage\n  var addMessageLocally = /*#__PURE__*/function () {\n    var _ref3 = (0, _asyncToGenerator.default)(function* (chatId, message) {\n      try {\n        var messages = yield getLocalMessages(chatId);\n        var exists = messages.find(m => m.id === message.id);\n        if (!exists) {\n          messages.push(message);\n          // Keep only last 100 messages locally\n          var trimmed = messages.slice(-100);\n          yield saveMessagesLocally(chatId, trimmed);\n        }\n      } catch (e) {\n        // Silent fail in production\n      }\n    });\n    return function addMessageLocally(_x4, _x5) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  // Update message status locally\n  var updateMessageStatusLocally = /*#__PURE__*/function () {\n    var _ref4 = (0, _asyncToGenerator.default)(function* (chatId, messageId, status) {\n      try {\n        var messages = yield getLocalMessages(chatId);\n        var index = messages.findIndex(m => m.id === messageId);\n        if (index !== -1) {\n          messages[index].status = status;\n          yield saveMessagesLocally(chatId, messages);\n        }\n      } catch (e) {\n        // Silent fail in production\n      }\n    });\n    return function updateMessageStatusLocally(_x6, _x7, _x8) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  // Send message to Firebase (minimal payload) - checks for duplicate before writing\n  var sendMessageToFirebase = /*#__PURE__*/function () {\n    var _ref5 = (0, _asyncToGenerator.default)(function* (chatId, message) {\n      try {\n        var messageRef = (0, _firebaseDatabase.ref)(_configFirebase.database, `chats/${chatId}/messages/${message.id}`);\n\n        // Check if message already exists (prevent duplicates on retry)\n        var snapshot = yield (0, _firebaseDatabase.get)(messageRef);\n        if (snapshot.exists()) {\n          return true;\n        }\n\n        // Minimal payload only - text, sender, timestamp, status\n        yield (0, _firebaseDatabase.set)(messageRef, {\n          text: message.text,\n          sender: message.sender,\n          timestamp: message.timestamp,\n          status: 'sent'\n        });\n        return true;\n      } catch (e) {\n        return false;\n      }\n    });\n    return function sendMessageToFirebase(_x9, _x0) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  // Queue management for offline messages\n\n  var getMessageQueue = /*#__PURE__*/function () {\n    var _ref6 = (0, _asyncToGenerator.default)(function* () {\n      try {\n        var data = yield AsyncStorage.default.getItem(QUEUE_KEY);\n        return data ? JSON.parse(data) : [];\n      } catch (e) {\n        return [];\n      }\n    });\n    return function getMessageQueue() {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  var saveMessageQueue = /*#__PURE__*/function () {\n    var _ref7 = (0, _asyncToGenerator.default)(function* (queue) {\n      try {\n        yield AsyncStorage.default.setItem(QUEUE_KEY, JSON.stringify(queue));\n      } catch (e) {\n        // Silent fail in production\n      }\n    });\n    return function saveMessageQueue(_x1) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n  var addToQueue = /*#__PURE__*/function () {\n    var _ref8 = (0, _asyncToGenerator.default)(function* (chatId, message) {\n      var queue = yield getMessageQueue();\n      // Check if already in queue\n      var exists = queue.find(q => q.message.id === message.id);\n      if (!exists) {\n        queue.push({\n          chatId,\n          message,\n          retryCount: 0\n        });\n        yield saveMessageQueue(queue);\n      }\n    });\n    return function addToQueue(_x10, _x11) {\n      return _ref8.apply(this, arguments);\n    };\n  }();\n  var removeFromQueue = /*#__PURE__*/function () {\n    var _ref9 = (0, _asyncToGenerator.default)(function* (messageId) {\n      var queue = yield getMessageQueue();\n      var filtered = queue.filter(q => q.message.id !== messageId);\n      yield saveMessageQueue(filtered);\n    });\n    return function removeFromQueue(_x12) {\n      return _ref9.apply(this, arguments);\n    };\n  }();\n\n  // Subscribe to new messages only (efficient listener with limitToLast)\n  // Prevents duplicate listeners per chatId\n  var subscribeToNewMessages = (chatId, lastTimestamp, onNewMessage, knownMessageIds) => {\n    // Prevent duplicate listeners for same chatId\n    if (activeListeners.get(chatId)) {\n      return () => {};\n    }\n    var messagesRef = (0, _firebaseDatabase.ref)(_configFirebase.database, `chats/${chatId}/messages`);\n\n    // Mark listener as active\n    activeListeners.set(chatId, true);\n\n    // Use limitToLast(30) to reduce data load on weak connections\n    var messagesQuery = (0, _firebaseDatabase.query)(messagesRef, (0, _firebaseDatabase.orderByChild)('timestamp'), (0, _firebaseDatabase.startAt)(lastTimestamp + 1), (0, _firebaseDatabase.limitToLast)(30));\n    (0, _firebaseDatabase.onChildAdded)(messagesQuery, snapshot => {\n      if (snapshot.exists()) {\n        var messageId = snapshot.key || '';\n\n        // Skip if we already have this message (prevent duplicates)\n        if (knownMessageIds.has(messageId)) {\n          return;\n        }\n        var data = snapshot.val();\n        var message = {\n          id: messageId,\n          text: data.text,\n          sender: data.sender,\n          timestamp: data.timestamp,\n          status: 'sent'\n        };\n        onNewMessage(message);\n      }\n    });\n\n    // Return unsubscribe function that cleans up properly\n    return () => {\n      (0, _firebaseDatabase.off)(messagesRef);\n      activeListeners.delete(chatId);\n    };\n  };\n});","lineCount":301,"map":[[12,2,22,0,"Object"],[12,8,22,0],[12,9,22,0,"defineProperty"],[12,23,22,0],[12,24,22,0,"exports"],[12,31,22,0],[13,4,22,0,"enumerable"],[13,14,22,0],[14,4,22,0,"get"],[14,7,22,0],[14,18,22,0,"get"],[14,19,22,0],[15,6,22,0],[15,13,22,0,"generateMessageId"],[15,30,22,0],[16,4,22,0],[17,2,22,0],[18,2,27,0,"Object"],[18,8,27,0],[18,9,27,0,"defineProperty"],[18,23,27,0],[18,24,27,0,"exports"],[18,31,27,0],[19,4,27,0,"enumerable"],[19,14,27,0],[20,4,27,0,"get"],[20,7,27,0],[20,18,27,0,"get"],[20,19,27,0],[21,6,27,0],[21,13,27,0,"getChatId"],[21,22,27,0],[22,4,27,0],[23,2,27,0],[24,2,33,0,"Object"],[24,8,33,0],[24,9,33,0,"defineProperty"],[24,23,33,0],[24,24,33,0,"exports"],[24,31,33,0],[25,4,33,0,"enumerable"],[25,14,33,0],[26,4,33,0,"get"],[26,7,33,0],[26,18,33,0,"get"],[26,19,33,0],[27,6,33,0],[27,13,33,0,"saveMessagesLocally"],[27,32,33,0],[28,4,33,0],[29,2,33,0],[30,2,42,0,"Object"],[30,8,42,0],[30,9,42,0,"defineProperty"],[30,23,42,0],[30,24,42,0,"exports"],[30,31,42,0],[31,4,42,0,"enumerable"],[31,14,42,0],[32,4,42,0,"get"],[32,7,42,0],[32,18,42,0,"get"],[32,19,42,0],[33,6,42,0],[33,13,42,0,"getLocalMessages"],[33,29,42,0],[34,4,42,0],[35,2,42,0],[36,2,52,0,"Object"],[36,8,52,0],[36,9,52,0,"defineProperty"],[36,23,52,0],[36,24,52,0,"exports"],[36,31,52,0],[37,4,52,0,"enumerable"],[37,14,52,0],[38,4,52,0,"get"],[38,7,52,0],[38,18,52,0,"get"],[38,19,52,0],[39,6,52,0],[39,13,52,0,"addMessageLocally"],[39,30,52,0],[40,4,52,0],[41,2,52,0],[42,2,68,0,"Object"],[42,8,68,0],[42,9,68,0,"defineProperty"],[42,23,68,0],[42,24,68,0,"exports"],[42,31,68,0],[43,4,68,0,"enumerable"],[43,14,68,0],[44,4,68,0,"get"],[44,7,68,0],[44,18,68,0,"get"],[44,19,68,0],[45,6,68,0],[45,13,68,0,"updateMessageStatusLocally"],[45,39,68,0],[46,4,68,0],[47,2,68,0],[48,2,86,0,"Object"],[48,8,86,0],[48,9,86,0,"defineProperty"],[48,23,86,0],[48,24,86,0,"exports"],[48,31,86,0],[49,4,86,0,"enumerable"],[49,14,86,0],[50,4,86,0,"get"],[50,7,86,0],[50,18,86,0,"get"],[50,19,86,0],[51,6,86,0],[51,13,86,0,"sendMessageToFirebase"],[51,34,86,0],[52,4,86,0],[53,2,86,0],[54,2,119,0,"Object"],[54,8,119,0],[54,9,119,0,"defineProperty"],[54,23,119,0],[54,24,119,0,"exports"],[54,31,119,0],[55,4,119,0,"enumerable"],[55,14,119,0],[56,4,119,0,"get"],[56,7,119,0],[56,18,119,0,"get"],[56,19,119,0],[57,6,119,0],[57,13,119,0,"getMessageQueue"],[57,28,119,0],[58,4,119,0],[59,2,119,0],[60,2,128,0,"Object"],[60,8,128,0],[60,9,128,0,"defineProperty"],[60,23,128,0],[60,24,128,0,"exports"],[60,31,128,0],[61,4,128,0,"enumerable"],[61,14,128,0],[62,4,128,0,"get"],[62,7,128,0],[62,18,128,0,"get"],[62,19,128,0],[63,6,128,0],[63,13,128,0,"saveMessageQueue"],[63,29,128,0],[64,4,128,0],[65,2,128,0],[66,2,136,0,"Object"],[66,8,136,0],[66,9,136,0,"defineProperty"],[66,23,136,0],[66,24,136,0,"exports"],[66,31,136,0],[67,4,136,0,"enumerable"],[67,14,136,0],[68,4,136,0,"get"],[68,7,136,0],[68,18,136,0,"get"],[68,19,136,0],[69,6,136,0],[69,13,136,0,"addToQueue"],[69,23,136,0],[70,4,136,0],[71,2,136,0],[72,2,146,0,"Object"],[72,8,146,0],[72,9,146,0,"defineProperty"],[72,23,146,0],[72,24,146,0,"exports"],[72,31,146,0],[73,4,146,0,"enumerable"],[73,14,146,0],[74,4,146,0,"get"],[74,7,146,0],[74,18,146,0,"get"],[74,19,146,0],[75,6,146,0],[75,13,146,0,"removeFromQueue"],[75,28,146,0],[76,4,146,0],[77,2,146,0],[78,2,154,0,"Object"],[78,8,154,0],[78,9,154,0,"defineProperty"],[78,23,154,0],[78,24,154,0,"exports"],[78,31,154,0],[79,4,154,0,"enumerable"],[79,14,154,0],[80,4,154,0,"get"],[80,7,154,0],[80,18,154,0,"get"],[80,19,154,0],[81,6,154,0],[81,13,154,0,"subscribeToNewMessages"],[81,35,154,0],[82,4,154,0],[83,2,154,0],[84,2,204,2],[84,6,204,2,"_babelRuntimeHelpersAsyncToGenerator"],[84,42,204,2],[84,45,204,2,"require"],[84,52,204,2],[84,53,204,2,"_dependencyMap"],[84,67,204,2],[85,2,204,2],[85,6,204,2,"_asyncToGenerator"],[85,23,204,2],[85,26,204,2,"_interopDefault"],[85,41,204,2],[85,42,204,2,"_babelRuntimeHelpersAsyncToGenerator"],[85,78,204,2],[86,2,1,0],[86,6,1,0,"_firebaseDatabase"],[86,23,1,0],[86,26,1,0,"require"],[86,33,1,0],[86,34,1,0,"_dependencyMap"],[86,48,1,0],[87,2,2,0],[87,6,2,0,"_configFirebase"],[87,21,2,0],[87,24,2,0,"require"],[87,31,2,0],[87,32,2,0,"_dependencyMap"],[87,46,2,0],[88,2,3,0],[88,6,3,0,"_reactNativeAsyncStorageAsyncStorage"],[88,42,3,0],[88,45,3,0,"require"],[88,52,3,0],[88,53,3,0,"_dependencyMap"],[88,67,3,0],[89,2,3,0],[89,6,3,0,"AsyncStorage"],[89,18,3,0],[89,21,3,0,"_interopDefault"],[89,36,3,0],[89,37,3,0,"_reactNativeAsyncStorageAsyncStorage"],[89,73,3,0],[90,2,15,0],[90,6,15,6,"QUEUE_KEY"],[90,15,15,15],[90,18,15,18],[90,40,15,40],[91,2,16,0],[91,6,16,6,"MESSAGES_KEY"],[91,18,16,18],[91,21,16,21],[91,39,16,39],[93,2,18,0],[94,2,19,0],[94,6,19,6,"activeListeners"],[94,21,19,21],[94,24,19,24],[94,28,19,28,"Map"],[94,31,19,31],[94,32,19,49],[94,33,19,50],[96,2,21,0],[97,2,22,7],[97,6,22,13,"generateMessageId"],[97,23,22,30],[97,26,22,33,"generateMessageId"],[97,27,22,33],[97,32,22,47],[98,4,23,2],[98,11,23,9],[98,14,23,12,"Date"],[98,18,23,16],[98,19,23,17,"now"],[98,22,23,20],[98,23,23,21],[98,24,23,22],[98,28,23,26,"Math"],[98,32,23,30],[98,33,23,31,"random"],[98,39,23,37],[98,40,23,38],[98,41,23,39],[98,42,23,40,"toString"],[98,50,23,48],[98,51,23,49],[98,53,23,51],[98,54,23,52],[98,55,23,53,"substr"],[98,61,23,59],[98,62,23,60],[98,63,23,61],[98,65,23,63],[98,66,23,64],[98,67,23,65],[98,69,23,67],[99,2,24,0],[99,3,24,1],[101,2,26,0],[102,2,27,7],[102,6,27,13,"getChatId"],[102,15,27,22],[102,18,27,25,"getChatId"],[102,19,27,26,"phone1"],[102,25,27,40],[102,27,27,42,"phone2"],[102,33,27,56],[102,38,27,69],[103,4,28,2],[103,8,28,8,"sorted"],[103,14,28,14],[103,17,28,17],[103,18,28,18,"phone1"],[103,24,28,24],[103,26,28,26,"phone2"],[103,32,28,32],[103,33,28,33],[103,34,28,34,"sort"],[103,38,28,38],[103,39,28,39],[103,40,28,40],[104,4,29,2],[104,11,29,9],[104,14,29,12,"sorted"],[104,20,29,18],[104,21,29,19],[104,22,29,20],[104,23,29,21],[104,27,29,25,"sorted"],[104,33,29,31],[104,34,29,32],[104,35,29,33],[104,36,29,34],[104,38,29,36],[105,2,30,0],[105,3,30,1],[107,2,32,0],[108,2,33,7],[108,6,33,13,"saveMessagesLocally"],[108,25,33,32],[109,4,33,32],[109,8,33,32,"_ref"],[109,12,33,32],[109,19,33,32,"_asyncToGenerator"],[109,36,33,32],[109,37,33,32,"default"],[109,44,33,32],[109,46,33,35],[109,57,33,42,"chatId"],[109,63,33,56],[109,65,33,58,"messages"],[109,73,33,77],[109,75,33,97],[110,6,34,2],[110,10,34,6],[111,8,35,4],[111,14,35,10,"AsyncStorage"],[111,26,35,22],[111,27,35,22,"default"],[111,34,35,22],[111,35,35,23,"setItem"],[111,42,35,30],[111,43,35,31,"MESSAGES_KEY"],[111,55,35,43],[111,58,35,46,"chatId"],[111,64,35,52],[111,66,35,54,"JSON"],[111,70,35,58],[111,71,35,59,"stringify"],[111,80,35,68],[111,81,35,69,"messages"],[111,89,35,77],[111,90,35,78],[111,91,35,79],[112,6,36,2],[112,7,36,3],[112,8,36,4],[112,15,36,11,"e"],[112,16,36,12],[112,18,36,14],[113,8,37,4],[114,6,37,4],[115,4,39,0],[115,5,39,1],[116,4,39,1],[116,20,33,13,"saveMessagesLocally"],[116,39,33,32,"saveMessagesLocally"],[116,40,33,32,"_x"],[116,42,33,32],[116,44,33,32,"_x2"],[116,47,33,32],[117,6,33,32],[117,13,33,32,"_ref"],[117,17,33,32],[117,18,33,32,"apply"],[117,23,33,32],[117,30,33,32,"arguments"],[117,39,33,32],[118,4,33,32],[119,2,33,32],[119,5,39,1],[121,2,41,0],[122,2,42,7],[122,6,42,13,"getLocalMessages"],[122,22,42,29],[123,4,42,29],[123,8,42,29,"_ref2"],[123,13,42,29],[123,20,42,29,"_asyncToGenerator"],[123,37,42,29],[123,38,42,29,"default"],[123,45,42,29],[123,47,42,32],[123,58,42,39,"chatId"],[123,64,42,53],[123,66,42,78],[124,6,43,2],[124,10,43,6],[125,8,44,4],[125,12,44,10,"data"],[125,16,44,14],[125,25,44,23,"AsyncStorage"],[125,37,44,35],[125,38,44,35,"default"],[125,45,44,35],[125,46,44,36,"getItem"],[125,53,44,43],[125,54,44,44,"MESSAGES_KEY"],[125,66,44,56],[125,69,44,59,"chatId"],[125,75,44,65],[125,76,44,66],[126,8,45,4],[126,15,45,11,"data"],[126,19,45,15],[126,22,45,18,"JSON"],[126,26,45,22],[126,27,45,23,"parse"],[126,32,45,28],[126,33,45,29,"data"],[126,37,45,33],[126,38,45,34],[126,41,45,37],[126,43,45,39],[127,6,46,2],[127,7,46,3],[127,8,46,4],[127,15,46,11,"e"],[127,16,46,12],[127,18,46,14],[128,8,47,4],[128,15,47,11],[128,17,47,13],[129,6,48,2],[130,4,49,0],[130,5,49,1],[131,4,49,1],[131,20,42,13,"getLocalMessages"],[131,36,42,29,"getLocalMessages"],[131,37,42,29,"_x3"],[131,40,42,29],[132,6,42,29],[132,13,42,29,"_ref2"],[132,18,42,29],[132,19,42,29,"apply"],[132,24,42,29],[132,31,42,29,"arguments"],[132,40,42,29],[133,4,42,29],[134,2,42,29],[134,5,49,1],[136,2,51,0],[137,2,52,7],[137,6,52,13,"addMessageLocally"],[137,23,52,30],[138,4,52,30],[138,8,52,30,"_ref3"],[138,13,52,30],[138,20,52,30,"_asyncToGenerator"],[138,37,52,30],[138,38,52,30,"default"],[138,45,52,30],[138,47,52,33],[138,58,52,40,"chatId"],[138,64,52,54],[138,66,52,56,"message"],[138,73,52,72],[138,75,52,92],[139,6,53,2],[139,10,53,6],[140,8,54,4],[140,12,54,10,"messages"],[140,20,54,18],[140,29,54,27,"getLocalMessages"],[140,45,54,43],[140,46,54,44,"chatId"],[140,52,54,50],[140,53,54,51],[141,8,55,4],[141,12,55,10,"exists"],[141,18,55,16],[141,21,55,19,"messages"],[141,29,55,27],[141,30,55,28,"find"],[141,34,55,32],[141,35,55,33,"m"],[141,36,55,34],[141,40,55,38,"m"],[141,41,55,39],[141,42,55,40,"id"],[141,44,55,42],[141,49,55,47,"message"],[141,56,55,54],[141,57,55,55,"id"],[141,59,55,57],[141,60,55,58],[142,8,56,4],[142,12,56,8],[142,13,56,9,"exists"],[142,19,56,15],[142,21,56,17],[143,10,57,6,"messages"],[143,18,57,14],[143,19,57,15,"push"],[143,23,57,19],[143,24,57,20,"message"],[143,31,57,27],[143,32,57,28],[144,10,58,6],[145,10,59,6],[145,14,59,12,"trimmed"],[145,21,59,19],[145,24,59,22,"messages"],[145,32,59,30],[145,33,59,31,"slice"],[145,38,59,36],[145,39,59,37],[145,40,59,38],[145,43,59,41],[145,44,59,42],[146,10,60,6],[146,16,60,12,"saveMessagesLocally"],[146,35,60,31],[146,36,60,32,"chatId"],[146,42,60,38],[146,44,60,40,"trimmed"],[146,51,60,47],[146,52,60,48],[147,8,61,4],[148,6,62,2],[148,7,62,3],[148,8,62,4],[148,15,62,11,"e"],[148,16,62,12],[148,18,62,14],[149,8,63,4],[150,6,63,4],[151,4,65,0],[151,5,65,1],[152,4,65,1],[152,20,52,13,"addMessageLocally"],[152,37,52,30,"addMessageLocally"],[152,38,52,30,"_x4"],[152,41,52,30],[152,43,52,30,"_x5"],[152,46,52,30],[153,6,52,30],[153,13,52,30,"_ref3"],[153,18,52,30],[153,19,52,30,"apply"],[153,24,52,30],[153,31,52,30,"arguments"],[153,40,52,30],[154,4,52,30],[155,2,52,30],[155,5,65,1],[157,2,67,0],[158,2,68,7],[158,6,68,13,"updateMessageStatusLocally"],[158,32,68,39],[159,4,68,39],[159,8,68,39,"_ref4"],[159,13,68,39],[159,20,68,39,"_asyncToGenerator"],[159,37,68,39],[159,38,68,39,"default"],[159,45,68,39],[159,47,68,42],[159,58,69,2,"chatId"],[159,64,69,16],[159,66,70,2,"messageId"],[159,75,70,19],[159,77,71,2,"status"],[159,83,71,23],[159,85,72,20],[160,6,73,2],[160,10,73,6],[161,8,74,4],[161,12,74,10,"messages"],[161,20,74,18],[161,29,74,27,"getLocalMessages"],[161,45,74,43],[161,46,74,44,"chatId"],[161,52,74,50],[161,53,74,51],[162,8,75,4],[162,12,75,10,"index"],[162,17,75,15],[162,20,75,18,"messages"],[162,28,75,26],[162,29,75,27,"findIndex"],[162,38,75,36],[162,39,75,37,"m"],[162,40,75,38],[162,44,75,42,"m"],[162,45,75,43],[162,46,75,44,"id"],[162,48,75,46],[162,53,75,51,"messageId"],[162,62,75,60],[162,63,75,61],[163,8,76,4],[163,12,76,8,"index"],[163,17,76,13],[163,22,76,18],[163,23,76,19],[163,24,76,20],[163,26,76,22],[164,10,77,6,"messages"],[164,18,77,14],[164,19,77,15,"index"],[164,24,77,20],[164,25,77,21],[164,26,77,22,"status"],[164,32,77,28],[164,35,77,31,"status"],[164,41,77,37],[165,10,78,6],[165,16,78,12,"saveMessagesLocally"],[165,35,78,31],[165,36,78,32,"chatId"],[165,42,78,38],[165,44,78,40,"messages"],[165,52,78,48],[165,53,78,49],[166,8,79,4],[167,6,80,2],[167,7,80,3],[167,8,80,4],[167,15,80,11,"e"],[167,16,80,12],[167,18,80,14],[168,8,81,4],[169,6,81,4],[170,4,83,0],[170,5,83,1],[171,4,83,1],[171,20,68,13,"updateMessageStatusLocally"],[171,46,68,39,"updateMessageStatusLocally"],[171,47,68,39,"_x6"],[171,50,68,39],[171,52,68,39,"_x7"],[171,55,68,39],[171,57,68,39,"_x8"],[171,60,68,39],[172,6,68,39],[172,13,68,39,"_ref4"],[172,18,68,39],[172,19,68,39,"apply"],[172,24,68,39],[172,31,68,39,"arguments"],[172,40,68,39],[173,4,68,39],[174,2,68,39],[174,5,83,1],[176,2,85,0],[177,2,86,7],[177,6,86,13,"sendMessageToFirebase"],[177,27,86,34],[178,4,86,34],[178,8,86,34,"_ref5"],[178,13,86,34],[178,20,86,34,"_asyncToGenerator"],[178,37,86,34],[178,38,86,34,"default"],[178,45,86,34],[178,47,86,37],[178,58,87,2,"chatId"],[178,64,87,16],[178,66,88,2,"message"],[178,73,88,18],[178,75,89,23],[179,6,90,2],[179,10,90,6],[180,8,91,4],[180,12,91,10,"messageRef"],[180,22,91,20],[180,25,91,23],[180,29,91,23,"ref"],[180,46,91,26],[180,47,91,26,"ref"],[180,50,91,26],[180,52,91,27,"database"],[180,67,91,35],[180,68,91,35,"database"],[180,76,91,35],[180,78,91,37],[180,87,91,46,"chatId"],[180,93,91,52],[180,106,91,65,"message"],[180,113,91,72],[180,114,91,73,"id"],[180,116,91,75],[180,118,91,77],[180,119,91,78],[182,8,93,4],[183,8,94,4],[183,12,94,10,"snapshot"],[183,20,94,18],[183,29,94,27],[183,33,94,27,"get"],[183,50,94,30],[183,51,94,30,"get"],[183,54,94,30],[183,56,94,31,"messageRef"],[183,66,94,41],[183,67,94,42],[184,8,95,4],[184,12,95,8,"snapshot"],[184,20,95,16],[184,21,95,17,"exists"],[184,27,95,23],[184,28,95,24],[184,29,95,25],[184,31,95,27],[185,10,96,6],[185,17,96,13],[185,21,96,17],[186,8,97,4],[188,8,99,4],[189,8,100,4],[189,14,100,10],[189,18,100,10,"set"],[189,35,100,13],[189,36,100,13,"set"],[189,39,100,13],[189,41,100,14,"messageRef"],[189,51,100,24],[189,53,100,26],[190,10,101,6,"text"],[190,14,101,10],[190,16,101,12,"message"],[190,23,101,19],[190,24,101,20,"text"],[190,28,101,24],[191,10,102,6,"sender"],[191,16,102,12],[191,18,102,14,"message"],[191,25,102,21],[191,26,102,22,"sender"],[191,32,102,28],[192,10,103,6,"timestamp"],[192,19,103,15],[192,21,103,17,"message"],[192,28,103,24],[192,29,103,25,"timestamp"],[192,38,103,34],[193,10,104,6,"status"],[193,16,104,12],[193,18,104,14],[194,8,105,4],[194,9,105,5],[194,10,105,6],[195,8,106,4],[195,15,106,11],[195,19,106,15],[196,6,107,2],[196,7,107,3],[196,8,107,4],[196,15,107,11,"e"],[196,16,107,12],[196,18,107,14],[197,8,108,4],[197,15,108,11],[197,20,108,16],[198,6,109,2],[199,4,110,0],[199,5,110,1],[200,4,110,1],[200,20,86,13,"sendMessageToFirebase"],[200,41,86,34,"sendMessageToFirebase"],[200,42,86,34,"_x9"],[200,45,86,34],[200,47,86,34,"_x0"],[200,50,86,34],[201,6,86,34],[201,13,86,34,"_ref5"],[201,18,86,34],[201,19,86,34,"apply"],[201,24,86,34],[201,31,86,34,"arguments"],[201,40,86,34],[202,4,86,34],[203,2,86,34],[203,5,110,1],[205,2,112,0],[207,2,119,7],[207,6,119,13,"getMessageQueue"],[207,21,119,28],[208,4,119,28],[208,8,119,28,"_ref6"],[208,13,119,28],[208,20,119,28,"_asyncToGenerator"],[208,37,119,28],[208,38,119,28,"default"],[208,45,119,28],[208,47,119,31],[208,60,119,69],[209,6,120,2],[209,10,120,6],[210,8,121,4],[210,12,121,10,"data"],[210,16,121,14],[210,25,121,23,"AsyncStorage"],[210,37,121,35],[210,38,121,35,"default"],[210,45,121,35],[210,46,121,36,"getItem"],[210,53,121,43],[210,54,121,44,"QUEUE_KEY"],[210,63,121,53],[210,64,121,54],[211,8,122,4],[211,15,122,11,"data"],[211,19,122,15],[211,22,122,18,"JSON"],[211,26,122,22],[211,27,122,23,"parse"],[211,32,122,28],[211,33,122,29,"data"],[211,37,122,33],[211,38,122,34],[211,41,122,37],[211,43,122,39],[212,6,123,2],[212,7,123,3],[212,8,123,4],[212,15,123,11,"e"],[212,16,123,12],[212,18,123,14],[213,8,124,4],[213,15,124,11],[213,17,124,13],[214,6,125,2],[215,4,126,0],[215,5,126,1],[216,4,126,1],[216,20,119,13,"getMessageQueue"],[216,35,119,28,"getMessageQueue"],[216,36,119,28],[217,6,119,28],[217,13,119,28,"_ref6"],[217,18,119,28],[217,19,119,28,"apply"],[217,24,119,28],[217,31,119,28,"arguments"],[217,40,119,28],[218,4,119,28],[219,2,119,28],[219,5,126,1],[220,2,128,7],[220,6,128,13,"saveMessageQueue"],[220,22,128,29],[221,4,128,29],[221,8,128,29,"_ref7"],[221,13,128,29],[221,20,128,29,"_asyncToGenerator"],[221,37,128,29],[221,38,128,29,"default"],[221,45,128,29],[221,47,128,32],[221,58,128,39,"queue"],[221,63,128,61],[221,65,128,81],[222,6,129,2],[222,10,129,6],[223,8,130,4],[223,14,130,10,"AsyncStorage"],[223,26,130,22],[223,27,130,22,"default"],[223,34,130,22],[223,35,130,23,"setItem"],[223,42,130,30],[223,43,130,31,"QUEUE_KEY"],[223,52,130,40],[223,54,130,42,"JSON"],[223,58,130,46],[223,59,130,47,"stringify"],[223,68,130,56],[223,69,130,57,"queue"],[223,74,130,62],[223,75,130,63],[223,76,130,64],[224,6,131,2],[224,7,131,3],[224,8,131,4],[224,15,131,11,"e"],[224,16,131,12],[224,18,131,14],[225,8,132,4],[226,6,132,4],[227,4,134,0],[227,5,134,1],[228,4,134,1],[228,20,128,13,"saveMessageQueue"],[228,36,128,29,"saveMessageQueue"],[228,37,128,29,"_x1"],[228,40,128,29],[229,6,128,29],[229,13,128,29,"_ref7"],[229,18,128,29],[229,19,128,29,"apply"],[229,24,128,29],[229,31,128,29,"arguments"],[229,40,128,29],[230,4,128,29],[231,2,128,29],[231,5,134,1],[232,2,136,7],[232,6,136,13,"addToQueue"],[232,16,136,23],[233,4,136,23],[233,8,136,23,"_ref8"],[233,13,136,23],[233,20,136,23,"_asyncToGenerator"],[233,37,136,23],[233,38,136,23,"default"],[233,45,136,23],[233,47,136,26],[233,58,136,33,"chatId"],[233,64,136,47],[233,66,136,49,"message"],[233,73,136,65],[233,75,136,85],[234,6,137,2],[234,10,137,8,"queue"],[234,15,137,13],[234,24,137,22,"getMessageQueue"],[234,39,137,37],[234,40,137,38],[234,41,137,39],[235,6,138,2],[236,6,139,2],[236,10,139,8,"exists"],[236,16,139,14],[236,19,139,17,"queue"],[236,24,139,22],[236,25,139,23,"find"],[236,29,139,27],[236,30,139,28,"q"],[236,31,139,29],[236,35,139,33,"q"],[236,36,139,34],[236,37,139,35,"message"],[236,44,139,42],[236,45,139,43,"id"],[236,47,139,45],[236,52,139,50,"message"],[236,59,139,57],[236,60,139,58,"id"],[236,62,139,60],[236,63,139,61],[237,6,140,2],[237,10,140,6],[237,11,140,7,"exists"],[237,17,140,13],[237,19,140,15],[238,8,141,4,"queue"],[238,13,141,9],[238,14,141,10,"push"],[238,18,141,14],[238,19,141,15],[239,10,141,17,"chatId"],[239,16,141,23],[240,10,141,25,"message"],[240,17,141,32],[241,10,141,34,"retryCount"],[241,20,141,44],[241,22,141,46],[242,8,141,48],[242,9,141,49],[242,10,141,50],[243,8,142,4],[243,14,142,10,"saveMessageQueue"],[243,30,142,26],[243,31,142,27,"queue"],[243,36,142,32],[243,37,142,33],[244,6,143,2],[245,4,144,0],[245,5,144,1],[246,4,144,1],[246,20,136,13,"addToQueue"],[246,30,136,23,"addToQueue"],[246,31,136,23,"_x10"],[246,35,136,23],[246,37,136,23,"_x11"],[246,41,136,23],[247,6,136,23],[247,13,136,23,"_ref8"],[247,18,136,23],[247,19,136,23,"apply"],[247,24,136,23],[247,31,136,23,"arguments"],[247,40,136,23],[248,4,136,23],[249,2,136,23],[249,5,144,1],[250,2,146,7],[250,6,146,13,"removeFromQueue"],[250,21,146,28],[251,4,146,28],[251,8,146,28,"_ref9"],[251,13,146,28],[251,20,146,28,"_asyncToGenerator"],[251,37,146,28],[251,38,146,28,"default"],[251,45,146,28],[251,47,146,31],[251,58,146,38,"messageId"],[251,67,146,55],[251,69,146,75],[252,6,147,2],[252,10,147,8,"queue"],[252,15,147,13],[252,24,147,22,"getMessageQueue"],[252,39,147,37],[252,40,147,38],[252,41,147,39],[253,6,148,2],[253,10,148,8,"filtered"],[253,18,148,16],[253,21,148,19,"queue"],[253,26,148,24],[253,27,148,25,"filter"],[253,33,148,31],[253,34,148,32,"q"],[253,35,148,33],[253,39,148,37,"q"],[253,40,148,38],[253,41,148,39,"message"],[253,48,148,46],[253,49,148,47,"id"],[253,51,148,49],[253,56,148,54,"messageId"],[253,65,148,63],[253,66,148,64],[254,6,149,2],[254,12,149,8,"saveMessageQueue"],[254,28,149,24],[254,29,149,25,"filtered"],[254,37,149,33],[254,38,149,34],[255,4,150,0],[255,5,150,1],[256,4,150,1],[256,20,146,13,"removeFromQueue"],[256,35,146,28,"removeFromQueue"],[256,36,146,28,"_x12"],[256,40,146,28],[257,6,146,28],[257,13,146,28,"_ref9"],[257,18,146,28],[257,19,146,28,"apply"],[257,24,146,28],[257,31,146,28,"arguments"],[257,40,146,28],[258,4,146,28],[259,2,146,28],[259,5,150,1],[261,2,152,0],[262,2,153,0],[263,2,154,7],[263,6,154,13,"subscribeToNewMessages"],[263,28,154,35],[263,31,154,38,"subscribeToNewMessages"],[263,32,155,2,"chatId"],[263,38,155,16],[263,40,156,2,"lastTimestamp"],[263,53,156,23],[263,55,157,2,"onNewMessage"],[263,67,157,42],[263,69,158,2,"knownMessageIds"],[263,84,158,30],[263,89,159,19],[264,4,160,2],[265,4,161,2],[265,8,161,6,"activeListeners"],[265,23,161,21],[265,24,161,22,"get"],[265,27,161,25],[265,28,161,26,"chatId"],[265,34,161,32],[265,35,161,33],[265,37,161,35],[266,6,162,4],[266,13,162,11],[266,19,162,17],[266,20,162,18],[266,21,162,19],[267,4,163,2],[268,4,165,2],[268,8,165,8,"messagesRef"],[268,19,165,19],[268,22,165,22],[268,26,165,22,"ref"],[268,43,165,25],[268,44,165,25,"ref"],[268,47,165,25],[268,49,165,26,"database"],[268,64,165,34],[268,65,165,34,"database"],[268,73,165,34],[268,75,165,36],[268,84,165,45,"chatId"],[268,90,165,51],[268,101,165,62],[268,102,165,63],[270,4,167,2],[271,4,168,2,"activeListeners"],[271,19,168,17],[271,20,168,18,"set"],[271,23,168,21],[271,24,168,22,"chatId"],[271,30,168,28],[271,32,168,30],[271,36,168,34],[271,37,168,35],[273,4,170,2],[274,4,171,2],[274,8,171,8,"messagesQuery"],[274,21,171,21],[274,24,171,24],[274,28,171,24,"query"],[274,45,171,29],[274,46,171,29,"query"],[274,51,171,29],[274,53,172,4,"messagesRef"],[274,64,172,15],[274,66,173,4],[274,70,173,4,"orderByChild"],[274,87,173,16],[274,88,173,16,"orderByChild"],[274,100,173,16],[274,102,173,17],[274,113,173,28],[274,114,173,29],[274,116,174,4],[274,120,174,4,"startAt"],[274,137,174,11],[274,138,174,11,"startAt"],[274,145,174,11],[274,147,174,12,"lastTimestamp"],[274,160,174,25],[274,163,174,28],[274,164,174,29],[274,165,174,30],[274,167,175,4],[274,171,175,4,"limitToLast"],[274,188,175,15],[274,189,175,15,"limitToLast"],[274,200,175,15],[274,202,175,16],[274,204,175,18],[274,205,176,2],[274,206,176,3],[275,4,178,2],[275,8,178,2,"onChildAdded"],[275,25,178,14],[275,26,178,14,"onChildAdded"],[275,38,178,14],[275,40,178,15,"messagesQuery"],[275,53,178,28],[275,55,178,31,"snapshot"],[275,63,178,39],[275,67,178,44],[276,6,179,4],[276,10,179,8,"snapshot"],[276,18,179,16],[276,19,179,17,"exists"],[276,25,179,23],[276,26,179,24],[276,27,179,25],[276,29,179,27],[277,8,180,6],[277,12,180,12,"messageId"],[277,21,180,21],[277,24,180,24,"snapshot"],[277,32,180,32],[277,33,180,33,"key"],[277,36,180,36],[277,40,180,40],[277,42,180,42],[279,8,182,6],[280,8,183,6],[280,12,183,10,"knownMessageIds"],[280,27,183,25],[280,28,183,26,"has"],[280,31,183,29],[280,32,183,30,"messageId"],[280,41,183,39],[280,42,183,40],[280,44,183,42],[281,10,184,8],[282,8,185,6],[283,8,187,6],[283,12,187,12,"data"],[283,16,187,16],[283,19,187,19,"snapshot"],[283,27,187,27],[283,28,187,28,"val"],[283,31,187,31],[283,32,187,32],[283,33,187,33],[284,8,188,6],[284,12,188,12,"message"],[284,19,188,28],[284,22,188,31],[285,10,189,8,"id"],[285,12,189,10],[285,14,189,12,"messageId"],[285,23,189,21],[286,10,190,8,"text"],[286,14,190,12],[286,16,190,14,"data"],[286,20,190,18],[286,21,190,19,"text"],[286,25,190,23],[287,10,191,8,"sender"],[287,16,191,14],[287,18,191,16,"data"],[287,22,191,20],[287,23,191,21,"sender"],[287,29,191,27],[288,10,192,8,"timestamp"],[288,19,192,17],[288,21,192,19,"data"],[288,25,192,23],[288,26,192,24,"timestamp"],[288,35,192,33],[289,10,193,8,"status"],[289,16,193,14],[289,18,193,16],[290,8,194,6],[290,9,194,7],[291,8,195,6,"onNewMessage"],[291,20,195,18],[291,21,195,19,"message"],[291,28,195,26],[291,29,195,27],[292,6,196,4],[293,4,197,2],[293,5,197,3],[293,6,197,4],[295,4,199,2],[296,4,200,2],[296,11,200,9],[296,17,200,15],[297,6,201,4],[297,10,201,4,"off"],[297,27,201,7],[297,28,201,7,"off"],[297,31,201,7],[297,33,201,8,"messagesRef"],[297,44,201,19],[297,45,201,20],[298,6,202,4,"activeListeners"],[298,21,202,19],[298,22,202,20,"delete"],[298,28,202,26],[298,29,202,27,"chatId"],[298,35,202,33],[298,36,202,34],[299,4,203,2],[299,5,203,3],[300,2,204,0],[300,3,204,1],[301,0,204,2],[301,3]],"functionMap":{"names":["<global>","generateMessageId","getChatId","saveMessagesLocally","getLocalMessages","addMessageLocally","messages.find$argument_0","updateMessageStatusLocally","messages.findIndex$argument_0","sendMessageToFirebase","getMessageQueue","saveMessageQueue","addToQueue","queue.find$argument_0","removeFromQueue","queue.filter$argument_0","subscribeToNewMessages","<anonymous>","onChildAdded$argument_1"],"mappings":"AAA;iCCqB;CDE;yBEG;CFG;mCGG;CHM;gCIG;CJO;iCKG;iCCG,wBD;CLU;0COG;qCCO,uBD;CPQ;qCSG;CTwB;+BUS;CVO;gCWE;CXM;0BYE;4BCG,gCD;CZK;+BcE;gCCE,+BD;CdE;sCgBI;WCQ,QD;8BEgB;GFmB;SCG;GDG;ChBC"},"hasCjsExports":false},"type":"js/module"}]}