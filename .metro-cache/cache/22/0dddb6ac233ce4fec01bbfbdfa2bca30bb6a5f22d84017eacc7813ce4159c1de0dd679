{"dependencies":[{"name":"firebase/database","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":135,"index":135}}],"key":"ZF/J3nfk5GUgbzXl84BqV1IxYEE=","exportNames":["*"],"imports":1}},{"name":"../config/firebase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":136},"end":{"line":2,"column":46,"index":182}}],"key":"K/SZPG5sPeV1upVh8dao26aG7MQ=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":183},"end":{"line":3,"column":69,"index":252}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"generateMessageId\", {\n    enumerable: true,\n    get: function () {\n      return generateMessageId;\n    }\n  });\n  Object.defineProperty(exports, \"getChatId\", {\n    enumerable: true,\n    get: function () {\n      return getChatId;\n    }\n  });\n  Object.defineProperty(exports, \"saveMessagesLocally\", {\n    enumerable: true,\n    get: function () {\n      return saveMessagesLocally;\n    }\n  });\n  Object.defineProperty(exports, \"getLocalMessages\", {\n    enumerable: true,\n    get: function () {\n      return getLocalMessages;\n    }\n  });\n  Object.defineProperty(exports, \"addMessageLocally\", {\n    enumerable: true,\n    get: function () {\n      return addMessageLocally;\n    }\n  });\n  Object.defineProperty(exports, \"updateMessageStatusLocally\", {\n    enumerable: true,\n    get: function () {\n      return updateMessageStatusLocally;\n    }\n  });\n  Object.defineProperty(exports, \"sendMessageToFirebase\", {\n    enumerable: true,\n    get: function () {\n      return sendMessageToFirebase;\n    }\n  });\n  Object.defineProperty(exports, \"getMessageQueue\", {\n    enumerable: true,\n    get: function () {\n      return getMessageQueue;\n    }\n  });\n  Object.defineProperty(exports, \"saveMessageQueue\", {\n    enumerable: true,\n    get: function () {\n      return saveMessageQueue;\n    }\n  });\n  Object.defineProperty(exports, \"addToQueue\", {\n    enumerable: true,\n    get: function () {\n      return addToQueue;\n    }\n  });\n  Object.defineProperty(exports, \"removeFromQueue\", {\n    enumerable: true,\n    get: function () {\n      return removeFromQueue;\n    }\n  });\n  Object.defineProperty(exports, \"subscribeToNewMessages\", {\n    enumerable: true,\n    get: function () {\n      return subscribeToNewMessages;\n    }\n  });\n  var _firebaseDatabase = require(_dependencyMap[0], \"firebase/database\");\n  var _configFirebase = require(_dependencyMap[1], \"../config/firebase\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[2], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  const QUEUE_KEY = '@bitgo_message_queue';\n  const MESSAGES_KEY = '@bitgo_messages_';\n\n  // Track active listeners to prevent duplicates\n  const activeListeners = new Map();\n\n  // Generate unique message ID locally\n  const generateMessageId = () => {\n    return `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  };\n\n  // Get chat ID from two user phones (sorted for consistency)\n  const getChatId = (phone1, phone2) => {\n    const sorted = [phone1, phone2].sort();\n    return `${sorted[0]}_${sorted[1]}`;\n  };\n\n  // Save messages locally for a chat\n  const saveMessagesLocally = async (chatId, messages) => {\n    try {\n      await AsyncStorage.default.setItem(MESSAGES_KEY + chatId, JSON.stringify(messages));\n    } catch (e) {\n      // Silent fail in production\n    }\n  };\n\n  // Get messages from local storage\n  const getLocalMessages = async chatId => {\n    try {\n      const data = await AsyncStorage.default.getItem(MESSAGES_KEY + chatId);\n      return data ? JSON.parse(data) : [];\n    } catch (e) {\n      return [];\n    }\n  };\n\n  // Add single message to local storage\n  const addMessageLocally = async (chatId, message) => {\n    try {\n      const messages = await getLocalMessages(chatId);\n      const exists = messages.find(m => m.id === message.id);\n      if (!exists) {\n        messages.push(message);\n        // Keep only last 100 messages locally\n        const trimmed = messages.slice(-100);\n        await saveMessagesLocally(chatId, trimmed);\n      }\n    } catch (e) {\n      // Silent fail in production\n    }\n  };\n\n  // Update message status locally\n  const updateMessageStatusLocally = async (chatId, messageId, status) => {\n    try {\n      const messages = await getLocalMessages(chatId);\n      const index = messages.findIndex(m => m.id === messageId);\n      if (index !== -1) {\n        messages[index].status = status;\n        await saveMessagesLocally(chatId, messages);\n      }\n    } catch (e) {\n      // Silent fail in production\n    }\n  };\n\n  // Send message to Firebase (minimal payload) - checks for duplicate before writing\n  const sendMessageToFirebase = async (chatId, message) => {\n    try {\n      const messageRef = (0, _firebaseDatabase.ref)(_configFirebase.database, `chats/${chatId}/messages/${message.id}`);\n\n      // Check if message already exists (prevent duplicates on retry)\n      const snapshot = await (0, _firebaseDatabase.get)(messageRef);\n      if (snapshot.exists()) {\n        return true;\n      }\n\n      // Minimal payload only - text, sender, timestamp, status\n      await (0, _firebaseDatabase.set)(messageRef, {\n        text: message.text,\n        sender: message.sender,\n        timestamp: message.timestamp,\n        status: 'sent'\n      });\n      return true;\n    } catch (e) {\n      return false;\n    }\n  };\n\n  // Queue management for offline messages\n\n  const getMessageQueue = async () => {\n    try {\n      const data = await AsyncStorage.default.getItem(QUEUE_KEY);\n      return data ? JSON.parse(data) : [];\n    } catch (e) {\n      return [];\n    }\n  };\n  const saveMessageQueue = async queue => {\n    try {\n      await AsyncStorage.default.setItem(QUEUE_KEY, JSON.stringify(queue));\n    } catch (e) {\n      // Silent fail in production\n    }\n  };\n  const addToQueue = async (chatId, message) => {\n    const queue = await getMessageQueue();\n    // Check if already in queue\n    const exists = queue.find(q => q.message.id === message.id);\n    if (!exists) {\n      queue.push({\n        chatId,\n        message,\n        retryCount: 0\n      });\n      await saveMessageQueue(queue);\n    }\n  };\n  const removeFromQueue = async messageId => {\n    const queue = await getMessageQueue();\n    const filtered = queue.filter(q => q.message.id !== messageId);\n    await saveMessageQueue(filtered);\n  };\n\n  // Subscribe to new messages only (efficient listener with limitToLast)\n  // Prevents duplicate listeners per chatId\n  const subscribeToNewMessages = (chatId, lastTimestamp, onNewMessage, knownMessageIds) => {\n    // Prevent duplicate listeners for same chatId\n    if (activeListeners.get(chatId)) {\n      return () => {};\n    }\n    const messagesRef = (0, _firebaseDatabase.ref)(_configFirebase.database, `chats/${chatId}/messages`);\n\n    // Mark listener as active\n    activeListeners.set(chatId, true);\n\n    // Use limitToLast(30) to reduce data load on weak connections\n    const messagesQuery = (0, _firebaseDatabase.query)(messagesRef, (0, _firebaseDatabase.orderByChild)('timestamp'), (0, _firebaseDatabase.startAt)(lastTimestamp + 1), (0, _firebaseDatabase.limitToLast)(30));\n    (0, _firebaseDatabase.onChildAdded)(messagesQuery, snapshot => {\n      if (snapshot.exists()) {\n        const messageId = snapshot.key || '';\n\n        // Skip if we already have this message (prevent duplicates)\n        if (knownMessageIds.has(messageId)) {\n          return;\n        }\n        const data = snapshot.val();\n        const message = {\n          id: messageId,\n          text: data.text,\n          sender: data.sender,\n          timestamp: data.timestamp,\n          status: 'sent'\n        };\n        onNewMessage(message);\n      }\n    });\n\n    // Return unsubscribe function that cleans up properly\n    return () => {\n      (0, _firebaseDatabase.off)(messagesRef);\n      activeListeners.delete(chatId);\n    };\n  };\n});","lineCount":254,"map":[[12,2,22,0,"Object"],[12,8,22,0],[12,9,22,0,"defineProperty"],[12,23,22,0],[12,24,22,0,"exports"],[12,31,22,0],[13,4,22,0,"enumerable"],[13,14,22,0],[14,4,22,0,"get"],[14,7,22,0],[14,18,22,0,"get"],[14,19,22,0],[15,6,22,0],[15,13,22,0,"generateMessageId"],[15,30,22,0],[16,4,22,0],[17,2,22,0],[18,2,27,0,"Object"],[18,8,27,0],[18,9,27,0,"defineProperty"],[18,23,27,0],[18,24,27,0,"exports"],[18,31,27,0],[19,4,27,0,"enumerable"],[19,14,27,0],[20,4,27,0,"get"],[20,7,27,0],[20,18,27,0,"get"],[20,19,27,0],[21,6,27,0],[21,13,27,0,"getChatId"],[21,22,27,0],[22,4,27,0],[23,2,27,0],[24,2,33,0,"Object"],[24,8,33,0],[24,9,33,0,"defineProperty"],[24,23,33,0],[24,24,33,0,"exports"],[24,31,33,0],[25,4,33,0,"enumerable"],[25,14,33,0],[26,4,33,0,"get"],[26,7,33,0],[26,18,33,0,"get"],[26,19,33,0],[27,6,33,0],[27,13,33,0,"saveMessagesLocally"],[27,32,33,0],[28,4,33,0],[29,2,33,0],[30,2,42,0,"Object"],[30,8,42,0],[30,9,42,0,"defineProperty"],[30,23,42,0],[30,24,42,0,"exports"],[30,31,42,0],[31,4,42,0,"enumerable"],[31,14,42,0],[32,4,42,0,"get"],[32,7,42,0],[32,18,42,0,"get"],[32,19,42,0],[33,6,42,0],[33,13,42,0,"getLocalMessages"],[33,29,42,0],[34,4,42,0],[35,2,42,0],[36,2,52,0,"Object"],[36,8,52,0],[36,9,52,0,"defineProperty"],[36,23,52,0],[36,24,52,0,"exports"],[36,31,52,0],[37,4,52,0,"enumerable"],[37,14,52,0],[38,4,52,0,"get"],[38,7,52,0],[38,18,52,0,"get"],[38,19,52,0],[39,6,52,0],[39,13,52,0,"addMessageLocally"],[39,30,52,0],[40,4,52,0],[41,2,52,0],[42,2,68,0,"Object"],[42,8,68,0],[42,9,68,0,"defineProperty"],[42,23,68,0],[42,24,68,0,"exports"],[42,31,68,0],[43,4,68,0,"enumerable"],[43,14,68,0],[44,4,68,0,"get"],[44,7,68,0],[44,18,68,0,"get"],[44,19,68,0],[45,6,68,0],[45,13,68,0,"updateMessageStatusLocally"],[45,39,68,0],[46,4,68,0],[47,2,68,0],[48,2,86,0,"Object"],[48,8,86,0],[48,9,86,0,"defineProperty"],[48,23,86,0],[48,24,86,0,"exports"],[48,31,86,0],[49,4,86,0,"enumerable"],[49,14,86,0],[50,4,86,0,"get"],[50,7,86,0],[50,18,86,0,"get"],[50,19,86,0],[51,6,86,0],[51,13,86,0,"sendMessageToFirebase"],[51,34,86,0],[52,4,86,0],[53,2,86,0],[54,2,119,0,"Object"],[54,8,119,0],[54,9,119,0,"defineProperty"],[54,23,119,0],[54,24,119,0,"exports"],[54,31,119,0],[55,4,119,0,"enumerable"],[55,14,119,0],[56,4,119,0,"get"],[56,7,119,0],[56,18,119,0,"get"],[56,19,119,0],[57,6,119,0],[57,13,119,0,"getMessageQueue"],[57,28,119,0],[58,4,119,0],[59,2,119,0],[60,2,128,0,"Object"],[60,8,128,0],[60,9,128,0,"defineProperty"],[60,23,128,0],[60,24,128,0,"exports"],[60,31,128,0],[61,4,128,0,"enumerable"],[61,14,128,0],[62,4,128,0,"get"],[62,7,128,0],[62,18,128,0,"get"],[62,19,128,0],[63,6,128,0],[63,13,128,0,"saveMessageQueue"],[63,29,128,0],[64,4,128,0],[65,2,128,0],[66,2,136,0,"Object"],[66,8,136,0],[66,9,136,0,"defineProperty"],[66,23,136,0],[66,24,136,0,"exports"],[66,31,136,0],[67,4,136,0,"enumerable"],[67,14,136,0],[68,4,136,0,"get"],[68,7,136,0],[68,18,136,0,"get"],[68,19,136,0],[69,6,136,0],[69,13,136,0,"addToQueue"],[69,23,136,0],[70,4,136,0],[71,2,136,0],[72,2,146,0,"Object"],[72,8,146,0],[72,9,146,0,"defineProperty"],[72,23,146,0],[72,24,146,0,"exports"],[72,31,146,0],[73,4,146,0,"enumerable"],[73,14,146,0],[74,4,146,0,"get"],[74,7,146,0],[74,18,146,0,"get"],[74,19,146,0],[75,6,146,0],[75,13,146,0,"removeFromQueue"],[75,28,146,0],[76,4,146,0],[77,2,146,0],[78,2,154,0,"Object"],[78,8,154,0],[78,9,154,0,"defineProperty"],[78,23,154,0],[78,24,154,0,"exports"],[78,31,154,0],[79,4,154,0,"enumerable"],[79,14,154,0],[80,4,154,0,"get"],[80,7,154,0],[80,18,154,0,"get"],[80,19,154,0],[81,6,154,0],[81,13,154,0,"subscribeToNewMessages"],[81,35,154,0],[82,4,154,0],[83,2,154,0],[84,2,1,0],[84,6,1,0,"_firebaseDatabase"],[84,23,1,0],[84,26,1,0,"require"],[84,33,1,0],[84,34,1,0,"_dependencyMap"],[84,48,1,0],[85,2,2,0],[85,6,2,0,"_configFirebase"],[85,21,2,0],[85,24,2,0,"require"],[85,31,2,0],[85,32,2,0,"_dependencyMap"],[85,46,2,0],[86,2,3,0],[86,6,3,0,"_reactNativeAsyncStorageAsyncStorage"],[86,42,3,0],[86,45,3,0,"require"],[86,52,3,0],[86,53,3,0,"_dependencyMap"],[86,67,3,0],[87,2,3,0],[87,6,3,0,"AsyncStorage"],[87,18,3,0],[87,21,3,0,"_interopDefault"],[87,36,3,0],[87,37,3,0,"_reactNativeAsyncStorageAsyncStorage"],[87,73,3,0],[88,2,15,0],[88,8,15,6,"QUEUE_KEY"],[88,17,15,15],[88,20,15,18],[88,42,15,40],[89,2,16,0],[89,8,16,6,"MESSAGES_KEY"],[89,20,16,18],[89,23,16,21],[89,41,16,39],[91,2,18,0],[92,2,19,0],[92,8,19,6,"activeListeners"],[92,23,19,21],[92,26,19,24],[92,30,19,28,"Map"],[92,33,19,31],[92,34,19,49],[92,35,19,50],[94,2,21,0],[95,2,22,7],[95,8,22,13,"generateMessageId"],[95,25,22,30],[95,28,22,33,"generateMessageId"],[95,29,22,33],[95,34,22,47],[96,4,23,2],[96,11,23,9],[96,14,23,12,"Date"],[96,18,23,16],[96,19,23,17,"now"],[96,22,23,20],[96,23,23,21],[96,24,23,22],[96,28,23,26,"Math"],[96,32,23,30],[96,33,23,31,"random"],[96,39,23,37],[96,40,23,38],[96,41,23,39],[96,42,23,40,"toString"],[96,50,23,48],[96,51,23,49],[96,53,23,51],[96,54,23,52],[96,55,23,53,"substr"],[96,61,23,59],[96,62,23,60],[96,63,23,61],[96,65,23,63],[96,66,23,64],[96,67,23,65],[96,69,23,67],[97,2,24,0],[97,3,24,1],[99,2,26,0],[100,2,27,7],[100,8,27,13,"getChatId"],[100,17,27,22],[100,20,27,25,"getChatId"],[100,21,27,26,"phone1"],[100,27,27,40],[100,29,27,42,"phone2"],[100,35,27,56],[100,40,27,69],[101,4,28,2],[101,10,28,8,"sorted"],[101,16,28,14],[101,19,28,17],[101,20,28,18,"phone1"],[101,26,28,24],[101,28,28,26,"phone2"],[101,34,28,32],[101,35,28,33],[101,36,28,34,"sort"],[101,40,28,38],[101,41,28,39],[101,42,28,40],[102,4,29,2],[102,11,29,9],[102,14,29,12,"sorted"],[102,20,29,18],[102,21,29,19],[102,22,29,20],[102,23,29,21],[102,27,29,25,"sorted"],[102,33,29,31],[102,34,29,32],[102,35,29,33],[102,36,29,34],[102,38,29,36],[103,2,30,0],[103,3,30,1],[105,2,32,0],[106,2,33,7],[106,8,33,13,"saveMessagesLocally"],[106,27,33,32],[106,30,33,35],[106,36,33,35,"saveMessagesLocally"],[106,37,33,42,"chatId"],[106,43,33,56],[106,45,33,58,"messages"],[106,53,33,77],[106,58,33,97],[107,4,34,2],[107,8,34,6],[108,6,35,4],[108,12,35,10,"AsyncStorage"],[108,24,35,22],[108,25,35,22,"default"],[108,32,35,22],[108,33,35,23,"setItem"],[108,40,35,30],[108,41,35,31,"MESSAGES_KEY"],[108,53,35,43],[108,56,35,46,"chatId"],[108,62,35,52],[108,64,35,54,"JSON"],[108,68,35,58],[108,69,35,59,"stringify"],[108,78,35,68],[108,79,35,69,"messages"],[108,87,35,77],[108,88,35,78],[108,89,35,79],[109,4,36,2],[109,5,36,3],[109,6,36,4],[109,13,36,11,"e"],[109,14,36,12],[109,16,36,14],[110,6,37,4],[111,4,37,4],[112,2,39,0],[112,3,39,1],[114,2,41,0],[115,2,42,7],[115,8,42,13,"getLocalMessages"],[115,24,42,29],[115,27,42,32],[115,33,42,39,"chatId"],[115,39,42,53],[115,43,42,78],[116,4,43,2],[116,8,43,6],[117,6,44,4],[117,12,44,10,"data"],[117,16,44,14],[117,19,44,17],[117,25,44,23,"AsyncStorage"],[117,37,44,35],[117,38,44,35,"default"],[117,45,44,35],[117,46,44,36,"getItem"],[117,53,44,43],[117,54,44,44,"MESSAGES_KEY"],[117,66,44,56],[117,69,44,59,"chatId"],[117,75,44,65],[117,76,44,66],[118,6,45,4],[118,13,45,11,"data"],[118,17,45,15],[118,20,45,18,"JSON"],[118,24,45,22],[118,25,45,23,"parse"],[118,30,45,28],[118,31,45,29,"data"],[118,35,45,33],[118,36,45,34],[118,39,45,37],[118,41,45,39],[119,4,46,2],[119,5,46,3],[119,6,46,4],[119,13,46,11,"e"],[119,14,46,12],[119,16,46,14],[120,6,47,4],[120,13,47,11],[120,15,47,13],[121,4,48,2],[122,2,49,0],[122,3,49,1],[124,2,51,0],[125,2,52,7],[125,8,52,13,"addMessageLocally"],[125,25,52,30],[125,28,52,33],[125,34,52,33,"addMessageLocally"],[125,35,52,40,"chatId"],[125,41,52,54],[125,43,52,56,"message"],[125,50,52,72],[125,55,52,92],[126,4,53,2],[126,8,53,6],[127,6,54,4],[127,12,54,10,"messages"],[127,20,54,18],[127,23,54,21],[127,29,54,27,"getLocalMessages"],[127,45,54,43],[127,46,54,44,"chatId"],[127,52,54,50],[127,53,54,51],[128,6,55,4],[128,12,55,10,"exists"],[128,18,55,16],[128,21,55,19,"messages"],[128,29,55,27],[128,30,55,28,"find"],[128,34,55,32],[128,35,55,33,"m"],[128,36,55,34],[128,40,55,38,"m"],[128,41,55,39],[128,42,55,40,"id"],[128,44,55,42],[128,49,55,47,"message"],[128,56,55,54],[128,57,55,55,"id"],[128,59,55,57],[128,60,55,58],[129,6,56,4],[129,10,56,8],[129,11,56,9,"exists"],[129,17,56,15],[129,19,56,17],[130,8,57,6,"messages"],[130,16,57,14],[130,17,57,15,"push"],[130,21,57,19],[130,22,57,20,"message"],[130,29,57,27],[130,30,57,28],[131,8,58,6],[132,8,59,6],[132,14,59,12,"trimmed"],[132,21,59,19],[132,24,59,22,"messages"],[132,32,59,30],[132,33,59,31,"slice"],[132,38,59,36],[132,39,59,37],[132,40,59,38],[132,43,59,41],[132,44,59,42],[133,8,60,6],[133,14,60,12,"saveMessagesLocally"],[133,33,60,31],[133,34,60,32,"chatId"],[133,40,60,38],[133,42,60,40,"trimmed"],[133,49,60,47],[133,50,60,48],[134,6,61,4],[135,4,62,2],[135,5,62,3],[135,6,62,4],[135,13,62,11,"e"],[135,14,62,12],[135,16,62,14],[136,6,63,4],[137,4,63,4],[138,2,65,0],[138,3,65,1],[140,2,67,0],[141,2,68,7],[141,8,68,13,"updateMessageStatusLocally"],[141,34,68,39],[141,37,68,42],[141,43,68,42,"updateMessageStatusLocally"],[141,44,69,2,"chatId"],[141,50,69,16],[141,52,70,2,"messageId"],[141,61,70,19],[141,63,71,2,"status"],[141,69,71,23],[141,74,72,20],[142,4,73,2],[142,8,73,6],[143,6,74,4],[143,12,74,10,"messages"],[143,20,74,18],[143,23,74,21],[143,29,74,27,"getLocalMessages"],[143,45,74,43],[143,46,74,44,"chatId"],[143,52,74,50],[143,53,74,51],[144,6,75,4],[144,12,75,10,"index"],[144,17,75,15],[144,20,75,18,"messages"],[144,28,75,26],[144,29,75,27,"findIndex"],[144,38,75,36],[144,39,75,37,"m"],[144,40,75,38],[144,44,75,42,"m"],[144,45,75,43],[144,46,75,44,"id"],[144,48,75,46],[144,53,75,51,"messageId"],[144,62,75,60],[144,63,75,61],[145,6,76,4],[145,10,76,8,"index"],[145,15,76,13],[145,20,76,18],[145,21,76,19],[145,22,76,20],[145,24,76,22],[146,8,77,6,"messages"],[146,16,77,14],[146,17,77,15,"index"],[146,22,77,20],[146,23,77,21],[146,24,77,22,"status"],[146,30,77,28],[146,33,77,31,"status"],[146,39,77,37],[147,8,78,6],[147,14,78,12,"saveMessagesLocally"],[147,33,78,31],[147,34,78,32,"chatId"],[147,40,78,38],[147,42,78,40,"messages"],[147,50,78,48],[147,51,78,49],[148,6,79,4],[149,4,80,2],[149,5,80,3],[149,6,80,4],[149,13,80,11,"e"],[149,14,80,12],[149,16,80,14],[150,6,81,4],[151,4,81,4],[152,2,83,0],[152,3,83,1],[154,2,85,0],[155,2,86,7],[155,8,86,13,"sendMessageToFirebase"],[155,29,86,34],[155,32,86,37],[155,38,86,37,"sendMessageToFirebase"],[155,39,87,2,"chatId"],[155,45,87,16],[155,47,88,2,"message"],[155,54,88,18],[155,59,89,23],[156,4,90,2],[156,8,90,6],[157,6,91,4],[157,12,91,10,"messageRef"],[157,22,91,20],[157,25,91,23],[157,29,91,23,"ref"],[157,46,91,26],[157,47,91,26,"ref"],[157,50,91,26],[157,52,91,27,"database"],[157,67,91,35],[157,68,91,35,"database"],[157,76,91,35],[157,78,91,37],[157,87,91,46,"chatId"],[157,93,91,52],[157,106,91,65,"message"],[157,113,91,72],[157,114,91,73,"id"],[157,116,91,75],[157,118,91,77],[157,119,91,78],[159,6,93,4],[160,6,94,4],[160,12,94,10,"snapshot"],[160,20,94,18],[160,23,94,21],[160,29,94,27],[160,33,94,27,"get"],[160,50,94,30],[160,51,94,30,"get"],[160,54,94,30],[160,56,94,31,"messageRef"],[160,66,94,41],[160,67,94,42],[161,6,95,4],[161,10,95,8,"snapshot"],[161,18,95,16],[161,19,95,17,"exists"],[161,25,95,23],[161,26,95,24],[161,27,95,25],[161,29,95,27],[162,8,96,6],[162,15,96,13],[162,19,96,17],[163,6,97,4],[165,6,99,4],[166,6,100,4],[166,12,100,10],[166,16,100,10,"set"],[166,33,100,13],[166,34,100,13,"set"],[166,37,100,13],[166,39,100,14,"messageRef"],[166,49,100,24],[166,51,100,26],[167,8,101,6,"text"],[167,12,101,10],[167,14,101,12,"message"],[167,21,101,19],[167,22,101,20,"text"],[167,26,101,24],[168,8,102,6,"sender"],[168,14,102,12],[168,16,102,14,"message"],[168,23,102,21],[168,24,102,22,"sender"],[168,30,102,28],[169,8,103,6,"timestamp"],[169,17,103,15],[169,19,103,17,"message"],[169,26,103,24],[169,27,103,25,"timestamp"],[169,36,103,34],[170,8,104,6,"status"],[170,14,104,12],[170,16,104,14],[171,6,105,4],[171,7,105,5],[171,8,105,6],[172,6,106,4],[172,13,106,11],[172,17,106,15],[173,4,107,2],[173,5,107,3],[173,6,107,4],[173,13,107,11,"e"],[173,14,107,12],[173,16,107,14],[174,6,108,4],[174,13,108,11],[174,18,108,16],[175,4,109,2],[176,2,110,0],[176,3,110,1],[178,2,112,0],[180,2,119,7],[180,8,119,13,"getMessageQueue"],[180,23,119,28],[180,26,119,31],[180,32,119,31,"getMessageQueue"],[180,33,119,31],[180,38,119,69],[181,4,120,2],[181,8,120,6],[182,6,121,4],[182,12,121,10,"data"],[182,16,121,14],[182,19,121,17],[182,25,121,23,"AsyncStorage"],[182,37,121,35],[182,38,121,35,"default"],[182,45,121,35],[182,46,121,36,"getItem"],[182,53,121,43],[182,54,121,44,"QUEUE_KEY"],[182,63,121,53],[182,64,121,54],[183,6,122,4],[183,13,122,11,"data"],[183,17,122,15],[183,20,122,18,"JSON"],[183,24,122,22],[183,25,122,23,"parse"],[183,30,122,28],[183,31,122,29,"data"],[183,35,122,33],[183,36,122,34],[183,39,122,37],[183,41,122,39],[184,4,123,2],[184,5,123,3],[184,6,123,4],[184,13,123,11,"e"],[184,14,123,12],[184,16,123,14],[185,6,124,4],[185,13,124,11],[185,15,124,13],[186,4,125,2],[187,2,126,0],[187,3,126,1],[188,2,128,7],[188,8,128,13,"saveMessageQueue"],[188,24,128,29],[188,27,128,32],[188,33,128,39,"queue"],[188,38,128,61],[188,42,128,81],[189,4,129,2],[189,8,129,6],[190,6,130,4],[190,12,130,10,"AsyncStorage"],[190,24,130,22],[190,25,130,22,"default"],[190,32,130,22],[190,33,130,23,"setItem"],[190,40,130,30],[190,41,130,31,"QUEUE_KEY"],[190,50,130,40],[190,52,130,42,"JSON"],[190,56,130,46],[190,57,130,47,"stringify"],[190,66,130,56],[190,67,130,57,"queue"],[190,72,130,62],[190,73,130,63],[190,74,130,64],[191,4,131,2],[191,5,131,3],[191,6,131,4],[191,13,131,11,"e"],[191,14,131,12],[191,16,131,14],[192,6,132,4],[193,4,132,4],[194,2,134,0],[194,3,134,1],[195,2,136,7],[195,8,136,13,"addToQueue"],[195,18,136,23],[195,21,136,26],[195,27,136,26,"addToQueue"],[195,28,136,33,"chatId"],[195,34,136,47],[195,36,136,49,"message"],[195,43,136,65],[195,48,136,85],[196,4,137,2],[196,10,137,8,"queue"],[196,15,137,13],[196,18,137,16],[196,24,137,22,"getMessageQueue"],[196,39,137,37],[196,40,137,38],[196,41,137,39],[197,4,138,2],[198,4,139,2],[198,10,139,8,"exists"],[198,16,139,14],[198,19,139,17,"queue"],[198,24,139,22],[198,25,139,23,"find"],[198,29,139,27],[198,30,139,28,"q"],[198,31,139,29],[198,35,139,33,"q"],[198,36,139,34],[198,37,139,35,"message"],[198,44,139,42],[198,45,139,43,"id"],[198,47,139,45],[198,52,139,50,"message"],[198,59,139,57],[198,60,139,58,"id"],[198,62,139,60],[198,63,139,61],[199,4,140,2],[199,8,140,6],[199,9,140,7,"exists"],[199,15,140,13],[199,17,140,15],[200,6,141,4,"queue"],[200,11,141,9],[200,12,141,10,"push"],[200,16,141,14],[200,17,141,15],[201,8,141,17,"chatId"],[201,14,141,23],[202,8,141,25,"message"],[202,15,141,32],[203,8,141,34,"retryCount"],[203,18,141,44],[203,20,141,46],[204,6,141,48],[204,7,141,49],[204,8,141,50],[205,6,142,4],[205,12,142,10,"saveMessageQueue"],[205,28,142,26],[205,29,142,27,"queue"],[205,34,142,32],[205,35,142,33],[206,4,143,2],[207,2,144,0],[207,3,144,1],[208,2,146,7],[208,8,146,13,"removeFromQueue"],[208,23,146,28],[208,26,146,31],[208,32,146,38,"messageId"],[208,41,146,55],[208,45,146,75],[209,4,147,2],[209,10,147,8,"queue"],[209,15,147,13],[209,18,147,16],[209,24,147,22,"getMessageQueue"],[209,39,147,37],[209,40,147,38],[209,41,147,39],[210,4,148,2],[210,10,148,8,"filtered"],[210,18,148,16],[210,21,148,19,"queue"],[210,26,148,24],[210,27,148,25,"filter"],[210,33,148,31],[210,34,148,32,"q"],[210,35,148,33],[210,39,148,37,"q"],[210,40,148,38],[210,41,148,39,"message"],[210,48,148,46],[210,49,148,47,"id"],[210,51,148,49],[210,56,148,54,"messageId"],[210,65,148,63],[210,66,148,64],[211,4,149,2],[211,10,149,8,"saveMessageQueue"],[211,26,149,24],[211,27,149,25,"filtered"],[211,35,149,33],[211,36,149,34],[212,2,150,0],[212,3,150,1],[214,2,152,0],[215,2,153,0],[216,2,154,7],[216,8,154,13,"subscribeToNewMessages"],[216,30,154,35],[216,33,154,38,"subscribeToNewMessages"],[216,34,155,2,"chatId"],[216,40,155,16],[216,42,156,2,"lastTimestamp"],[216,55,156,23],[216,57,157,2,"onNewMessage"],[216,69,157,42],[216,71,158,2,"knownMessageIds"],[216,86,158,30],[216,91,159,19],[217,4,160,2],[218,4,161,2],[218,8,161,6,"activeListeners"],[218,23,161,21],[218,24,161,22,"get"],[218,27,161,25],[218,28,161,26,"chatId"],[218,34,161,32],[218,35,161,33],[218,37,161,35],[219,6,162,4],[219,13,162,11],[219,19,162,17],[219,20,162,18],[219,21,162,19],[220,4,163,2],[221,4,165,2],[221,10,165,8,"messagesRef"],[221,21,165,19],[221,24,165,22],[221,28,165,22,"ref"],[221,45,165,25],[221,46,165,25,"ref"],[221,49,165,25],[221,51,165,26,"database"],[221,66,165,34],[221,67,165,34,"database"],[221,75,165,34],[221,77,165,36],[221,86,165,45,"chatId"],[221,92,165,51],[221,103,165,62],[221,104,165,63],[223,4,167,2],[224,4,168,2,"activeListeners"],[224,19,168,17],[224,20,168,18,"set"],[224,23,168,21],[224,24,168,22,"chatId"],[224,30,168,28],[224,32,168,30],[224,36,168,34],[224,37,168,35],[226,4,170,2],[227,4,171,2],[227,10,171,8,"messagesQuery"],[227,23,171,21],[227,26,171,24],[227,30,171,24,"query"],[227,47,171,29],[227,48,171,29,"query"],[227,53,171,29],[227,55,172,4,"messagesRef"],[227,66,172,15],[227,68,173,4],[227,72,173,4,"orderByChild"],[227,89,173,16],[227,90,173,16,"orderByChild"],[227,102,173,16],[227,104,173,17],[227,115,173,28],[227,116,173,29],[227,118,174,4],[227,122,174,4,"startAt"],[227,139,174,11],[227,140,174,11,"startAt"],[227,147,174,11],[227,149,174,12,"lastTimestamp"],[227,162,174,25],[227,165,174,28],[227,166,174,29],[227,167,174,30],[227,169,175,4],[227,173,175,4,"limitToLast"],[227,190,175,15],[227,191,175,15,"limitToLast"],[227,202,175,15],[227,204,175,16],[227,206,175,18],[227,207,176,2],[227,208,176,3],[228,4,178,2],[228,8,178,2,"onChildAdded"],[228,25,178,14],[228,26,178,14,"onChildAdded"],[228,38,178,14],[228,40,178,15,"messagesQuery"],[228,53,178,28],[228,55,178,31,"snapshot"],[228,63,178,39],[228,67,178,44],[229,6,179,4],[229,10,179,8,"snapshot"],[229,18,179,16],[229,19,179,17,"exists"],[229,25,179,23],[229,26,179,24],[229,27,179,25],[229,29,179,27],[230,8,180,6],[230,14,180,12,"messageId"],[230,23,180,21],[230,26,180,24,"snapshot"],[230,34,180,32],[230,35,180,33,"key"],[230,38,180,36],[230,42,180,40],[230,44,180,42],[232,8,182,6],[233,8,183,6],[233,12,183,10,"knownMessageIds"],[233,27,183,25],[233,28,183,26,"has"],[233,31,183,29],[233,32,183,30,"messageId"],[233,41,183,39],[233,42,183,40],[233,44,183,42],[234,10,184,8],[235,8,185,6],[236,8,187,6],[236,14,187,12,"data"],[236,18,187,16],[236,21,187,19,"snapshot"],[236,29,187,27],[236,30,187,28,"val"],[236,33,187,31],[236,34,187,32],[236,35,187,33],[237,8,188,6],[237,14,188,12,"message"],[237,21,188,28],[237,24,188,31],[238,10,189,8,"id"],[238,12,189,10],[238,14,189,12,"messageId"],[238,23,189,21],[239,10,190,8,"text"],[239,14,190,12],[239,16,190,14,"data"],[239,20,190,18],[239,21,190,19,"text"],[239,25,190,23],[240,10,191,8,"sender"],[240,16,191,14],[240,18,191,16,"data"],[240,22,191,20],[240,23,191,21,"sender"],[240,29,191,27],[241,10,192,8,"timestamp"],[241,19,192,17],[241,21,192,19,"data"],[241,25,192,23],[241,26,192,24,"timestamp"],[241,35,192,33],[242,10,193,8,"status"],[242,16,193,14],[242,18,193,16],[243,8,194,6],[243,9,194,7],[244,8,195,6,"onNewMessage"],[244,20,195,18],[244,21,195,19,"message"],[244,28,195,26],[244,29,195,27],[245,6,196,4],[246,4,197,2],[246,5,197,3],[246,6,197,4],[248,4,199,2],[249,4,200,2],[249,11,200,9],[249,17,200,15],[250,6,201,4],[250,10,201,4,"off"],[250,27,201,7],[250,28,201,7,"off"],[250,31,201,7],[250,33,201,8,"messagesRef"],[250,44,201,19],[250,45,201,20],[251,6,202,4,"activeListeners"],[251,21,202,19],[251,22,202,20,"delete"],[251,28,202,26],[251,29,202,27,"chatId"],[251,35,202,33],[251,36,202,34],[252,4,203,2],[252,5,203,3],[253,2,204,0],[253,3,204,1],[254,0,204,2],[254,3]],"functionMap":{"names":["<global>","generateMessageId","getChatId","saveMessagesLocally","getLocalMessages","addMessageLocally","messages.find$argument_0","updateMessageStatusLocally","messages.findIndex$argument_0","sendMessageToFirebase","getMessageQueue","saveMessageQueue","addToQueue","queue.find$argument_0","removeFromQueue","queue.filter$argument_0","subscribeToNewMessages","<anonymous>","onChildAdded$argument_1"],"mappings":"AAA;iCCqB;CDE;yBEG;CFG;mCGG;CHM;gCIG;CJO;iCKG;iCCG,wBD;CLU;0COG;qCCO,uBD;CPQ;qCSG;CTwB;+BUS;CVO;gCWE;CXM;0BYE;4BCG,gCD;CZK;+BcE;gCCE,+BD;CdE;sCgBI;WCQ,QD;8BEgB;GFmB;SCG;GDG;ChBC"},"hasCjsExports":false},"type":"js/module"}]}