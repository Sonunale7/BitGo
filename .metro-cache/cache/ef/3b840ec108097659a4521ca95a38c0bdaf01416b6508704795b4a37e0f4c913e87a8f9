{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":65,"index":65}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/AppState","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"JfCM6WRyn2619+pzBJhEHd1+SSw=","exportNames":["*"],"imports":1}},{"name":"./messageService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":107},"end":{"line":9,"column":26,"index":251}}],"key":"UmoAEzy9/zGUVoH0kindHZPFRR0=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"processQueue\", {\n    enumerable: true,\n    get: function () {\n      return processQueue;\n    }\n  });\n  Object.defineProperty(exports, \"useMessageQueueProcessor\", {\n    enumerable: true,\n    get: function () {\n      return useMessageQueueProcessor;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeWebDistExportsAppState = require(_dependencyMap[1], \"react-native-web/dist/exports/AppState\");\n  var AppState = _interopDefault(_reactNativeWebDistExportsAppState);\n  var _messageService = require(_dependencyMap[2], \"./messageService\");\n  const RETRY_INTERVAL = 3000; // 3 seconds\n  const MAX_RETRIES = 10;\n\n  // Simple network check by attempting a small fetch\n  const checkNetwork = async () => {\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 2000);\n      await fetch('https://www.google.com/generate_204', {\n        method: 'HEAD',\n        signal: controller.signal\n      });\n      clearTimeout(timeoutId);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  };\n\n  // Process queued messages\n  const processQueue = async onStatusUpdate => {\n    const queue = await (0, _messageService.getMessageQueue)();\n    let successCount = 0;\n    for (const item of queue) {\n      const success = await (0, _messageService.sendMessageToFirebase)(item.chatId, item.message);\n      if (success) {\n        await (0, _messageService.removeFromQueue)(item.message.id);\n        await (0, _messageService.updateMessageStatusLocally)(item.chatId, item.message.id, 'sent');\n        onStatusUpdate?.(item.message.id, item.chatId, 'sent');\n        successCount++;\n      } else if (item.retryCount >= MAX_RETRIES) {\n        // Mark as failed after max retries\n        await (0, _messageService.updateMessageStatusLocally)(item.chatId, item.message.id, 'failed');\n        await (0, _messageService.removeFromQueue)(item.message.id);\n      }\n    }\n    return successCount;\n  };\n\n  // Hook for managing queue retry\n  const useMessageQueueProcessor = onStatusUpdate => {\n    _s();\n    const [isOnline, setIsOnline] = (0, _react.useState)(true);\n    const [queueLength, setQueueLength] = (0, _react.useState)(0);\n    const retryIntervalRef = (0, _react.useRef)(null);\n    const processAndUpdate = (0, _react.useCallback)(async () => {\n      const online = await checkNetwork();\n      setIsOnline(online);\n      if (online) {\n        await processQueue(onStatusUpdate);\n      }\n      const queue = await (0, _messageService.getMessageQueue)();\n      setQueueLength(queue.length);\n    }, [onStatusUpdate]);\n    (0, _react.useEffect)(() => {\n      // Initial check\n      processAndUpdate();\n\n      // Set up retry interval\n      retryIntervalRef.current = setInterval(processAndUpdate, RETRY_INTERVAL);\n\n      // Listen for app state changes\n      const subscription = AppState.default.addEventListener('change', state => {\n        if (state === 'active') {\n          processAndUpdate();\n        }\n      });\n      return () => {\n        if (retryIntervalRef.current) {\n          clearInterval(retryIntervalRef.current);\n        }\n        subscription.remove();\n      };\n    }, [processAndUpdate]);\n    return {\n      isOnline,\n      queueLength,\n      processQueue: processAndUpdate\n    };\n  };\n  _s(useMessageQueueProcessor, \"4GwfziGzzWhO7JaqJqZMGjs0JwI=\");\n});","lineCount":110,"map":[[13,2,33,0,"Object"],[13,8,33,0],[13,9,33,0,"defineProperty"],[13,23,33,0],[13,24,33,0,"exports"],[13,31,33,0],[14,4,33,0,"enumerable"],[14,14,33,0],[15,4,33,0,"get"],[15,7,33,0],[15,18,33,0,"get"],[15,19,33,0],[16,6,33,0],[16,13,33,0,"processQueue"],[16,25,33,0],[17,4,33,0],[18,2,33,0],[19,2,58,0,"Object"],[19,8,58,0],[19,9,58,0,"defineProperty"],[19,23,58,0],[19,24,58,0,"exports"],[19,31,58,0],[20,4,58,0,"enumerable"],[20,14,58,0],[21,4,58,0,"get"],[21,7,58,0],[21,18,58,0,"get"],[21,19,58,0],[22,6,58,0],[22,13,58,0,"useMessageQueueProcessor"],[22,37,58,0],[23,4,58,0],[24,2,58,0],[25,2,1,0],[25,6,1,0,"_react"],[25,12,1,0],[25,15,1,0,"require"],[25,22,1,0],[25,23,1,0,"_dependencyMap"],[25,37,1,0],[26,2,1,65],[26,6,1,65,"_reactNativeWebDistExportsAppState"],[26,40,1,65],[26,43,1,65,"require"],[26,50,1,65],[26,51,1,65,"_dependencyMap"],[26,65,1,65],[27,2,1,65],[27,6,1,65,"AppState"],[27,14,1,65],[27,17,1,65,"_interopDefault"],[27,32,1,65],[27,33,1,65,"_reactNativeWebDistExportsAppState"],[27,67,1,65],[28,2,3,0],[28,6,3,0,"_messageService"],[28,21,3,0],[28,24,3,0,"require"],[28,31,3,0],[28,32,3,0,"_dependencyMap"],[28,46,3,0],[29,2,11,0],[29,8,11,6,"RETRY_INTERVAL"],[29,22,11,20],[29,25,11,23],[29,29,11,27],[29,30,11,28],[29,31,11,29],[30,2,12,0],[30,8,12,6,"MAX_RETRIES"],[30,19,12,17],[30,22,12,20],[30,24,12,22],[32,2,14,0],[33,2,15,0],[33,8,15,6,"checkNetwork"],[33,20,15,18],[33,23,15,21],[33,29,15,21,"checkNetwork"],[33,30,15,21],[33,35,15,51],[34,4,16,2],[34,8,16,6],[35,6,17,4],[35,12,17,10,"controller"],[35,22,17,20],[35,25,17,23],[35,29,17,27,"AbortController"],[35,44,17,42],[35,45,17,43],[35,46,17,44],[36,6,18,4],[36,12,18,10,"timeoutId"],[36,21,18,19],[36,24,18,22,"setTimeout"],[36,34,18,32],[36,35,18,33],[36,41,18,39,"controller"],[36,51,18,49],[36,52,18,50,"abort"],[36,57,18,55],[36,58,18,56],[36,59,18,57],[36,61,18,59],[36,65,18,63],[36,66,18,64],[37,6,20,4],[37,12,20,10,"fetch"],[37,17,20,15],[37,18,20,16],[37,55,20,53],[37,57,20,55],[38,8,21,6,"method"],[38,14,21,12],[38,16,21,14],[38,22,21,20],[39,8,22,6,"signal"],[39,14,22,12],[39,16,22,14,"controller"],[39,26,22,24],[39,27,22,25,"signal"],[40,6,23,4],[40,7,23,5],[40,8,23,6],[41,6,25,4,"clearTimeout"],[41,18,25,16],[41,19,25,17,"timeoutId"],[41,28,25,26],[41,29,25,27],[42,6,26,4],[42,13,26,11],[42,17,26,15],[43,4,27,2],[43,5,27,3],[43,6,27,4],[43,13,27,11,"e"],[43,14,27,12],[43,16,27,14],[44,6,28,4],[44,13,28,11],[44,18,28,16],[45,4,29,2],[46,2,30,0],[46,3,30,1],[48,2,32,0],[49,2,33,7],[49,8,33,13,"processQueue"],[49,20,33,25],[49,23,33,28],[49,29,34,2,"onStatusUpdate"],[49,43,34,89],[49,47,35,22],[50,4,36,2],[50,10,36,8,"queue"],[50,15,36,13],[50,18,36,16],[50,24,36,22],[50,28,36,22,"getMessageQueue"],[50,43,36,37],[50,44,36,37,"getMessageQueue"],[50,59,36,37],[50,61,36,38],[50,62,36,39],[51,4,37,2],[51,8,37,6,"successCount"],[51,20,37,18],[51,23,37,21],[51,24,37,22],[52,4,39,2],[52,9,39,7],[52,15,39,13,"item"],[52,19,39,17],[52,23,39,21,"queue"],[52,28,39,26],[52,30,39,28],[53,6,40,4],[53,12,40,10,"success"],[53,19,40,17],[53,22,40,20],[53,28,40,26],[53,32,40,26,"sendMessageToFirebase"],[53,47,40,47],[53,48,40,47,"sendMessageToFirebase"],[53,69,40,47],[53,71,40,48,"item"],[53,75,40,52],[53,76,40,53,"chatId"],[53,82,40,59],[53,84,40,61,"item"],[53,88,40,65],[53,89,40,66,"message"],[53,96,40,73],[53,97,40,74],[54,6,42,4],[54,10,42,8,"success"],[54,17,42,15],[54,19,42,17],[55,8,43,6],[55,14,43,12],[55,18,43,12,"removeFromQueue"],[55,33,43,27],[55,34,43,27,"removeFromQueue"],[55,49,43,27],[55,51,43,28,"item"],[55,55,43,32],[55,56,43,33,"message"],[55,63,43,40],[55,64,43,41,"id"],[55,66,43,43],[55,67,43,44],[56,8,44,6],[56,14,44,12],[56,18,44,12,"updateMessageStatusLocally"],[56,33,44,38],[56,34,44,38,"updateMessageStatusLocally"],[56,60,44,38],[56,62,44,39,"item"],[56,66,44,43],[56,67,44,44,"chatId"],[56,73,44,50],[56,75,44,52,"item"],[56,79,44,56],[56,80,44,57,"message"],[56,87,44,64],[56,88,44,65,"id"],[56,90,44,67],[56,92,44,69],[56,98,44,75],[56,99,44,76],[57,8,45,6,"onStatusUpdate"],[57,22,45,20],[57,25,45,23,"item"],[57,29,45,27],[57,30,45,28,"message"],[57,37,45,35],[57,38,45,36,"id"],[57,40,45,38],[57,42,45,40,"item"],[57,46,45,44],[57,47,45,45,"chatId"],[57,53,45,51],[57,55,45,53],[57,61,45,59],[57,62,45,60],[58,8,46,6,"successCount"],[58,20,46,18],[58,22,46,20],[59,6,47,4],[59,7,47,5],[59,13,47,11],[59,17,47,15,"item"],[59,21,47,19],[59,22,47,20,"retryCount"],[59,32,47,30],[59,36,47,34,"MAX_RETRIES"],[59,47,47,45],[59,49,47,47],[60,8,48,6],[61,8,49,6],[61,14,49,12],[61,18,49,12,"updateMessageStatusLocally"],[61,33,49,38],[61,34,49,38,"updateMessageStatusLocally"],[61,60,49,38],[61,62,49,39,"item"],[61,66,49,43],[61,67,49,44,"chatId"],[61,73,49,50],[61,75,49,52,"item"],[61,79,49,56],[61,80,49,57,"message"],[61,87,49,64],[61,88,49,65,"id"],[61,90,49,67],[61,92,49,69],[61,100,49,77],[61,101,49,78],[62,8,50,6],[62,14,50,12],[62,18,50,12,"removeFromQueue"],[62,33,50,27],[62,34,50,27,"removeFromQueue"],[62,49,50,27],[62,51,50,28,"item"],[62,55,50,32],[62,56,50,33,"message"],[62,63,50,40],[62,64,50,41,"id"],[62,66,50,43],[62,67,50,44],[63,6,51,4],[64,4,52,2],[65,4,54,2],[65,11,54,9,"successCount"],[65,23,54,21],[66,2,55,0],[66,3,55,1],[68,2,57,0],[69,2,58,7],[69,8,58,13,"useMessageQueueProcessor"],[69,32,58,37],[69,35,59,2,"onStatusUpdate"],[69,49,59,89],[69,53,60,5],[70,4,60,5,"_s"],[70,6,60,5],[71,4,61,2],[71,10,61,8],[71,11,61,9,"isOnline"],[71,19,61,17],[71,21,61,19,"setIsOnline"],[71,32,61,30],[71,33,61,31],[71,36,61,34],[71,40,61,34,"useState"],[71,46,61,42],[71,47,61,42,"useState"],[71,55,61,42],[71,57,61,43],[71,61,61,47],[71,62,61,48],[72,4,62,2],[72,10,62,8],[72,11,62,9,"queueLength"],[72,22,62,20],[72,24,62,22,"setQueueLength"],[72,38,62,36],[72,39,62,37],[72,42,62,40],[72,46,62,40,"useState"],[72,52,62,48],[72,53,62,48,"useState"],[72,61,62,48],[72,63,62,49],[72,64,62,50],[72,65,62,51],[73,4,63,2],[73,10,63,8,"retryIntervalRef"],[73,26,63,24],[73,29,63,27],[73,33,63,27,"useRef"],[73,39,63,33],[73,40,63,33,"useRef"],[73,46,63,33],[73,48,63,57],[73,52,63,61],[73,53,63,62],[74,4,65,2],[74,10,65,8,"processAndUpdate"],[74,26,65,24],[74,29,65,27],[74,33,65,27,"useCallback"],[74,39,65,38],[74,40,65,38,"useCallback"],[74,51,65,38],[74,53,65,39],[74,65,65,51],[75,6,66,4],[75,12,66,10,"online"],[75,18,66,16],[75,21,66,19],[75,27,66,25,"checkNetwork"],[75,39,66,37],[75,40,66,38],[75,41,66,39],[76,6,67,4,"setIsOnline"],[76,17,67,15],[76,18,67,16,"online"],[76,24,67,22],[76,25,67,23],[77,6,69,4],[77,10,69,8,"online"],[77,16,69,14],[77,18,69,16],[78,8,70,6],[78,14,70,12,"processQueue"],[78,26,70,24],[78,27,70,25,"onStatusUpdate"],[78,41,70,39],[78,42,70,40],[79,6,71,4],[80,6,73,4],[80,12,73,10,"queue"],[80,17,73,15],[80,20,73,18],[80,26,73,24],[80,30,73,24,"getMessageQueue"],[80,45,73,39],[80,46,73,39,"getMessageQueue"],[80,61,73,39],[80,63,73,40],[80,64,73,41],[81,6,74,4,"setQueueLength"],[81,20,74,18],[81,21,74,19,"queue"],[81,26,74,24],[81,27,74,25,"length"],[81,33,74,31],[81,34,74,32],[82,4,75,2],[82,5,75,3],[82,7,75,5],[82,8,75,6,"onStatusUpdate"],[82,22,75,20],[82,23,75,21],[82,24,75,22],[83,4,77,2],[83,8,77,2,"useEffect"],[83,14,77,11],[83,15,77,11,"useEffect"],[83,24,77,11],[83,26,77,12],[83,32,77,18],[84,6,78,4],[85,6,79,4,"processAndUpdate"],[85,22,79,20],[85,23,79,21],[85,24,79,22],[87,6,81,4],[88,6,82,4,"retryIntervalRef"],[88,22,82,20],[88,23,82,21,"current"],[88,30,82,28],[88,33,82,31,"setInterval"],[88,44,82,42],[88,45,82,43,"processAndUpdate"],[88,61,82,59],[88,63,82,61,"RETRY_INTERVAL"],[88,77,82,75],[88,78,82,76],[90,6,84,4],[91,6,85,4],[91,12,85,10,"subscription"],[91,24,85,22],[91,27,85,25,"AppState"],[91,35,85,33],[91,36,85,33,"default"],[91,43,85,33],[91,44,85,34,"addEventListener"],[91,60,85,50],[91,61,85,51],[91,69,85,59],[91,71,85,62,"state"],[91,76,85,67],[91,80,85,72],[92,8,86,6],[92,12,86,10,"state"],[92,17,86,15],[92,22,86,20],[92,30,86,28],[92,32,86,30],[93,10,87,8,"processAndUpdate"],[93,26,87,24],[93,27,87,25],[93,28,87,26],[94,8,88,6],[95,6,89,4],[95,7,89,5],[95,8,89,6],[96,6,91,4],[96,13,91,11],[96,19,91,17],[97,8,92,6],[97,12,92,10,"retryIntervalRef"],[97,28,92,26],[97,29,92,27,"current"],[97,36,92,34],[97,38,92,36],[98,10,93,8,"clearInterval"],[98,23,93,21],[98,24,93,22,"retryIntervalRef"],[98,40,93,38],[98,41,93,39,"current"],[98,48,93,46],[98,49,93,47],[99,8,94,6],[100,8,95,6,"subscription"],[100,20,95,18],[100,21,95,19,"remove"],[100,27,95,25],[100,28,95,26],[100,29,95,27],[101,6,96,4],[101,7,96,5],[102,4,97,2],[102,5,97,3],[102,7,97,5],[102,8,97,6,"processAndUpdate"],[102,24,97,22],[102,25,97,23],[102,26,97,24],[103,4,99,2],[103,11,99,9],[104,6,99,11,"isOnline"],[104,14,99,19],[105,6,99,21,"queueLength"],[105,17,99,32],[106,6,99,34,"processQueue"],[106,18,99,46],[106,20,99,48,"processAndUpdate"],[107,4,99,65],[107,5,99,66],[108,2,100,0],[108,3,100,1],[109,2,100,2,"_s"],[109,4,100,2],[109,5,58,13,"useMessageQueueProcessor"],[109,29,58,37],[110,0,58,37],[110,3]],"functionMap":{"names":["<global>","checkNetwork","setTimeout$argument_0","processQueue","useMessageQueueProcessor","processAndUpdate","useEffect$argument_0","AppState.addEventListener$argument_1","<anonymous>"],"mappings":"AAA;qBCc;iCCG,wBD;CDY;4BGG;CHsB;wCIG;uCCO;GDU;YEE;6DCQ;KDI;WEE;KFK;GFC;CJG"},"hasCjsExports":false},"type":"js/module"}]}