{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":65,"index":65}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"../services/messageService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":66},"end":{"line":13,"column":36,"index":309}}],"key":"BgocpR5elj5+H74kAotl+BD0mA8=","exportNames":["*"],"imports":1}},{"name":"../services/networkService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":14,"column":0,"index":310},"end":{"line":14,"column":70,"index":380}}],"key":"9oYCR1OK4qlJRMTdqxwx0Wbqa1Y=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"useChat\", {\n    enumerable: true,\n    get: function () {\n      return useChat;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _servicesMessageService = require(_dependencyMap[1], \"../services/messageService\");\n  var _servicesNetworkService = require(_dependencyMap[2], \"../services/networkService\");\n  const useChat = (currentUserPhone, otherUserPhone) => {\n    _s();\n    const [messages, setMessages] = (0, _react.useState)([]);\n    const [isLoading, setIsLoading] = (0, _react.useState)(true);\n    const chatId = (0, _servicesMessageService.getChatId)(currentUserPhone, otherUserPhone);\n    const unsubscribeRef = (0, _react.useRef)(null);\n\n    // Handle status updates from queue processor\n    const handleStatusUpdate = (0, _react.useCallback)((messageId, msgChatId, status) => {\n      if (msgChatId === chatId) {\n        setMessages(prev => prev.map(m => m.id === messageId ? Object.assign({}, m, {\n          status\n        }) : m));\n      }\n    }, [chatId]);\n    const {\n      isOnline,\n      queueLength\n    } = (0, _servicesNetworkService.useMessageQueueProcessor)(handleStatusUpdate);\n\n    // Load local messages on mount\n    (0, _react.useEffect)(() => {\n      const loadMessages = async () => {\n        setIsLoading(true);\n        const localMessages = await (0, _servicesMessageService.getLocalMessages)(chatId);\n        setMessages(localMessages);\n        setIsLoading(false);\n\n        // Subscribe to new messages from Firebase\n        const lastTimestamp = localMessages.length > 0 ? Math.max(...localMessages.map(m => m.timestamp)) : 0;\n        unsubscribeRef.current = (0, _servicesMessageService.subscribeToNewMessages)(chatId, lastTimestamp, async newMessage => {\n          // Only add if not from current user (avoid duplicates)\n          if (newMessage.sender !== currentUserPhone) {\n            await (0, _servicesMessageService.addMessageLocally)(chatId, newMessage);\n            setMessages(prev => {\n              const exists = prev.find(m => m.id === newMessage.id);\n              if (exists) return prev;\n              return [...prev, newMessage].sort((a, b) => a.timestamp - b.timestamp);\n            });\n          }\n        });\n      };\n      if (currentUserPhone && otherUserPhone) {\n        loadMessages();\n      }\n      return () => {\n        if (unsubscribeRef.current) {\n          unsubscribeRef.current();\n        }\n      };\n    }, [chatId, currentUserPhone, otherUserPhone]);\n\n    // Send message - local first approach\n    const sendMessage = (0, _react.useCallback)(async text => {\n      if (!text.trim()) return;\n      const message = {\n        id: (0, _servicesMessageService.generateMessageId)(),\n        text: text.trim(),\n        sender: currentUserPhone,\n        timestamp: Date.now(),\n        status: 'sending'\n      };\n\n      // 1. Add to local state immediately (instant feedback)\n      setMessages(prev => [...prev, message]);\n\n      // 2. Save to local storage\n      await (0, _servicesMessageService.addMessageLocally)(chatId, message);\n\n      // 3. Try to send to Firebase\n      const success = await (0, _servicesMessageService.sendMessageToFirebase)(chatId, message);\n      if (success) {\n        // Update status to sent\n        await (0, _servicesMessageService.updateMessageStatusLocally)(chatId, message.id, 'sent');\n        setMessages(prev => prev.map(m => m.id === message.id ? Object.assign({}, m, {\n          status: 'sent'\n        }) : m));\n      } else {\n        // Add to queue for retry\n        await (0, _servicesMessageService.addToQueue)(chatId, message);\n        await (0, _servicesMessageService.updateMessageStatusLocally)(chatId, message.id, 'queued');\n        setMessages(prev => prev.map(m => m.id === message.id ? Object.assign({}, m, {\n          status: 'queued'\n        }) : m));\n      }\n    }, [chatId, currentUserPhone]);\n    return {\n      messages,\n      sendMessage,\n      isLoading,\n      isOnline,\n      queueLength,\n      chatId\n    };\n  };\n  _s(useChat, \"NCMHbaxzBQdjz7o75BYdyFBIsMs=\", false, function () {\n    return [_servicesNetworkService.useMessageQueueProcessor];\n  });\n});","lineCount":115,"map":[[8,2,16,0,"Object"],[8,8,16,0],[8,9,16,0,"defineProperty"],[8,23,16,0],[8,24,16,0,"exports"],[8,31,16,0],[9,4,16,0,"enumerable"],[9,14,16,0],[10,4,16,0,"get"],[10,7,16,0],[10,18,16,0,"get"],[10,19,16,0],[11,6,16,0],[11,13,16,0,"useChat"],[11,20,16,0],[12,4,16,0],[13,2,16,0],[14,2,1,0],[14,6,1,0,"_react"],[14,12,1,0],[14,15,1,0,"require"],[14,22,1,0],[14,23,1,0,"_dependencyMap"],[14,37,1,0],[15,2,2,0],[15,6,2,0,"_servicesMessageService"],[15,29,2,0],[15,32,2,0,"require"],[15,39,2,0],[15,40,2,0,"_dependencyMap"],[15,54,2,0],[16,2,14,0],[16,6,14,0,"_servicesNetworkService"],[16,29,14,0],[16,32,14,0,"require"],[16,39,14,0],[16,40,14,0,"_dependencyMap"],[16,54,14,0],[17,2,16,7],[17,8,16,13,"useChat"],[17,15,16,20],[17,18,16,23,"useChat"],[17,19,16,24,"currentUserPhone"],[17,35,16,48],[17,37,16,50,"otherUserPhone"],[17,51,16,72],[17,56,16,77],[18,4,16,77,"_s"],[18,6,16,77],[19,4,17,2],[19,10,17,8],[19,11,17,9,"messages"],[19,19,17,17],[19,21,17,19,"setMessages"],[19,32,17,30],[19,33,17,31],[19,36,17,34],[19,40,17,34,"useState"],[19,46,17,42],[19,47,17,42,"useState"],[19,55,17,42],[19,57,17,54],[19,59,17,56],[19,60,17,57],[20,4,18,2],[20,10,18,8],[20,11,18,9,"isLoading"],[20,20,18,18],[20,22,18,20,"setIsLoading"],[20,34,18,32],[20,35,18,33],[20,38,18,36],[20,42,18,36,"useState"],[20,48,18,44],[20,49,18,44,"useState"],[20,57,18,44],[20,59,18,45],[20,63,18,49],[20,64,18,50],[21,4,19,2],[21,10,19,8,"chatId"],[21,16,19,14],[21,19,19,17],[21,23,19,17,"getChatId"],[21,46,19,26],[21,47,19,26,"getChatId"],[21,56,19,26],[21,58,19,27,"currentUserPhone"],[21,74,19,43],[21,76,19,45,"otherUserPhone"],[21,90,19,59],[21,91,19,60],[22,4,20,2],[22,10,20,8,"unsubscribeRef"],[22,24,20,22],[22,27,20,25],[22,31,20,25,"useRef"],[22,37,20,31],[22,38,20,31,"useRef"],[22,44,20,31],[22,46,20,53],[22,50,20,57],[22,51,20,58],[24,4,22,2],[25,4,23,2],[25,10,23,8,"handleStatusUpdate"],[25,28,23,26],[25,31,23,29],[25,35,23,29,"useCallback"],[25,41,23,40],[25,42,23,40,"useCallback"],[25,53,23,40],[25,55,23,41],[25,56,23,42,"messageId"],[25,65,23,59],[25,67,23,61,"msgChatId"],[25,76,23,78],[25,78,23,80,"status"],[25,84,23,105],[25,89,23,110],[26,6,24,4],[26,10,24,8,"msgChatId"],[26,19,24,17],[26,24,24,22,"chatId"],[26,30,24,28],[26,32,24,30],[27,8,25,6,"setMessages"],[27,19,25,17],[27,20,25,18,"prev"],[27,24,25,22],[27,28,25,26,"prev"],[27,32,25,30],[27,33,25,31,"map"],[27,36,25,34],[27,37,25,35,"m"],[27,38,25,36],[27,42,26,8,"m"],[27,43,26,9],[27,44,26,10,"id"],[27,46,26,12],[27,51,26,17,"messageId"],[27,60,26,26],[27,63,26,26,"Object"],[27,69,26,26],[27,70,26,26,"assign"],[27,76,26,26],[27,81,26,34,"m"],[27,82,26,35],[28,10,26,37,"status"],[29,8,26,43],[29,13,26,48,"m"],[29,14,27,6],[29,15,27,7],[29,16,27,8],[30,6,28,4],[31,4,29,2],[31,5,29,3],[31,7,29,5],[31,8,29,6,"chatId"],[31,14,29,12],[31,15,29,13],[31,16,29,14],[32,4,31,2],[32,10,31,8],[33,6,31,10,"isOnline"],[33,14,31,18],[34,6,31,20,"queueLength"],[35,4,31,32],[35,5,31,33],[35,8,31,36],[35,12,31,36,"useMessageQueueProcessor"],[35,35,31,60],[35,36,31,60,"useMessageQueueProcessor"],[35,60,31,60],[35,62,31,61,"handleStatusUpdate"],[35,80,31,79],[35,81,31,80],[37,4,33,2],[38,4,34,2],[38,8,34,2,"useEffect"],[38,14,34,11],[38,15,34,11,"useEffect"],[38,24,34,11],[38,26,34,12],[38,32,34,18],[39,6,35,4],[39,12,35,10,"loadMessages"],[39,24,35,22],[39,27,35,25],[39,33,35,25,"loadMessages"],[39,34,35,25],[39,39,35,37],[40,8,36,6,"setIsLoading"],[40,20,36,18],[40,21,36,19],[40,25,36,23],[40,26,36,24],[41,8,37,6],[41,14,37,12,"localMessages"],[41,27,37,25],[41,30,37,28],[41,36,37,34],[41,40,37,34,"getLocalMessages"],[41,63,37,50],[41,64,37,50,"getLocalMessages"],[41,80,37,50],[41,82,37,51,"chatId"],[41,88,37,57],[41,89,37,58],[42,8,38,6,"setMessages"],[42,19,38,17],[42,20,38,18,"localMessages"],[42,33,38,31],[42,34,38,32],[43,8,39,6,"setIsLoading"],[43,20,39,18],[43,21,39,19],[43,26,39,24],[43,27,39,25],[45,8,41,6],[46,8,42,6],[46,14,42,12,"lastTimestamp"],[46,27,42,25],[46,30,42,28,"localMessages"],[46,43,42,41],[46,44,42,42,"length"],[46,50,42,48],[46,53,42,51],[46,54,42,52],[46,57,43,10,"Math"],[46,61,43,14],[46,62,43,15,"max"],[46,65,43,18],[46,66,43,19],[46,69,43,22,"localMessages"],[46,82,43,35],[46,83,43,36,"map"],[46,86,43,39],[46,87,43,40,"m"],[46,88,43,41],[46,92,43,45,"m"],[46,93,43,46],[46,94,43,47,"timestamp"],[46,103,43,56],[46,104,43,57],[46,105,43,58],[46,108,44,10],[46,109,44,11],[47,8,46,6,"unsubscribeRef"],[47,22,46,20],[47,23,46,21,"current"],[47,30,46,28],[47,33,46,31],[47,37,46,31,"subscribeToNewMessages"],[47,60,46,53],[47,61,46,53,"subscribeToNewMessages"],[47,83,46,53],[47,85,47,8,"chatId"],[47,91,47,14],[47,93,48,8,"lastTimestamp"],[47,106,48,21],[47,108,49,8],[47,114,49,15,"newMessage"],[47,124,49,25],[47,128,49,30],[48,10,50,10],[49,10,51,10],[49,14,51,14,"newMessage"],[49,24,51,24],[49,25,51,25,"sender"],[49,31,51,31],[49,36,51,36,"currentUserPhone"],[49,52,51,52],[49,54,51,54],[50,12,52,12],[50,18,52,18],[50,22,52,18,"addMessageLocally"],[50,45,52,35],[50,46,52,35,"addMessageLocally"],[50,63,52,35],[50,65,52,36,"chatId"],[50,71,52,42],[50,73,52,44,"newMessage"],[50,83,52,54],[50,84,52,55],[51,12,53,12,"setMessages"],[51,23,53,23],[51,24,53,24,"prev"],[51,28,53,28],[51,32,53,32],[52,14,54,14],[52,20,54,20,"exists"],[52,26,54,26],[52,29,54,29,"prev"],[52,33,54,33],[52,34,54,34,"find"],[52,38,54,38],[52,39,54,39,"m"],[52,40,54,40],[52,44,54,44,"m"],[52,45,54,45],[52,46,54,46,"id"],[52,48,54,48],[52,53,54,53,"newMessage"],[52,63,54,63],[52,64,54,64,"id"],[52,66,54,66],[52,67,54,67],[53,14,55,14],[53,18,55,18,"exists"],[53,24,55,24],[53,26,55,26],[53,33,55,33,"prev"],[53,37,55,37],[54,14,56,14],[54,21,56,21],[54,22,56,22],[54,25,56,25,"prev"],[54,29,56,29],[54,31,56,31,"newMessage"],[54,41,56,41],[54,42,56,42],[54,43,56,43,"sort"],[54,47,56,47],[54,48,56,48],[54,49,56,49,"a"],[54,50,56,50],[54,52,56,52,"b"],[54,53,56,53],[54,58,56,58,"a"],[54,59,56,59],[54,60,56,60,"timestamp"],[54,69,56,69],[54,72,56,72,"b"],[54,73,56,73],[54,74,56,74,"timestamp"],[54,83,56,83],[54,84,56,84],[55,12,57,12],[55,13,57,13],[55,14,57,14],[56,10,58,10],[57,8,59,8],[57,9,60,6],[57,10,60,7],[58,6,61,4],[58,7,61,5],[59,6,63,4],[59,10,63,8,"currentUserPhone"],[59,26,63,24],[59,30,63,28,"otherUserPhone"],[59,44,63,42],[59,46,63,44],[60,8,64,6,"loadMessages"],[60,20,64,18],[60,21,64,19],[60,22,64,20],[61,6,65,4],[62,6,67,4],[62,13,67,11],[62,19,67,17],[63,8,68,6],[63,12,68,10,"unsubscribeRef"],[63,26,68,24],[63,27,68,25,"current"],[63,34,68,32],[63,36,68,34],[64,10,69,8,"unsubscribeRef"],[64,24,69,22],[64,25,69,23,"current"],[64,32,69,30],[64,33,69,31],[64,34,69,32],[65,8,70,6],[66,6,71,4],[66,7,71,5],[67,4,72,2],[67,5,72,3],[67,7,72,5],[67,8,72,6,"chatId"],[67,14,72,12],[67,16,72,14,"currentUserPhone"],[67,32,72,30],[67,34,72,32,"otherUserPhone"],[67,48,72,46],[67,49,72,47],[67,50,72,48],[69,4,74,2],[70,4,75,2],[70,10,75,8,"sendMessage"],[70,21,75,19],[70,24,75,22],[70,28,75,22,"useCallback"],[70,34,75,33],[70,35,75,33,"useCallback"],[70,46,75,33],[70,48,75,34],[70,54,75,41,"text"],[70,58,75,53],[70,62,75,73],[71,6,76,4],[71,10,76,8],[71,11,76,9,"text"],[71,15,76,13],[71,16,76,14,"trim"],[71,20,76,18],[71,21,76,19],[71,22,76,20],[71,24,76,22],[72,6,78,4],[72,12,78,10,"message"],[72,19,78,26],[72,22,78,29],[73,8,79,6,"id"],[73,10,79,8],[73,12,79,10],[73,16,79,10,"generateMessageId"],[73,39,79,27],[73,40,79,27,"generateMessageId"],[73,57,79,27],[73,59,79,28],[73,60,79,29],[74,8,80,6,"text"],[74,12,80,10],[74,14,80,12,"text"],[74,18,80,16],[74,19,80,17,"trim"],[74,23,80,21],[74,24,80,22],[74,25,80,23],[75,8,81,6,"sender"],[75,14,81,12],[75,16,81,14,"currentUserPhone"],[75,32,81,30],[76,8,82,6,"timestamp"],[76,17,82,15],[76,19,82,17,"Date"],[76,23,82,21],[76,24,82,22,"now"],[76,27,82,25],[76,28,82,26],[76,29,82,27],[77,8,83,6,"status"],[77,14,83,12],[77,16,83,14],[78,6,84,4],[78,7,84,5],[80,6,86,4],[81,6,87,4,"setMessages"],[81,17,87,15],[81,18,87,16,"prev"],[81,22,87,20],[81,26,87,24],[81,27,87,25],[81,30,87,28,"prev"],[81,34,87,32],[81,36,87,34,"message"],[81,43,87,41],[81,44,87,42],[81,45,87,43],[83,6,89,4],[84,6,90,4],[84,12,90,10],[84,16,90,10,"addMessageLocally"],[84,39,90,27],[84,40,90,27,"addMessageLocally"],[84,57,90,27],[84,59,90,28,"chatId"],[84,65,90,34],[84,67,90,36,"message"],[84,74,90,43],[84,75,90,44],[86,6,92,4],[87,6,93,4],[87,12,93,10,"success"],[87,19,93,17],[87,22,93,20],[87,28,93,26],[87,32,93,26,"sendMessageToFirebase"],[87,55,93,47],[87,56,93,47,"sendMessageToFirebase"],[87,77,93,47],[87,79,93,48,"chatId"],[87,85,93,54],[87,87,93,56,"message"],[87,94,93,63],[87,95,93,64],[88,6,95,4],[88,10,95,8,"success"],[88,17,95,15],[88,19,95,17],[89,8,96,6],[90,8,97,6],[90,14,97,12],[90,18,97,12,"updateMessageStatusLocally"],[90,41,97,38],[90,42,97,38,"updateMessageStatusLocally"],[90,68,97,38],[90,70,97,39,"chatId"],[90,76,97,45],[90,78,97,47,"message"],[90,85,97,54],[90,86,97,55,"id"],[90,88,97,57],[90,90,97,59],[90,96,97,65],[90,97,97,66],[91,8,98,6,"setMessages"],[91,19,98,17],[91,20,98,18,"prev"],[91,24,98,22],[91,28,98,26,"prev"],[91,32,98,30],[91,33,98,31,"map"],[91,36,98,34],[91,37,98,35,"m"],[91,38,98,36],[91,42,99,8,"m"],[91,43,99,9],[91,44,99,10,"id"],[91,46,99,12],[91,51,99,17,"message"],[91,58,99,24],[91,59,99,25,"id"],[91,61,99,27],[91,64,99,27,"Object"],[91,70,99,27],[91,71,99,27,"assign"],[91,77,99,27],[91,82,99,35,"m"],[91,83,99,36],[92,10,99,38,"status"],[92,16,99,44],[92,18,99,46],[93,8,99,52],[93,13,99,57,"m"],[93,14,100,6],[93,15,100,7],[93,16,100,8],[94,6,101,4],[94,7,101,5],[94,13,101,11],[95,8,102,6],[96,8,103,6],[96,14,103,12],[96,18,103,12,"addToQueue"],[96,41,103,22],[96,42,103,22,"addToQueue"],[96,52,103,22],[96,54,103,23,"chatId"],[96,60,103,29],[96,62,103,31,"message"],[96,69,103,38],[96,70,103,39],[97,8,104,6],[97,14,104,12],[97,18,104,12,"updateMessageStatusLocally"],[97,41,104,38],[97,42,104,38,"updateMessageStatusLocally"],[97,68,104,38],[97,70,104,39,"chatId"],[97,76,104,45],[97,78,104,47,"message"],[97,85,104,54],[97,86,104,55,"id"],[97,88,104,57],[97,90,104,59],[97,98,104,67],[97,99,104,68],[98,8,105,6,"setMessages"],[98,19,105,17],[98,20,105,18,"prev"],[98,24,105,22],[98,28,105,26,"prev"],[98,32,105,30],[98,33,105,31,"map"],[98,36,105,34],[98,37,105,35,"m"],[98,38,105,36],[98,42,106,8,"m"],[98,43,106,9],[98,44,106,10,"id"],[98,46,106,12],[98,51,106,17,"message"],[98,58,106,24],[98,59,106,25,"id"],[98,61,106,27],[98,64,106,27,"Object"],[98,70,106,27],[98,71,106,27,"assign"],[98,77,106,27],[98,82,106,35,"m"],[98,83,106,36],[99,10,106,38,"status"],[99,16,106,44],[99,18,106,46],[100,8,106,54],[100,13,106,59,"m"],[100,14,107,6],[100,15,107,7],[100,16,107,8],[101,6,108,4],[102,4,109,2],[102,5,109,3],[102,7,109,5],[102,8,109,6,"chatId"],[102,14,109,12],[102,16,109,14,"currentUserPhone"],[102,32,109,30],[102,33,109,31],[102,34,109,32],[103,4,111,2],[103,11,111,9],[104,6,112,4,"messages"],[104,14,112,12],[105,6,113,4,"sendMessage"],[105,17,113,15],[106,6,114,4,"isLoading"],[106,15,114,13],[107,6,115,4,"isOnline"],[107,14,115,12],[108,6,116,4,"queueLength"],[108,17,116,15],[109,6,117,4,"chatId"],[110,4,118,2],[110,5,118,3],[111,2,119,0],[111,3,119,1],[112,2,119,2,"_s"],[112,4,119,2],[112,5,16,13,"useChat"],[112,12,16,20],[113,4,16,20],[113,12,31,36,"useMessageQueueProcessor"],[113,35,31,60],[113,36,31,60,"useMessageQueueProcessor"],[113,60,31,60],[114,2,31,60],[115,0,31,60],[115,3]],"functionMap":{"names":["<global>","useChat","handleStatusUpdate","setMessages$argument_0","prev.map$argument_0","useEffect$argument_0","loadMessages","localMessages.map$argument_0","subscribeToNewMessages$argument_2","prev.find$argument_0","sort$argument_0","<anonymous>","sendMessage"],"mappings":"AAA;uBCe;yCCO;kBCE,iBC;iDDC;ODC;GDE;YIK;yBCC;wCCQ,gBD;QEM;wBLI;uCMC,2BN;gDOE,mCP;aKC;SFE;KDE;WMM;KNI;GJC;kCWG;gBTY,0BS;kBTW,iBC;0DDC;OSC;kBTK,iBC;4DDC;OSC;GXE;CDU"},"hasCjsExports":false},"type":"js/module"}]}