{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":65,"index":65}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"../services/messageService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":66},"end":{"line":13,"column":36,"index":309}}],"key":"BgocpR5elj5+H74kAotl+BD0mA8=","exportNames":["*"],"imports":1}},{"name":"../services/networkService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":14,"column":0,"index":310},"end":{"line":14,"column":70,"index":380}}],"key":"9oYCR1OK4qlJRMTdqxwx0Wbqa1Y=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"useChat\", {\n    enumerable: true,\n    get: function () {\n      return useChat;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _servicesMessageService = require(_dependencyMap[1], \"../services/messageService\");\n  var _servicesNetworkService = require(_dependencyMap[2], \"../services/networkService\");\n  const useChat = (currentUserPhone, otherUserPhone) => {\n    _s();\n    const [messages, setMessages] = (0, _react.useState)([]);\n    const [isLoading, setIsLoading] = (0, _react.useState)(true);\n    const chatId = (0, _servicesMessageService.getChatId)(currentUserPhone, otherUserPhone);\n    const unsubscribeRef = (0, _react.useRef)(null);\n\n    // Handle status updates from queue processor\n    const handleStatusUpdate = (0, _react.useCallback)((messageId, msgChatId, status) => {\n      if (msgChatId === chatId) {\n        setMessages(prev => prev.map(m => m.id === messageId ? {\n          ...m,\n          status\n        } : m));\n      }\n    }, [chatId]);\n    const {\n      isOnline,\n      queueLength\n    } = (0, _servicesNetworkService.useMessageQueueProcessor)(handleStatusUpdate);\n\n    // Load local messages on mount\n    (0, _react.useEffect)(() => {\n      const loadMessages = async () => {\n        setIsLoading(true);\n        const localMessages = await (0, _servicesMessageService.getLocalMessages)(chatId);\n        setMessages(localMessages);\n        setIsLoading(false);\n\n        // Subscribe to new messages from Firebase\n        const lastTimestamp = localMessages.length > 0 ? Math.max(...localMessages.map(m => m.timestamp)) : 0;\n        unsubscribeRef.current = (0, _servicesMessageService.subscribeToNewMessages)(chatId, lastTimestamp, async newMessage => {\n          // Only add if not from current user (avoid duplicates)\n          if (newMessage.sender !== currentUserPhone) {\n            await (0, _servicesMessageService.addMessageLocally)(chatId, newMessage);\n            setMessages(prev => {\n              const exists = prev.find(m => m.id === newMessage.id);\n              if (exists) return prev;\n              return [...prev, newMessage].sort((a, b) => a.timestamp - b.timestamp);\n            });\n          }\n        });\n      };\n      if (currentUserPhone && otherUserPhone) {\n        loadMessages();\n      }\n      return () => {\n        if (unsubscribeRef.current) {\n          unsubscribeRef.current();\n        }\n      };\n    }, [chatId, currentUserPhone, otherUserPhone]);\n\n    // Send message - local first approach\n    const sendMessage = (0, _react.useCallback)(async text => {\n      if (!text.trim()) return;\n      const message = {\n        id: (0, _servicesMessageService.generateMessageId)(),\n        text: text.trim(),\n        sender: currentUserPhone,\n        timestamp: Date.now(),\n        status: 'sending'\n      };\n\n      // 1. Add to local state immediately (instant feedback)\n      setMessages(prev => [...prev, message]);\n\n      // 2. Save to local storage\n      await (0, _servicesMessageService.addMessageLocally)(chatId, message);\n\n      // 3. Try to send to Firebase\n      const success = await (0, _servicesMessageService.sendMessageToFirebase)(chatId, message);\n      if (success) {\n        // Update status to sent\n        await (0, _servicesMessageService.updateMessageStatusLocally)(chatId, message.id, 'sent');\n        setMessages(prev => prev.map(m => m.id === message.id ? {\n          ...m,\n          status: 'sent'\n        } : m));\n      } else {\n        // Add to queue for retry\n        await (0, _servicesMessageService.addToQueue)(chatId, message);\n        await (0, _servicesMessageService.updateMessageStatusLocally)(chatId, message.id, 'queued');\n        setMessages(prev => prev.map(m => m.id === message.id ? {\n          ...m,\n          status: 'queued'\n        } : m));\n      }\n    }, [chatId, currentUserPhone]);\n    return {\n      messages,\n      sendMessage,\n      isLoading,\n      isOnline,\n      queueLength,\n      chatId\n    };\n  };\n  _s(useChat, \"NCMHbaxzBQdjz7o75BYdyFBIsMs=\", false, function () {\n    return [_servicesNetworkService.useMessageQueueProcessor];\n  });\n});","lineCount":118,"map":[[8,2,16,0,"Object"],[8,8,16,0],[8,9,16,0,"defineProperty"],[8,23,16,0],[8,24,16,0,"exports"],[8,31,16,0],[9,4,16,0,"enumerable"],[9,14,16,0],[10,4,16,0,"get"],[10,7,16,0],[10,18,16,0,"get"],[10,19,16,0],[11,6,16,0],[11,13,16,0,"useChat"],[11,20,16,0],[12,4,16,0],[13,2,16,0],[14,2,1,0],[14,6,1,0,"_react"],[14,12,1,0],[14,15,1,0,"require"],[14,22,1,0],[14,23,1,0,"_dependencyMap"],[14,37,1,0],[15,2,2,0],[15,6,2,0,"_servicesMessageService"],[15,29,2,0],[15,32,2,0,"require"],[15,39,2,0],[15,40,2,0,"_dependencyMap"],[15,54,2,0],[16,2,14,0],[16,6,14,0,"_servicesNetworkService"],[16,29,14,0],[16,32,14,0,"require"],[16,39,14,0],[16,40,14,0,"_dependencyMap"],[16,54,14,0],[17,2,16,7],[17,8,16,13,"useChat"],[17,15,16,20],[17,18,16,23,"useChat"],[17,19,16,24,"currentUserPhone"],[17,35,16,48],[17,37,16,50,"otherUserPhone"],[17,51,16,72],[17,56,16,77],[18,4,16,77,"_s"],[18,6,16,77],[19,4,17,2],[19,10,17,8],[19,11,17,9,"messages"],[19,19,17,17],[19,21,17,19,"setMessages"],[19,32,17,30],[19,33,17,31],[19,36,17,34],[19,40,17,34,"useState"],[19,46,17,42],[19,47,17,42,"useState"],[19,55,17,42],[19,57,17,54],[19,59,17,56],[19,60,17,57],[20,4,18,2],[20,10,18,8],[20,11,18,9,"isLoading"],[20,20,18,18],[20,22,18,20,"setIsLoading"],[20,34,18,32],[20,35,18,33],[20,38,18,36],[20,42,18,36,"useState"],[20,48,18,44],[20,49,18,44,"useState"],[20,57,18,44],[20,59,18,45],[20,63,18,49],[20,64,18,50],[21,4,19,2],[21,10,19,8,"chatId"],[21,16,19,14],[21,19,19,17],[21,23,19,17,"getChatId"],[21,46,19,26],[21,47,19,26,"getChatId"],[21,56,19,26],[21,58,19,27,"currentUserPhone"],[21,74,19,43],[21,76,19,45,"otherUserPhone"],[21,90,19,59],[21,91,19,60],[22,4,20,2],[22,10,20,8,"unsubscribeRef"],[22,24,20,22],[22,27,20,25],[22,31,20,25,"useRef"],[22,37,20,31],[22,38,20,31,"useRef"],[22,44,20,31],[22,46,20,53],[22,50,20,57],[22,51,20,58],[24,4,22,2],[25,4,23,2],[25,10,23,8,"handleStatusUpdate"],[25,28,23,26],[25,31,23,29],[25,35,23,29,"useCallback"],[25,41,23,40],[25,42,23,40,"useCallback"],[25,53,23,40],[25,55,23,41],[25,56,23,42,"messageId"],[25,65,23,59],[25,67,23,61,"msgChatId"],[25,76,23,78],[25,78,23,80,"status"],[25,84,23,105],[25,89,23,110],[26,6,24,4],[26,10,24,8,"msgChatId"],[26,19,24,17],[26,24,24,22,"chatId"],[26,30,24,28],[26,32,24,30],[27,8,25,6,"setMessages"],[27,19,25,17],[27,20,25,18,"prev"],[27,24,25,22],[27,28,25,26,"prev"],[27,32,25,30],[27,33,25,31,"map"],[27,36,25,34],[27,37,25,35,"m"],[27,38,25,36],[27,42,26,8,"m"],[27,43,26,9],[27,44,26,10,"id"],[27,46,26,12],[27,51,26,17,"messageId"],[27,60,26,26],[27,63,26,29],[28,10,26,31],[28,13,26,34,"m"],[28,14,26,35],[29,10,26,37,"status"],[30,8,26,44],[30,9,26,45],[30,12,26,48,"m"],[30,13,27,6],[30,14,27,7],[30,15,27,8],[31,6,28,4],[32,4,29,2],[32,5,29,3],[32,7,29,5],[32,8,29,6,"chatId"],[32,14,29,12],[32,15,29,13],[32,16,29,14],[33,4,31,2],[33,10,31,8],[34,6,31,10,"isOnline"],[34,14,31,18],[35,6,31,20,"queueLength"],[36,4,31,32],[36,5,31,33],[36,8,31,36],[36,12,31,36,"useMessageQueueProcessor"],[36,35,31,60],[36,36,31,60,"useMessageQueueProcessor"],[36,60,31,60],[36,62,31,61,"handleStatusUpdate"],[36,80,31,79],[36,81,31,80],[38,4,33,2],[39,4,34,2],[39,8,34,2,"useEffect"],[39,14,34,11],[39,15,34,11,"useEffect"],[39,24,34,11],[39,26,34,12],[39,32,34,18],[40,6,35,4],[40,12,35,10,"loadMessages"],[40,24,35,22],[40,27,35,25],[40,33,35,25,"loadMessages"],[40,34,35,25],[40,39,35,37],[41,8,36,6,"setIsLoading"],[41,20,36,18],[41,21,36,19],[41,25,36,23],[41,26,36,24],[42,8,37,6],[42,14,37,12,"localMessages"],[42,27,37,25],[42,30,37,28],[42,36,37,34],[42,40,37,34,"getLocalMessages"],[42,63,37,50],[42,64,37,50,"getLocalMessages"],[42,80,37,50],[42,82,37,51,"chatId"],[42,88,37,57],[42,89,37,58],[43,8,38,6,"setMessages"],[43,19,38,17],[43,20,38,18,"localMessages"],[43,33,38,31],[43,34,38,32],[44,8,39,6,"setIsLoading"],[44,20,39,18],[44,21,39,19],[44,26,39,24],[44,27,39,25],[46,8,41,6],[47,8,42,6],[47,14,42,12,"lastTimestamp"],[47,27,42,25],[47,30,42,28,"localMessages"],[47,43,42,41],[47,44,42,42,"length"],[47,50,42,48],[47,53,42,51],[47,54,42,52],[47,57,43,10,"Math"],[47,61,43,14],[47,62,43,15,"max"],[47,65,43,18],[47,66,43,19],[47,69,43,22,"localMessages"],[47,82,43,35],[47,83,43,36,"map"],[47,86,43,39],[47,87,43,40,"m"],[47,88,43,41],[47,92,43,45,"m"],[47,93,43,46],[47,94,43,47,"timestamp"],[47,103,43,56],[47,104,43,57],[47,105,43,58],[47,108,44,10],[47,109,44,11],[48,8,46,6,"unsubscribeRef"],[48,22,46,20],[48,23,46,21,"current"],[48,30,46,28],[48,33,46,31],[48,37,46,31,"subscribeToNewMessages"],[48,60,46,53],[48,61,46,53,"subscribeToNewMessages"],[48,83,46,53],[48,85,47,8,"chatId"],[48,91,47,14],[48,93,48,8,"lastTimestamp"],[48,106,48,21],[48,108,49,8],[48,114,49,15,"newMessage"],[48,124,49,25],[48,128,49,30],[49,10,50,10],[50,10,51,10],[50,14,51,14,"newMessage"],[50,24,51,24],[50,25,51,25,"sender"],[50,31,51,31],[50,36,51,36,"currentUserPhone"],[50,52,51,52],[50,54,51,54],[51,12,52,12],[51,18,52,18],[51,22,52,18,"addMessageLocally"],[51,45,52,35],[51,46,52,35,"addMessageLocally"],[51,63,52,35],[51,65,52,36,"chatId"],[51,71,52,42],[51,73,52,44,"newMessage"],[51,83,52,54],[51,84,52,55],[52,12,53,12,"setMessages"],[52,23,53,23],[52,24,53,24,"prev"],[52,28,53,28],[52,32,53,32],[53,14,54,14],[53,20,54,20,"exists"],[53,26,54,26],[53,29,54,29,"prev"],[53,33,54,33],[53,34,54,34,"find"],[53,38,54,38],[53,39,54,39,"m"],[53,40,54,40],[53,44,54,44,"m"],[53,45,54,45],[53,46,54,46,"id"],[53,48,54,48],[53,53,54,53,"newMessage"],[53,63,54,63],[53,64,54,64,"id"],[53,66,54,66],[53,67,54,67],[54,14,55,14],[54,18,55,18,"exists"],[54,24,55,24],[54,26,55,26],[54,33,55,33,"prev"],[54,37,55,37],[55,14,56,14],[55,21,56,21],[55,22,56,22],[55,25,56,25,"prev"],[55,29,56,29],[55,31,56,31,"newMessage"],[55,41,56,41],[55,42,56,42],[55,43,56,43,"sort"],[55,47,56,47],[55,48,56,48],[55,49,56,49,"a"],[55,50,56,50],[55,52,56,52,"b"],[55,53,56,53],[55,58,56,58,"a"],[55,59,56,59],[55,60,56,60,"timestamp"],[55,69,56,69],[55,72,56,72,"b"],[55,73,56,73],[55,74,56,74,"timestamp"],[55,83,56,83],[55,84,56,84],[56,12,57,12],[56,13,57,13],[56,14,57,14],[57,10,58,10],[58,8,59,8],[58,9,60,6],[58,10,60,7],[59,6,61,4],[59,7,61,5],[60,6,63,4],[60,10,63,8,"currentUserPhone"],[60,26,63,24],[60,30,63,28,"otherUserPhone"],[60,44,63,42],[60,46,63,44],[61,8,64,6,"loadMessages"],[61,20,64,18],[61,21,64,19],[61,22,64,20],[62,6,65,4],[63,6,67,4],[63,13,67,11],[63,19,67,17],[64,8,68,6],[64,12,68,10,"unsubscribeRef"],[64,26,68,24],[64,27,68,25,"current"],[64,34,68,32],[64,36,68,34],[65,10,69,8,"unsubscribeRef"],[65,24,69,22],[65,25,69,23,"current"],[65,32,69,30],[65,33,69,31],[65,34,69,32],[66,8,70,6],[67,6,71,4],[67,7,71,5],[68,4,72,2],[68,5,72,3],[68,7,72,5],[68,8,72,6,"chatId"],[68,14,72,12],[68,16,72,14,"currentUserPhone"],[68,32,72,30],[68,34,72,32,"otherUserPhone"],[68,48,72,46],[68,49,72,47],[68,50,72,48],[70,4,74,2],[71,4,75,2],[71,10,75,8,"sendMessage"],[71,21,75,19],[71,24,75,22],[71,28,75,22,"useCallback"],[71,34,75,33],[71,35,75,33,"useCallback"],[71,46,75,33],[71,48,75,34],[71,54,75,41,"text"],[71,58,75,53],[71,62,75,73],[72,6,76,4],[72,10,76,8],[72,11,76,9,"text"],[72,15,76,13],[72,16,76,14,"trim"],[72,20,76,18],[72,21,76,19],[72,22,76,20],[72,24,76,22],[73,6,78,4],[73,12,78,10,"message"],[73,19,78,26],[73,22,78,29],[74,8,79,6,"id"],[74,10,79,8],[74,12,79,10],[74,16,79,10,"generateMessageId"],[74,39,79,27],[74,40,79,27,"generateMessageId"],[74,57,79,27],[74,59,79,28],[74,60,79,29],[75,8,80,6,"text"],[75,12,80,10],[75,14,80,12,"text"],[75,18,80,16],[75,19,80,17,"trim"],[75,23,80,21],[75,24,80,22],[75,25,80,23],[76,8,81,6,"sender"],[76,14,81,12],[76,16,81,14,"currentUserPhone"],[76,32,81,30],[77,8,82,6,"timestamp"],[77,17,82,15],[77,19,82,17,"Date"],[77,23,82,21],[77,24,82,22,"now"],[77,27,82,25],[77,28,82,26],[77,29,82,27],[78,8,83,6,"status"],[78,14,83,12],[78,16,83,14],[79,6,84,4],[79,7,84,5],[81,6,86,4],[82,6,87,4,"setMessages"],[82,17,87,15],[82,18,87,16,"prev"],[82,22,87,20],[82,26,87,24],[82,27,87,25],[82,30,87,28,"prev"],[82,34,87,32],[82,36,87,34,"message"],[82,43,87,41],[82,44,87,42],[82,45,87,43],[84,6,89,4],[85,6,90,4],[85,12,90,10],[85,16,90,10,"addMessageLocally"],[85,39,90,27],[85,40,90,27,"addMessageLocally"],[85,57,90,27],[85,59,90,28,"chatId"],[85,65,90,34],[85,67,90,36,"message"],[85,74,90,43],[85,75,90,44],[87,6,92,4],[88,6,93,4],[88,12,93,10,"success"],[88,19,93,17],[88,22,93,20],[88,28,93,26],[88,32,93,26,"sendMessageToFirebase"],[88,55,93,47],[88,56,93,47,"sendMessageToFirebase"],[88,77,93,47],[88,79,93,48,"chatId"],[88,85,93,54],[88,87,93,56,"message"],[88,94,93,63],[88,95,93,64],[89,6,95,4],[89,10,95,8,"success"],[89,17,95,15],[89,19,95,17],[90,8,96,6],[91,8,97,6],[91,14,97,12],[91,18,97,12,"updateMessageStatusLocally"],[91,41,97,38],[91,42,97,38,"updateMessageStatusLocally"],[91,68,97,38],[91,70,97,39,"chatId"],[91,76,97,45],[91,78,97,47,"message"],[91,85,97,54],[91,86,97,55,"id"],[91,88,97,57],[91,90,97,59],[91,96,97,65],[91,97,97,66],[92,8,98,6,"setMessages"],[92,19,98,17],[92,20,98,18,"prev"],[92,24,98,22],[92,28,98,26,"prev"],[92,32,98,30],[92,33,98,31,"map"],[92,36,98,34],[92,37,98,35,"m"],[92,38,98,36],[92,42,99,8,"m"],[92,43,99,9],[92,44,99,10,"id"],[92,46,99,12],[92,51,99,17,"message"],[92,58,99,24],[92,59,99,25,"id"],[92,61,99,27],[92,64,99,30],[93,10,99,32],[93,13,99,35,"m"],[93,14,99,36],[94,10,99,38,"status"],[94,16,99,44],[94,18,99,46],[95,8,99,53],[95,9,99,54],[95,12,99,57,"m"],[95,13,100,6],[95,14,100,7],[95,15,100,8],[96,6,101,4],[96,7,101,5],[96,13,101,11],[97,8,102,6],[98,8,103,6],[98,14,103,12],[98,18,103,12,"addToQueue"],[98,41,103,22],[98,42,103,22,"addToQueue"],[98,52,103,22],[98,54,103,23,"chatId"],[98,60,103,29],[98,62,103,31,"message"],[98,69,103,38],[98,70,103,39],[99,8,104,6],[99,14,104,12],[99,18,104,12,"updateMessageStatusLocally"],[99,41,104,38],[99,42,104,38,"updateMessageStatusLocally"],[99,68,104,38],[99,70,104,39,"chatId"],[99,76,104,45],[99,78,104,47,"message"],[99,85,104,54],[99,86,104,55,"id"],[99,88,104,57],[99,90,104,59],[99,98,104,67],[99,99,104,68],[100,8,105,6,"setMessages"],[100,19,105,17],[100,20,105,18,"prev"],[100,24,105,22],[100,28,105,26,"prev"],[100,32,105,30],[100,33,105,31,"map"],[100,36,105,34],[100,37,105,35,"m"],[100,38,105,36],[100,42,106,8,"m"],[100,43,106,9],[100,44,106,10,"id"],[100,46,106,12],[100,51,106,17,"message"],[100,58,106,24],[100,59,106,25,"id"],[100,61,106,27],[100,64,106,30],[101,10,106,32],[101,13,106,35,"m"],[101,14,106,36],[102,10,106,38,"status"],[102,16,106,44],[102,18,106,46],[103,8,106,55],[103,9,106,56],[103,12,106,59,"m"],[103,13,107,6],[103,14,107,7],[103,15,107,8],[104,6,108,4],[105,4,109,2],[105,5,109,3],[105,7,109,5],[105,8,109,6,"chatId"],[105,14,109,12],[105,16,109,14,"currentUserPhone"],[105,32,109,30],[105,33,109,31],[105,34,109,32],[106,4,111,2],[106,11,111,9],[107,6,112,4,"messages"],[107,14,112,12],[108,6,113,4,"sendMessage"],[108,17,113,15],[109,6,114,4,"isLoading"],[109,15,114,13],[110,6,115,4,"isOnline"],[110,14,115,12],[111,6,116,4,"queueLength"],[111,17,116,15],[112,6,117,4,"chatId"],[113,4,118,2],[113,5,118,3],[114,2,119,0],[114,3,119,1],[115,2,119,2,"_s"],[115,4,119,2],[115,5,16,13,"useChat"],[115,12,16,20],[116,4,16,20],[116,12,31,36,"useMessageQueueProcessor"],[116,35,31,60],[116,36,31,60,"useMessageQueueProcessor"],[116,60,31,60],[117,2,31,60],[118,0,31,60],[118,3]],"functionMap":{"names":["<global>","useChat","handleStatusUpdate","setMessages$argument_0","prev.map$argument_0","useEffect$argument_0","loadMessages","localMessages.map$argument_0","subscribeToNewMessages$argument_2","prev.find$argument_0","sort$argument_0","<anonymous>","sendMessage"],"mappings":"AAA;uBCe;yCCO;kBCE,iBC;iDDC;ODC;GDE;YIK;yBCC;wCCQ,gBD;QEM;wBLI;uCMC,2BN;gDOE,mCP;aKC;SFE;KDE;WMM;KNI;GJC;kCWG;gBTY,0BS;kBTW,iBC;0DDC;OSC;kBTK,iBC;4DDC;OSC;GXE;CDU"},"hasCjsExports":false},"type":"js/module"}]}