{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":65,"index":65}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"../services/messageService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":66},"end":{"line":13,"column":36,"index":309}}],"key":"BgocpR5elj5+H74kAotl+BD0mA8=","exportNames":["*"],"imports":1}},{"name":"../services/networkService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":14,"column":0,"index":310},"end":{"line":14,"column":70,"index":380}}],"key":"9oYCR1OK4qlJRMTdqxwx0Wbqa1Y=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"useChat\", {\n    enumerable: true,\n    get: function () {\n      return useChat;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _servicesMessageService = require(_dependencyMap[1], \"../services/messageService\");\n  var _servicesNetworkService = require(_dependencyMap[2], \"../services/networkService\");\n  const useChat = (currentUserPhone, otherUserPhone) => {\n    const [messages, setMessages] = (0, _react.useState)([]);\n    const [isLoading, setIsLoading] = (0, _react.useState)(true);\n    const chatId = (0, _servicesMessageService.getChatId)(currentUserPhone, otherUserPhone);\n    const unsubscribeRef = (0, _react.useRef)(null);\n\n    // Handle status updates from queue processor\n    const handleStatusUpdate = (0, _react.useCallback)((messageId, msgChatId, status) => {\n      if (msgChatId === chatId) {\n        setMessages(prev => prev.map(m => m.id === messageId ? {\n          ...m,\n          status\n        } : m));\n      }\n    }, [chatId]);\n    const {\n      isOnline,\n      queueLength\n    } = (0, _servicesNetworkService.useMessageQueueProcessor)(handleStatusUpdate);\n\n    // Load local messages on mount\n    (0, _react.useEffect)(() => {\n      const loadMessages = async () => {\n        setIsLoading(true);\n        const localMessages = await (0, _servicesMessageService.getLocalMessages)(chatId);\n        setMessages(localMessages);\n        setIsLoading(false);\n\n        // Subscribe to new messages from Firebase\n        const lastTimestamp = localMessages.length > 0 ? Math.max(...localMessages.map(m => m.timestamp)) : 0;\n        unsubscribeRef.current = (0, _servicesMessageService.subscribeToNewMessages)(chatId, lastTimestamp, async newMessage => {\n          // Only add if not from current user (avoid duplicates)\n          if (newMessage.sender !== currentUserPhone) {\n            await (0, _servicesMessageService.addMessageLocally)(chatId, newMessage);\n            setMessages(prev => {\n              const exists = prev.find(m => m.id === newMessage.id);\n              if (exists) return prev;\n              return [...prev, newMessage].sort((a, b) => a.timestamp - b.timestamp);\n            });\n          }\n        });\n      };\n      if (currentUserPhone && otherUserPhone) {\n        loadMessages();\n      }\n      return () => {\n        if (unsubscribeRef.current) {\n          unsubscribeRef.current();\n        }\n      };\n    }, [chatId, currentUserPhone, otherUserPhone]);\n\n    // Send message - local first approach\n    const sendMessage = (0, _react.useCallback)(async text => {\n      if (!text.trim()) return;\n      const message = {\n        id: (0, _servicesMessageService.generateMessageId)(),\n        text: text.trim(),\n        sender: currentUserPhone,\n        timestamp: Date.now(),\n        status: 'sending'\n      };\n\n      // 1. Add to local state immediately (instant feedback)\n      setMessages(prev => [...prev, message]);\n\n      // 2. Save to local storage\n      await (0, _servicesMessageService.addMessageLocally)(chatId, message);\n\n      // 3. Try to send to Firebase\n      const success = await (0, _servicesMessageService.sendMessageToFirebase)(chatId, message);\n      if (success) {\n        // Update status to sent\n        await (0, _servicesMessageService.updateMessageStatusLocally)(chatId, message.id, 'sent');\n        setMessages(prev => prev.map(m => m.id === message.id ? {\n          ...m,\n          status: 'sent'\n        } : m));\n      } else {\n        // Add to queue for retry\n        await (0, _servicesMessageService.addToQueue)(chatId, message);\n        await (0, _servicesMessageService.updateMessageStatusLocally)(chatId, message.id, 'queued');\n        setMessages(prev => prev.map(m => m.id === message.id ? {\n          ...m,\n          status: 'queued'\n        } : m));\n      }\n    }, [chatId, currentUserPhone]);\n    return {\n      messages,\n      sendMessage,\n      isLoading,\n      isOnline,\n      queueLength,\n      chatId\n    };\n  };\n});","lineCount":113,"map":[[7,2,16,0,"Object"],[7,8,16,0],[7,9,16,0,"defineProperty"],[7,23,16,0],[7,24,16,0,"exports"],[7,31,16,0],[8,4,16,0,"enumerable"],[8,14,16,0],[9,4,16,0,"get"],[9,7,16,0],[9,18,16,0,"get"],[9,19,16,0],[10,6,16,0],[10,13,16,0,"useChat"],[10,20,16,0],[11,4,16,0],[12,2,16,0],[13,2,1,0],[13,6,1,0,"_react"],[13,12,1,0],[13,15,1,0,"require"],[13,22,1,0],[13,23,1,0,"_dependencyMap"],[13,37,1,0],[14,2,2,0],[14,6,2,0,"_servicesMessageService"],[14,29,2,0],[14,32,2,0,"require"],[14,39,2,0],[14,40,2,0,"_dependencyMap"],[14,54,2,0],[15,2,14,0],[15,6,14,0,"_servicesNetworkService"],[15,29,14,0],[15,32,14,0,"require"],[15,39,14,0],[15,40,14,0,"_dependencyMap"],[15,54,14,0],[16,2,16,7],[16,8,16,13,"useChat"],[16,15,16,20],[16,18,16,23,"useChat"],[16,19,16,24,"currentUserPhone"],[16,35,16,48],[16,37,16,50,"otherUserPhone"],[16,51,16,72],[16,56,16,77],[17,4,17,2],[17,10,17,8],[17,11,17,9,"messages"],[17,19,17,17],[17,21,17,19,"setMessages"],[17,32,17,30],[17,33,17,31],[17,36,17,34],[17,40,17,34,"useState"],[17,46,17,42],[17,47,17,42,"useState"],[17,55,17,42],[17,57,17,54],[17,59,17,56],[17,60,17,57],[18,4,18,2],[18,10,18,8],[18,11,18,9,"isLoading"],[18,20,18,18],[18,22,18,20,"setIsLoading"],[18,34,18,32],[18,35,18,33],[18,38,18,36],[18,42,18,36,"useState"],[18,48,18,44],[18,49,18,44,"useState"],[18,57,18,44],[18,59,18,45],[18,63,18,49],[18,64,18,50],[19,4,19,2],[19,10,19,8,"chatId"],[19,16,19,14],[19,19,19,17],[19,23,19,17,"getChatId"],[19,46,19,26],[19,47,19,26,"getChatId"],[19,56,19,26],[19,58,19,27,"currentUserPhone"],[19,74,19,43],[19,76,19,45,"otherUserPhone"],[19,90,19,59],[19,91,19,60],[20,4,20,2],[20,10,20,8,"unsubscribeRef"],[20,24,20,22],[20,27,20,25],[20,31,20,25,"useRef"],[20,37,20,31],[20,38,20,31,"useRef"],[20,44,20,31],[20,46,20,53],[20,50,20,57],[20,51,20,58],[22,4,22,2],[23,4,23,2],[23,10,23,8,"handleStatusUpdate"],[23,28,23,26],[23,31,23,29],[23,35,23,29,"useCallback"],[23,41,23,40],[23,42,23,40,"useCallback"],[23,53,23,40],[23,55,23,41],[23,56,23,42,"messageId"],[23,65,23,59],[23,67,23,61,"msgChatId"],[23,76,23,78],[23,78,23,80,"status"],[23,84,23,105],[23,89,23,110],[24,6,24,4],[24,10,24,8,"msgChatId"],[24,19,24,17],[24,24,24,22,"chatId"],[24,30,24,28],[24,32,24,30],[25,8,25,6,"setMessages"],[25,19,25,17],[25,20,25,18,"prev"],[25,24,25,22],[25,28,25,26,"prev"],[25,32,25,30],[25,33,25,31,"map"],[25,36,25,34],[25,37,25,35,"m"],[25,38,25,36],[25,42,26,8,"m"],[25,43,26,9],[25,44,26,10,"id"],[25,46,26,12],[25,51,26,17,"messageId"],[25,60,26,26],[25,63,26,29],[26,10,26,31],[26,13,26,34,"m"],[26,14,26,35],[27,10,26,37,"status"],[28,8,26,44],[28,9,26,45],[28,12,26,48,"m"],[28,13,27,6],[28,14,27,7],[28,15,27,8],[29,6,28,4],[30,4,29,2],[30,5,29,3],[30,7,29,5],[30,8,29,6,"chatId"],[30,14,29,12],[30,15,29,13],[30,16,29,14],[31,4,31,2],[31,10,31,8],[32,6,31,10,"isOnline"],[32,14,31,18],[33,6,31,20,"queueLength"],[34,4,31,32],[34,5,31,33],[34,8,31,36],[34,12,31,36,"useMessageQueueProcessor"],[34,35,31,60],[34,36,31,60,"useMessageQueueProcessor"],[34,60,31,60],[34,62,31,61,"handleStatusUpdate"],[34,80,31,79],[34,81,31,80],[36,4,33,2],[37,4,34,2],[37,8,34,2,"useEffect"],[37,14,34,11],[37,15,34,11,"useEffect"],[37,24,34,11],[37,26,34,12],[37,32,34,18],[38,6,35,4],[38,12,35,10,"loadMessages"],[38,24,35,22],[38,27,35,25],[38,33,35,25,"loadMessages"],[38,34,35,25],[38,39,35,37],[39,8,36,6,"setIsLoading"],[39,20,36,18],[39,21,36,19],[39,25,36,23],[39,26,36,24],[40,8,37,6],[40,14,37,12,"localMessages"],[40,27,37,25],[40,30,37,28],[40,36,37,34],[40,40,37,34,"getLocalMessages"],[40,63,37,50],[40,64,37,50,"getLocalMessages"],[40,80,37,50],[40,82,37,51,"chatId"],[40,88,37,57],[40,89,37,58],[41,8,38,6,"setMessages"],[41,19,38,17],[41,20,38,18,"localMessages"],[41,33,38,31],[41,34,38,32],[42,8,39,6,"setIsLoading"],[42,20,39,18],[42,21,39,19],[42,26,39,24],[42,27,39,25],[44,8,41,6],[45,8,42,6],[45,14,42,12,"lastTimestamp"],[45,27,42,25],[45,30,42,28,"localMessages"],[45,43,42,41],[45,44,42,42,"length"],[45,50,42,48],[45,53,42,51],[45,54,42,52],[45,57,43,10,"Math"],[45,61,43,14],[45,62,43,15,"max"],[45,65,43,18],[45,66,43,19],[45,69,43,22,"localMessages"],[45,82,43,35],[45,83,43,36,"map"],[45,86,43,39],[45,87,43,40,"m"],[45,88,43,41],[45,92,43,45,"m"],[45,93,43,46],[45,94,43,47,"timestamp"],[45,103,43,56],[45,104,43,57],[45,105,43,58],[45,108,44,10],[45,109,44,11],[46,8,46,6,"unsubscribeRef"],[46,22,46,20],[46,23,46,21,"current"],[46,30,46,28],[46,33,46,31],[46,37,46,31,"subscribeToNewMessages"],[46,60,46,53],[46,61,46,53,"subscribeToNewMessages"],[46,83,46,53],[46,85,47,8,"chatId"],[46,91,47,14],[46,93,48,8,"lastTimestamp"],[46,106,48,21],[46,108,49,8],[46,114,49,15,"newMessage"],[46,124,49,25],[46,128,49,30],[47,10,50,10],[48,10,51,10],[48,14,51,14,"newMessage"],[48,24,51,24],[48,25,51,25,"sender"],[48,31,51,31],[48,36,51,36,"currentUserPhone"],[48,52,51,52],[48,54,51,54],[49,12,52,12],[49,18,52,18],[49,22,52,18,"addMessageLocally"],[49,45,52,35],[49,46,52,35,"addMessageLocally"],[49,63,52,35],[49,65,52,36,"chatId"],[49,71,52,42],[49,73,52,44,"newMessage"],[49,83,52,54],[49,84,52,55],[50,12,53,12,"setMessages"],[50,23,53,23],[50,24,53,24,"prev"],[50,28,53,28],[50,32,53,32],[51,14,54,14],[51,20,54,20,"exists"],[51,26,54,26],[51,29,54,29,"prev"],[51,33,54,33],[51,34,54,34,"find"],[51,38,54,38],[51,39,54,39,"m"],[51,40,54,40],[51,44,54,44,"m"],[51,45,54,45],[51,46,54,46,"id"],[51,48,54,48],[51,53,54,53,"newMessage"],[51,63,54,63],[51,64,54,64,"id"],[51,66,54,66],[51,67,54,67],[52,14,55,14],[52,18,55,18,"exists"],[52,24,55,24],[52,26,55,26],[52,33,55,33,"prev"],[52,37,55,37],[53,14,56,14],[53,21,56,21],[53,22,56,22],[53,25,56,25,"prev"],[53,29,56,29],[53,31,56,31,"newMessage"],[53,41,56,41],[53,42,56,42],[53,43,56,43,"sort"],[53,47,56,47],[53,48,56,48],[53,49,56,49,"a"],[53,50,56,50],[53,52,56,52,"b"],[53,53,56,53],[53,58,56,58,"a"],[53,59,56,59],[53,60,56,60,"timestamp"],[53,69,56,69],[53,72,56,72,"b"],[53,73,56,73],[53,74,56,74,"timestamp"],[53,83,56,83],[53,84,56,84],[54,12,57,12],[54,13,57,13],[54,14,57,14],[55,10,58,10],[56,8,59,8],[56,9,60,6],[56,10,60,7],[57,6,61,4],[57,7,61,5],[58,6,63,4],[58,10,63,8,"currentUserPhone"],[58,26,63,24],[58,30,63,28,"otherUserPhone"],[58,44,63,42],[58,46,63,44],[59,8,64,6,"loadMessages"],[59,20,64,18],[59,21,64,19],[59,22,64,20],[60,6,65,4],[61,6,67,4],[61,13,67,11],[61,19,67,17],[62,8,68,6],[62,12,68,10,"unsubscribeRef"],[62,26,68,24],[62,27,68,25,"current"],[62,34,68,32],[62,36,68,34],[63,10,69,8,"unsubscribeRef"],[63,24,69,22],[63,25,69,23,"current"],[63,32,69,30],[63,33,69,31],[63,34,69,32],[64,8,70,6],[65,6,71,4],[65,7,71,5],[66,4,72,2],[66,5,72,3],[66,7,72,5],[66,8,72,6,"chatId"],[66,14,72,12],[66,16,72,14,"currentUserPhone"],[66,32,72,30],[66,34,72,32,"otherUserPhone"],[66,48,72,46],[66,49,72,47],[66,50,72,48],[68,4,74,2],[69,4,75,2],[69,10,75,8,"sendMessage"],[69,21,75,19],[69,24,75,22],[69,28,75,22,"useCallback"],[69,34,75,33],[69,35,75,33,"useCallback"],[69,46,75,33],[69,48,75,34],[69,54,75,41,"text"],[69,58,75,53],[69,62,75,73],[70,6,76,4],[70,10,76,8],[70,11,76,9,"text"],[70,15,76,13],[70,16,76,14,"trim"],[70,20,76,18],[70,21,76,19],[70,22,76,20],[70,24,76,22],[71,6,78,4],[71,12,78,10,"message"],[71,19,78,26],[71,22,78,29],[72,8,79,6,"id"],[72,10,79,8],[72,12,79,10],[72,16,79,10,"generateMessageId"],[72,39,79,27],[72,40,79,27,"generateMessageId"],[72,57,79,27],[72,59,79,28],[72,60,79,29],[73,8,80,6,"text"],[73,12,80,10],[73,14,80,12,"text"],[73,18,80,16],[73,19,80,17,"trim"],[73,23,80,21],[73,24,80,22],[73,25,80,23],[74,8,81,6,"sender"],[74,14,81,12],[74,16,81,14,"currentUserPhone"],[74,32,81,30],[75,8,82,6,"timestamp"],[75,17,82,15],[75,19,82,17,"Date"],[75,23,82,21],[75,24,82,22,"now"],[75,27,82,25],[75,28,82,26],[75,29,82,27],[76,8,83,6,"status"],[76,14,83,12],[76,16,83,14],[77,6,84,4],[77,7,84,5],[79,6,86,4],[80,6,87,4,"setMessages"],[80,17,87,15],[80,18,87,16,"prev"],[80,22,87,20],[80,26,87,24],[80,27,87,25],[80,30,87,28,"prev"],[80,34,87,32],[80,36,87,34,"message"],[80,43,87,41],[80,44,87,42],[80,45,87,43],[82,6,89,4],[83,6,90,4],[83,12,90,10],[83,16,90,10,"addMessageLocally"],[83,39,90,27],[83,40,90,27,"addMessageLocally"],[83,57,90,27],[83,59,90,28,"chatId"],[83,65,90,34],[83,67,90,36,"message"],[83,74,90,43],[83,75,90,44],[85,6,92,4],[86,6,93,4],[86,12,93,10,"success"],[86,19,93,17],[86,22,93,20],[86,28,93,26],[86,32,93,26,"sendMessageToFirebase"],[86,55,93,47],[86,56,93,47,"sendMessageToFirebase"],[86,77,93,47],[86,79,93,48,"chatId"],[86,85,93,54],[86,87,93,56,"message"],[86,94,93,63],[86,95,93,64],[87,6,95,4],[87,10,95,8,"success"],[87,17,95,15],[87,19,95,17],[88,8,96,6],[89,8,97,6],[89,14,97,12],[89,18,97,12,"updateMessageStatusLocally"],[89,41,97,38],[89,42,97,38,"updateMessageStatusLocally"],[89,68,97,38],[89,70,97,39,"chatId"],[89,76,97,45],[89,78,97,47,"message"],[89,85,97,54],[89,86,97,55,"id"],[89,88,97,57],[89,90,97,59],[89,96,97,65],[89,97,97,66],[90,8,98,6,"setMessages"],[90,19,98,17],[90,20,98,18,"prev"],[90,24,98,22],[90,28,98,26,"prev"],[90,32,98,30],[90,33,98,31,"map"],[90,36,98,34],[90,37,98,35,"m"],[90,38,98,36],[90,42,99,8,"m"],[90,43,99,9],[90,44,99,10,"id"],[90,46,99,12],[90,51,99,17,"message"],[90,58,99,24],[90,59,99,25,"id"],[90,61,99,27],[90,64,99,30],[91,10,99,32],[91,13,99,35,"m"],[91,14,99,36],[92,10,99,38,"status"],[92,16,99,44],[92,18,99,46],[93,8,99,53],[93,9,99,54],[93,12,99,57,"m"],[93,13,100,6],[93,14,100,7],[93,15,100,8],[94,6,101,4],[94,7,101,5],[94,13,101,11],[95,8,102,6],[96,8,103,6],[96,14,103,12],[96,18,103,12,"addToQueue"],[96,41,103,22],[96,42,103,22,"addToQueue"],[96,52,103,22],[96,54,103,23,"chatId"],[96,60,103,29],[96,62,103,31,"message"],[96,69,103,38],[96,70,103,39],[97,8,104,6],[97,14,104,12],[97,18,104,12,"updateMessageStatusLocally"],[97,41,104,38],[97,42,104,38,"updateMessageStatusLocally"],[97,68,104,38],[97,70,104,39,"chatId"],[97,76,104,45],[97,78,104,47,"message"],[97,85,104,54],[97,86,104,55,"id"],[97,88,104,57],[97,90,104,59],[97,98,104,67],[97,99,104,68],[98,8,105,6,"setMessages"],[98,19,105,17],[98,20,105,18,"prev"],[98,24,105,22],[98,28,105,26,"prev"],[98,32,105,30],[98,33,105,31,"map"],[98,36,105,34],[98,37,105,35,"m"],[98,38,105,36],[98,42,106,8,"m"],[98,43,106,9],[98,44,106,10,"id"],[98,46,106,12],[98,51,106,17,"message"],[98,58,106,24],[98,59,106,25,"id"],[98,61,106,27],[98,64,106,30],[99,10,106,32],[99,13,106,35,"m"],[99,14,106,36],[100,10,106,38,"status"],[100,16,106,44],[100,18,106,46],[101,8,106,55],[101,9,106,56],[101,12,106,59,"m"],[101,13,107,6],[101,14,107,7],[101,15,107,8],[102,6,108,4],[103,4,109,2],[103,5,109,3],[103,7,109,5],[103,8,109,6,"chatId"],[103,14,109,12],[103,16,109,14,"currentUserPhone"],[103,32,109,30],[103,33,109,31],[103,34,109,32],[104,4,111,2],[104,11,111,9],[105,6,112,4,"messages"],[105,14,112,12],[106,6,113,4,"sendMessage"],[106,17,113,15],[107,6,114,4,"isLoading"],[107,15,114,13],[108,6,115,4,"isOnline"],[108,14,115,12],[109,6,116,4,"queueLength"],[109,17,116,15],[110,6,117,4,"chatId"],[111,4,118,2],[111,5,118,3],[112,2,119,0],[112,3,119,1],[113,0,119,2],[113,3]],"functionMap":{"names":["<global>","useChat","handleStatusUpdate","setMessages$argument_0","prev.map$argument_0","useEffect$argument_0","loadMessages","localMessages.map$argument_0","subscribeToNewMessages$argument_2","prev.find$argument_0","sort$argument_0","<anonymous>","sendMessage"],"mappings":"AAA;uBCe;yCCO;kBCE,iBC;iDDC;ODC;GDE;YIK;yBCC;wCCQ,gBD;QEM;wBLI;uCMC,2BN;gDOE,mCP;aKC;SFE;KDE;WMM;KNI;GJC;kCWG;gBTY,0BS;kBTW,iBC;0DDC;OSC;kBTK,iBC;4DDC;OSC;GXE;CDU"},"hasCjsExports":false},"type":"js/module"}]}